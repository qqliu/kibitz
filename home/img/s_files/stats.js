webpackJsonp([7],{676:function(module,exports,__webpack_require__){"use strict";var page=__webpack_require__(13);var controller=__webpack_require__(295),statsController=__webpack_require__(1514),config=__webpack_require__(4);module.exports=function(){if(config.isEnabled("manage/stats")){page("/stats",controller.siteSelection,controller.navigation,statsController.overview);page("/stats/day",controller.siteSelection,controller.navigation,statsController.overview);page("/stats/week",controller.siteSelection,controller.navigation,statsController.overview);page("/stats/month",controller.siteSelection,controller.navigation,statsController.overview);page("/stats/year",controller.siteSelection,controller.navigation,statsController.overview);page("/stats/insights/:site_id",controller.siteSelection,controller.navigation,statsController.insights);page("/stats/day/:site_id",controller.siteSelection,controller.navigation,statsController.site);page("/stats/week/:site_id",controller.siteSelection,controller.navigation,statsController.site);page("/stats/month/:site_id",controller.siteSelection,controller.navigation,statsController.site);page("/stats/year/:site_id",controller.siteSelection,controller.navigation,statsController.site);page("/stats/:module/:site_id",controller.siteSelection,controller.navigation,statsController.summary);page("/stats/day/:module/:site_id",controller.siteSelection,controller.navigation,statsController.summary);page("/stats/week/:module/:site_id",controller.siteSelection,controller.navigation,statsController.summary);page("/stats/month/:module/:site_id",controller.siteSelection,controller.navigation,statsController.summary);page("/stats/year/:module/:site_id",controller.siteSelection,controller.navigation,statsController.summary);page("/stats/post/:post_id/:site_id",controller.siteSelection,controller.navigation,statsController.post);page("/stats/page/:post_id/:site_id",controller.siteSelection,controller.navigation,statsController.post);page("/stats/follows/:follow_type/:site_id",controller.siteSelection,controller.navigation,statsController.follows);page("/stats/follows/:follow_type/:page_num/:site_id",controller.siteSelection,controller.navigation,statsController.follows);page("/stats/(.*)",controller.siteSelection,controller.navigation,statsController.redirectToDefaultSitePage,controller.sites)}}},679:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),joinClasses=__webpack_require__(55);module.exports=React.createClass({displayName:"Main",render:function render(){return React.createElement("div",{className:joinClasses(this.props.className,"main"),role:"main"},this.props.children)}})},682:function(module,exports,__webpack_require__){"use strict";var _defineProperty=__webpack_require__(722)["default"];var _Object$keys=__webpack_require__(73)["default"];var debug=__webpack_require__(1)("calypso:posts"),defer=__webpack_require__(707),store=__webpack_require__(21),clone=__webpack_require__(154),assign=__webpack_require__(15);var wpcom=__webpack_require__(20),PostsStore=__webpack_require__(725),PostEditStore=__webpack_require__(771),PostListStore=__webpack_require__(721),sites=__webpack_require__(23)(),formatting=__webpack_require__(287),utils=__webpack_require__(689),Dispatcher=__webpack_require__(30);function handleSaveAndContinueEditingResponse(callback,error,data){var original;if(!error){original=PostsStore.get(data.global_ID);data.title=formatting.decodeEntities(data.title)}Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POST_BEING_EDITED",error:error,original:original,post:data});callback(error,data)}function handleMetadataOperation(key,value,operation){var post=PostEditStore.get(),metadata;metadata=(post.metadata||[]).filter(function(meta){return meta.key!==key});if("string"===typeof key){key=_defineProperty({},key,value)}_Object$keys(key).forEach(function(objectKey){var meta={key:objectKey,operation:operation};if("delete"!==operation){meta.value=key[objectKey]}metadata.push(meta)});Dispatcher.handleViewAction({type:"EDIT_POST",post:{metadata:metadata}})}function normalizeApiAttributes(attributes){attributes=clone(attributes);if(attributes.author){attributes.author=attributes.author.ID}if(attributes.categories){attributes.categories_by_id=attributes.categories;delete attributes.category_ids;delete attributes.categories}return attributes}var PostActions={startEditingNew:function startEditingNew(site,options){var args;options=options||{};args={type:"DRAFT_NEW_POST",siteId:site.ID,postType:options.type||"post"};if(args.postType==="post"){args.defaultPostFormat=site.options.default_post_format;args.defaultCategory=site.options.default_category}Dispatcher.handleViewAction(args)},startEditingExisting:function startEditingExisting(site,postId){var currentPost=PostEditStore.get(),postHandle;if(!site.ID){return}if(currentPost&&currentPost.site_ID===site.ID&&currentPost.ID===postId){return}Dispatcher.handleViewAction({type:"START_EDITING_POST",siteId:site.ID,postId:postId});postHandle=wpcom.site(site.ID).post(postId);postHandle.get({context:"edit"},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_TO_EDIT",error:error,post:data})})},stopEditing:function stopEditing(){Dispatcher.handleViewAction({type:"STOP_EDITING_POST"})},autosave:function autosave(callback){var post=PostEditStore.get(),savedPost=PostEditStore.getSavedPost(),siteHandle=wpcom.undocumented().site(post.site_ID),site;callback=callback||function(){};if(!PostEditStore.isDirty()){return callback(new Error("NOT_DIRTY"))}store.set("wpcom-autosave:"+post.site_ID+":"+post.ID,post);if(utils.isPublished(savedPost)||utils.isPublished(post)){site=sites.getSite(post.site_ID);if(!site||site.jetpack){return callback(new Error("NO_JETPACK_AUTOSAVE"))}Dispatcher.handleViewAction({type:"POST_AUTOSAVE",post:post});siteHandle.postAutosave(post.ID,{content:post.content,title:post.title},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_AUTOSAVE",error:error,autosave:data});callback(error,data)})}else{PostActions.saveEdited(null,callback)}},blockSave:function blockSave(key){Dispatcher.handleViewAction({type:"BLOCK_EDIT_POST_SAVE",key:key})},unblockSave:function unblockSave(key){Dispatcher.handleViewAction({type:"UNBLOCK_EDIT_POST_SAVE",key:key})},edit:function edit(attributes){Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes})},editRawContent:function editRawContent(content){Dispatcher.handleViewAction({type:"EDIT_POST_RAW_CONTENT",content:content})},resetRawContent:function resetRawContent(content){Dispatcher.handleViewAction({type:"RESET_POST_RAW_CONTENT"})},updateMetadata:function updateMetadata(key,value){handleMetadataOperation(key,value,"update")},deleteMetadata:function deleteMetadata(key){handleMetadataOperation(key,null,"delete")},saveEdited:function saveEdited(attributes,callback){var post=PostEditStore.get(),postHandle,query,boundHandler,changedAttributes;Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes});if(!PostEditStore.hasContent()){defer(callback,new Error("NO_CONTENT"),post);return}if(PostEditStore.isSaveBlocked()){defer(callback,new Error("SAVE_BLOCKED"),post);return}changedAttributes=PostEditStore.getChangedAttributes();if(!_Object$keys(changedAttributes).length){defer(callback,new Error("NO_CHANGE"),post);return}changedAttributes=normalizeApiAttributes(changedAttributes);Dispatcher.handleViewAction({type:"EDIT_POST_SAVE"});postHandle=wpcom.site(post.site_ID).post(post.ID);query={context:"edit",apiVersion:"1.2"};boundHandler=handleSaveAndContinueEditingResponse.bind(null,callback);if(changedAttributes&&changedAttributes.status==="future"&&utils.isFutureDated(post)){changedAttributes=assign({},changedAttributes,{status:"publish"})}if(post.ID){postHandle.update(query,changedAttributes,boundHandler)}else{postHandle.add(query,changedAttributes,boundHandler)}},update:function update(post,attributes,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.update(attributes,PostActions.receiveUpdate.bind(null,callback))},trash:function trash(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.del(PostActions.receiveUpdate.bind(null,callback))},restore:function restore(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.restore(PostActions.receiveUpdate.bind(null,callback))},queryPosts:function queryPosts(options){Dispatcher.handleViewAction({type:"QUERY_POSTS",options:options})},fetchNextPage:function fetchNextPage(){var params,id,siteID;if(PostListStore.isLastPage()){return}Dispatcher.handleViewAction({type:"FETCH_NEXT_POSTS_PAGE"});id=PostListStore.getID();params=PostListStore.getNextPageParams();siteID=PostListStore.getSiteID();if(siteID){wpcom.site(siteID).postsList(params,PostActions.receivePage.bind(null,id))}else{wpcom.me().postsList(params,PostActions.receivePage.bind(null,id))}},receivePage:function receivePage(id,error,data){Dispatcher.handleServerAction({type:"RECEIVE_POSTS_PAGE",id:id,error:error,data:data})},fetchUpdated:function fetchUpdated(){var id,params,siteID;Dispatcher.handleViewAction({type:"FETCH_UPDATED_POSTS"});id=PostListStore.getID();params=PostListStore.getUpdatesParams();siteID=PostListStore.getSiteID();if(siteID){debug("Fetching posts that have been updated for %s since %s %o",siteID,params.modified_after,params);wpcom.site(siteID).postsList(params,PostActions.receiveUpdated.bind(null,id))}else{debug("Fetching posts that have been updated since %s %o",params.modified_after,params);wpcom.me().postsList(params,PostActions.receiveUpdated.bind(null,id))}},receiveUpdated:function receiveUpdated(id,error,data){Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POSTS",id:id,error:error,data:data})},receiveUpdate:function receiveUpdate(callback,error,data){var original;if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POST",error:error,original:original,post:data});callback(error,data)},fetchCounts:function fetchCounts(siteId,options){Dispatcher.handleViewAction({type:"FETCH_POST_COUNTS",siteId:siteId});wpcom.site(siteId).postCounts(options,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_COUNTS",error:error,data:data,siteId:siteId})})}};module.exports=PostActions},683:function(module,exports,__webpack_require__){var createFindIndex=__webpack_require__(703);var findIndex=createFindIndex();module.exports=findIndex},684:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var NavItem=React.createClass({displayName:"NavItem",mixins:[React.addons.PureRenderMixin],propTypes:{itemType:React.PropTypes.string,path:React.PropTypes.string,selected:React.PropTypes.bool,tabIndex:React.PropTypes.number,onClick:React.PropTypes.func,isExternalLink:React.PropTypes.bool,disabled:React.PropTypes.bool},render:function render(){var itemClassPrefix=this.props.itemType?this.props.itemType:"tab",itemClasses,itemClassName,target,onClick;itemClasses={"is-selected":this.props.selected,"is-external":this.props.isExternalLink};itemClasses["section-nav-"+itemClassPrefix]=true;itemClassName=classNames(itemClasses);if(this.props.isExternalLink){target="_blank"}if(!this.props.disabled){onClick=this.props.onClick}return React.createElement("li",{className:itemClassName},React.createElement("a",{href:this.props.path,target:target,className:"section-nav-"+itemClassPrefix+"__link",onTouchTap:onClick,tabIndex:this.props.tabIndex||0,"aria-selected":this.props.selected,disabled:this.props.disabled,role:"menuitem",rel:this.props.isExternalLink?"external":null},React.createElement("span",{className:"section-nav-"+itemClassPrefix+"__text"},this.props.children,"undefined"===typeof this.props.count||false===this.props.count?null:React.createElement("span",{className:"section-nav-item__count","data-count":this.props.count}))))}});module.exports=NavItem},685:function(module,exports,__webpack_require__){"use strict";var _extends=__webpack_require__(94)["default"];var React=__webpack_require__(2),debounce=__webpack_require__(155),classNames=__webpack_require__(11);var SelectDropdown=__webpack_require__(696),DropdownItem=__webpack_require__(688);var MOBILE_PANEL_THRESHOLD=480;var NavTabs=React.createClass({displayName:"NavTabs",propTypes:{selectedText:React.PropTypes.string,label:React.PropTypes.string,hasSiblingControls:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{hasSiblingControls:false}},getInitialState:function getInitialState(){return{isDropdown:false}},componentDidMount:function componentDidMount(){this._setDropdown();this._debouncedAfterResize=debounce(this._setDropdown,300);window.addEventListener("resize",this._debouncedAfterResize)},componentWillReceiveProps:function componentWillReceiveProps(){this._setDropdown()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this._debouncedAfterResize)},render:function render(){var tabs,tabsClassName;tabs=React.Children.map(this.props.children,function(child,index){return child?React.cloneElement(child,{ref:"tab-"+index}):null});tabsClassName=classNames({"section-nav-tabs":true,"is-dropdown":this.state.isDropdown,"is-open":this.state.isDropdownOpen,"has-siblings":this.props.hasSiblingControls});return React.createElement("div",{className:"section-nav-group",ref:"navGroup"},React.createElement("div",{className:tabsClassName},this.props.label?React.createElement("h6",{className:"section-nav-group__label"},this.props.label):null,React.createElement("ul",{className:"section-nav-tabs__list",role:"menu",onKeyDown:this._keyHandler},tabs),this.state.isDropdown&&window.innerWidth>MOBILE_PANEL_THRESHOLD?this._getDropdown():null))},_getTabWidths:function _getTabWidths(){var totalWidth=0;React.Children.forEach(this.props.children,function(child,index){if(!child){return}var tabWidth=this.refs["tab-"+index].getDOMNode().offsetWidth;totalWidth+=tabWidth}.bind(this));this.tabsWidth=totalWidth},_getDropdown:function _getDropdown(){var dropdownOptions;dropdownOptions=React.Children.map(this.props.children,function(child,index){if(!child){return null}return React.createElement(DropdownItem,_extends({},child.props,{key:"navTabsDropdown-"+index}),child.props.children)});return React.createElement(SelectDropdown,{className:"section-nav-tabs__dropdown",selectedText:this.props.selectedText,selectedCount:this.props.selectedCount},dropdownOptions)},_setDropdown:function _setDropdown(){var navGroupWidth;if(window.innerWidth>MOBILE_PANEL_THRESHOLD){if(!this.refs.navGroup){return}navGroupWidth=this.refs.navGroup.getDOMNode().offsetWidth;if(!this.tabsWidth){this._getTabWidths()}if(navGroupWidth<=this.tabsWidth&&!this.state.isDropdown){this.setState({isDropdown:true})}else if(navGroupWidth>this.tabsWidth&&this.state.isDropdown){this.setState({isDropdown:false})}}else if(window.innerWidth<=MOBILE_PANEL_THRESHOLD&&this.state.isDropdown){this.setState({isDropdown:false})}},_keyHandler:function _keyHandler(event){switch(event.keyCode){case 32:case 13:event.preventDefault();document.activeElement.click();break}}});module.exports=NavTabs},686:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2);var AllSitesIcon=__webpack_require__(300),layoutFocus=__webpack_require__(75),title=__webpack_require__(163),SiteIcon=__webpack_require__(102),sites=__webpack_require__(23)();module.exports=React.createClass({displayName:"SidebarNavigation",toggleSidebar:function toggleSidebar(event){event.preventDefault();layoutFocus.set("sidebar")},render:function render(){var site=sites.getSelectedSite(),currentSiteTitle=site.title,allSitesClass;if(!site){currentSiteTitle=this.translate("All Sites");allSitesClass="all-sites"}return React.createElement("header",{className:"current-section"},React.createElement("a",{onTouchTap:this.toggleSidebar,className:allSitesClass},site?React.createElement(SiteIcon,{site:site,size:30}):React.createElement(AllSitesIcon,{sites:sites.get()}),React.createElement("p",{className:"current-section__site-title"},currentSiteTitle),React.createElement("h1",{className:"current-section__section-title"},title.get()),React.createElement("span",{className:"noticon noticon-collapse"})))}})},688:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var SelectDropdownItem=React.createClass({displayName:"SelectDropdownItem",propTypes:{children:React.PropTypes.string.isRequired,path:React.PropTypes.string,selected:React.PropTypes.bool,onClick:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{selected:false}},render:function render(){var optionClassName=classNames({"select-dropdown__item":true,"is-selected":this.props.selected});return React.createElement("li",{className:"select-dropdown__option"},React.createElement("a",{ref:"itemLink",href:this.props.path,className:optionClassName,onClick:this.props.onClick,"data-bold-text":this.props.value||this.props.children,role:"menuitem",tabIndex:0,"aria-selected":this.props.selected},React.createElement("span",{className:"select-dropdown__item-text"},this.props.children,"undefined"===typeof this.props.count||false===this.props.count?null:React.createElement("span",{className:"section-nav-item__count","data-count":this.props.count}))))}});module.exports=SelectDropdownItem},689:function(module,exports,__webpack_require__){"use strict";var url=__webpack_require__(43);var postNormalizer=__webpack_require__(755),config=__webpack_require__(4),sites=__webpack_require__(23)();var utils={getEditURL:function getEditURL(post,site){var editURL;if(config.isEnabled("post-editor")){editURL="/post/"+post.ID+"/"+site.slug}else{editURL="//wordpress.com/post/"+site.ID+"/"+post.ID+"/"}return editURL},getPreviewURL:function getPreviewURL(post){var parsed,site,previewUrl;if(!post||!post.URL){return""}if(post.preview_URL){previewUrl=post.preview_URL}else if(post.status==="publish"){previewUrl=post.URL}else{parsed=url.parse(post.URL,true);parsed.query.preview="true";delete parsed.search;previewUrl=url.format(parsed)}if(post.site_ID){site=sites.getSite(post.site_ID);if(site.options.is_mapped_domain){previewUrl=previewUrl.replace(site.URL,site.options.unmapped_url)}}return previewUrl},userCan:function userCan(capability,post){var hasCap=post.capabilities&&post.capabilities[capability];if(capability==="edit_post"){return hasCap&&post.status!=="trash"}return hasCap},isPublished:function isPublished(post){return post&&(post.status==="publish"||post.status==="private")},getEditedTime:function getEditedTime(post){if(!post){return false}if(post.status==="publish"||post.status==="future"){return post.date}return post.modified},isFutureDated:function isFutureDated(post){if(!post){return false}return post&&+new Date<+new Date(post.date)},isPage:function isPage(post){if(!post){return false}return post&&"page"===post.type},normalizeSync:function normalizeSync(post,callback){var imageWidth=653;postNormalizer(post,[postNormalizer.decodeEntities,postNormalizer.stripHTML,postNormalizer.firstPassCanonicalImage,postNormalizer.safeImageProperties(imageWidth),postNormalizer.withContentDOM([postNormalizer.content.removeStyles,postNormalizer.content.safeContentImages(imageWidth)])],callback)},getVisibility:function getVisibility(post){if(!post){return}if(post.password){return"password"}if("private"===post.status){return"private"}return"public"},normalizeAsync:function normalizeAsync(post,callback){postNormalizer(post,[postNormalizer.waitForImagesToLoad,postNormalizer.keepValidImages(72,72)],callback)},slugFromTitle:function slugFromTitle(post){if(!post){return}if(!post.title){return}return post.title.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/ /g,"-").replace(/\./g,"-").toLowerCase()}};module.exports=utils},691:function(module,exports,__webpack_require__){(function(setImmediate,clearImmediate){var nextTick=__webpack_require__(284).nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(exports,__webpack_require__(691).setImmediate,__webpack_require__(691).clearImmediate)},694:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),joinClasses=__webpack_require__(55);var Card=__webpack_require__(95);module.exports=React.createClass({displayName:"CompactCard",render:function render(){return React.createElement(Card,{className:joinClasses(this.props.className,"is-compact"),onClick:this.props.onClick},this.props.children)}})},695:function(module,exports,__webpack_require__){var baseCallback=__webpack_require__(32),baseUniq=__webpack_require__(298),isIterateeCall=__webpack_require__(27),sortedUniq=__webpack_require__(708);function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?undefined:isSorted;isSorted=false}iteratee=iteratee==null?iteratee:baseCallback(iteratee,thisArg,3);return isSorted?sortedUniq(array,iteratee):baseUniq(array,iteratee)}module.exports=uniq},696:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),findWhere=__webpack_require__(702),filter=__webpack_require__(97),findIndex=__webpack_require__(683),map=__webpack_require__(282),result=__webpack_require__(712),noop=__webpack_require__(35),classNames=__webpack_require__(11);var DropdownItem=__webpack_require__(688),DropdownSeparator=__webpack_require__(710);var _instance=1;var SelectDropdown=React.createClass({displayName:"SelectDropdown",propTypes:{selectedText:React.PropTypes.string,initialSelected:React.PropTypes.string,className:React.PropTypes.string,style:React.PropTypes.object,onSelect:React.PropTypes.func,onToggle:React.PropTypes.func,focusSibling:React.PropTypes.func,tabIndex:React.PropTypes.number,options:React.PropTypes.arrayOf(React.PropTypes.shape({value:React.PropTypes.string.isRequired,label:React.PropTypes.string.isRequired,path:React.PropTypes.string}))},getInitialState:function getInitialState(){var initialState={isOpen:false};if(this.props.options){initialState.selected=this.props.initialSelected||this.props.options[0].value}return initialState},getDefaultProps:function getDefaultProps(){return{onSelect:noop,onToggle:noop}},componentWillMount:function componentWillMount(){this.id=_instance;_instance++},componentWillReceiveProps:function componentWillReceiveProps(){if(this.state.isOpen){this._closeDropdown()}},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("click",this._handleOutsideClick)},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(this.state.isOpen){window.addEventListener("click",this._handleOutsideClick)}else{window.removeEventListener("click",this._handleOutsideClick)}if(this.state.isOpen!==prevState.isOpen){this.props.onToggle({target:this,open:this.state.isOpen})}},dropdownOptions:function dropdownOptions(){var refIndex=0;if(this.props.children){return React.Children.map(this.props.children,function(child,index){if(!child){return null}var newChild=React.cloneElement(child,{ref:child.type===DropdownItem?"item-"+refIndex:null,key:"item-"+index,onClick:function(event){this.refs.dropdownContainer.getDOMNode().focus();if(typeof child.props.onClick==="function"){child.props.onClick(event)}}.bind(this)});if(child.type===DropdownItem){refIndex++}return newChild},this)}return this.props.options.map(function(item,index){var dropdownItem;if(!item){return React.createElement(DropdownSeparator,{key:"dropdown-separator-"+this.id+"-"+index})}dropdownItem=React.createElement(DropdownItem,{key:"dropdown-item-"+this.id+"-"+item.value,ref:"item-"+refIndex,selected:this.state.selected===item.value,onClick:this._onSelect.bind(this,item),path:item.path},item.label);refIndex++;return dropdownItem},this)},render:function render(){var dropdownClasses,dropdownClassName,selectedText,selectedCount,style;dropdownClasses={"select-dropdown":true,"is-open":this.state.isOpen};if(this.props.className){this.props.className.split(" ").forEach(function(className){dropdownClasses[className]=true})}dropdownClassName=classNames(dropdownClasses);selectedText=this.props.selectedText?this.props.selectedText:result(findWhere(this.props.options,{value:this.state.selected}),"label");selectedCount=this.props.selectedCount;style=this.props.style||{};return React.createElement("div",{style:style,className:dropdownClassName},React.createElement("div",{ref:"dropdownContainer",className:"select-dropdown__container",onKeyDown:this._keyListener,tabIndex:this.props.tabIndex||0,"aria-haspopup":"true","aria-owns":"select-submenu-"+this.id,"aria-controls":"select-submenu-"+this.id,"aria-expanded":this.state.isOpen,onClick:this._toggleDropdown},React.createElement("div",{id:"select-dropdown-"+this.id,className:"select-dropdown__header"},React.createElement("span",{className:"select-dropdown__header-text"},selectedText,"undefined"===typeof selectedCount||false===selectedCount?null:React.createElement("span",{className:"section-nav-item__count","data-count":selectedCount}))),React.createElement("ul",{id:"select-submenu-"+this.id,className:"select-dropdown__options",role:"menu","aria-labelledby":"select-dropdown-"+this.id,"aria-expanded":this.state.isOpen},this.dropdownOptions())))},_toggleDropdown:function _toggleDropdown(){this.setState({isOpen:!this.state.isOpen})},_openDropdown:function _openDropdown(){this.setState({isOpen:true})},_closeDropdown:function _closeDropdown(){if(this.state.isOpen){delete this.focused;this.setState({isOpen:false})}},_onSelect:function _onSelect(option){if(!option){return}if(this.props.onSelect){this.props.onSelect(option)}this.setState({selected:option.value});this.refs.dropdownContainer.getDOMNode().focus()},_keyListener:function _keyListener(event){switch(event.keyCode){case 9:this._tabHandler(event);break;case 32:case 13:event.preventDefault();this._enterHandler();break;case 38:event.preventDefault();this._focusSibling("previous");this._openDropdown();break;case 40:event.preventDefault();this._focusSibling("next");this._openDropdown();break;case 27:event.preventDefault();this._closeDropdown();this.refs.dropdownContainer.getDOMNode().focus();break}},_tabHandler:function _tabHandler(event){var direction;if(!this.state.isOpen){return}event.preventDefault();direction=event.shiftKey?"previous":"next";this._focusSibling(direction)},_enterHandler:function _enterHandler(){if(!this.state.isOpen){return this._openDropdown()}document.activeElement.click()},_focusSibling:function _focusSibling(direction){var increment,items,focusedIndex,newIndex;if(!this.state.isOpen){return}if(this.props.options){items=filter(map(this.props.options,"value"),Boolean);focusedIndex=typeof this.focused==="number"?this.focused:items.indexOf(this.state.selected)}else{items=filter(this.props.children,function(item){return item.type===DropdownItem});focusedIndex=typeof this.focused==="number"?this.focused:findIndex(items,function(item){return item.props.selected})}increment=direction==="previous"?-1:1;newIndex=focusedIndex+increment;if(newIndex>=items.length||newIndex<0){return}this.refs["item-"+newIndex].refs.itemLink.getDOMNode().focus();this.focused=newIndex},_handleOutsideClick:function _handleOutsideClick(event){if(!React.findDOMNode(this.refs.dropdownContainer).contains(event.target)){this._closeDropdown()}}});module.exports=SelectDropdown},700:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),isEqual=__webpack_require__(96),classNames=__webpack_require__(11);var NavTabs=__webpack_require__(685),NavItem=__webpack_require__(684),Search=__webpack_require__(157);var SectionNav=React.createClass({displayName:"SectionNav",propTypes:{children:React.PropTypes.node,selectedText:React.PropTypes.node,hasPinnedItems:React.PropTypes.bool,onMobileNavPanelOpen:React.PropTypes.func},getInitialState:function getInitialState(){return{mobileOpen:false}},getDefaultProps:function getDefaultProps(){return{onMobileNavPanelOpen:function onMobileNavPanelOpen(){}}},componentWillMount:function componentWillMount(){this._checkForSiblingControls(this.props.children)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(isEqual(this.props,nextProps)){return}this._checkForSiblingControls(nextProps.children);if(!this.hasSiblingControls){this._closeMobilePanel()}},render:function render(){var children=this._getChildren(),className;if(!children){className=classNames({"section-nav":true,"is-empty":true});return React.createElement("div",{className:className},React.createElement("div",{className:"section-nav__panel"},React.createElement(NavItem,null)))}className=classNames({"section-nav":true,"is-open":this.state.mobileOpen,"has-pinned-items":this.hasPinnedSearch||this.props.hasPinnedItems});return React.createElement("div",{className:className},React.createElement("div",{className:"section-nav__mobile-header",onTouchTap:this._toggleMobileOpenState},React.createElement("span",{className:"section-nav__mobile-header-text"},this.props.selectedText)),React.createElement("div",{className:"section-nav__panel"},children))},_getChildren:function _getChildren(){return React.Children.map(this.props.children,function(child){var extraProps={hasSiblingControls:this.hasSiblingControls,closeSectionNavMobilePanel:this._closeMobilePanel};if(!child){return null}if(child.type===NavTabs&&!child.props.selectedText&&typeof this.props.selectedText==="string"){extraProps.selectedText=this.props.selectedText}if(child.type===NavTabs&&this.props.selectedCount){extraProps.selectedCount=this.props.selectedCount}if(child.type===Search){if(child.props.pinned){this.hasPinnedSearch=true}extraProps.onSearch=this._generateOnSearch(child.props.onSearch)}return React.cloneElement(child,extraProps)}.bind(this))},_closeMobilePanel:function _closeMobilePanel(){if(window.innerWidth<480&&this.state.mobileOpen){this.setState({mobileOpen:false})}},_toggleMobileOpenState:function _toggleMobileOpenState(){var mobileOpen=!this.state.mobileOpen;this.setState({mobileOpen:mobileOpen});if(mobileOpen){this.props.onMobileNavPanelOpen()}},_generateOnSearch:function _generateOnSearch(existingOnSearch){return function(){existingOnSearch.apply(this,arguments);this._closeMobilePanel()}.bind(this)},_checkForSiblingControls:function _checkForSiblingControls(children){this.hasSiblingControls=false;React.Children.forEach(children,function(child,index){if(index&&child&&child.type!==Search){this.hasSiblingControls=true}}.bind(this))}});module.exports=SectionNav},702:function(module,exports,__webpack_require__){
var baseMatches=__webpack_require__(166),find=__webpack_require__(56);function findWhere(collection,source){return find(collection,baseMatches(source))}module.exports=findWhere},703:function(module,exports,__webpack_require__){var baseCallback=__webpack_require__(32),baseFindIndex=__webpack_require__(297);function createFindIndex(fromRight){return function(array,predicate,thisArg){if(!(array&&array.length)){return-1}predicate=baseCallback(predicate,thisArg,3);return baseFindIndex(array,predicate,fromRight)}}module.exports=createFindIndex},704:function(module,exports,__webpack_require__){var baseForOwn=__webpack_require__(104),createForOwn=__webpack_require__(723);var forOwn=createForOwn(baseForOwn);module.exports=forOwn},705:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var Card=__webpack_require__(95);module.exports=React.createClass({displayName:"HeaderCake",propTypes:{onClick:React.PropTypes.func.isRequired,onTitleClick:React.PropTypes.func,backText:React.PropTypes.oneOfType([React.PropTypes.element,React.PropTypes.string])},getDefaultProps:function getDefaultProps(){return{isCompact:false}},render:function render(){var classes=classNames("header-cake",this.props.className,{"is-compact":this.props.isCompact});return React.createElement(Card,{className:classes},React.createElement("div",{className:"header-cake__corner"},React.createElement("a",{className:"header-cake__back",onClick:this.props.onClick},React.createElement("span",{className:"noticon noticon-collapse"}),React.createElement("span",{className:"header-cake__back-text"},this.props.backText||this.translate("Back")))),React.createElement("span",{className:"header-cake__title",onClick:this.props.onTitleClick},this.props.children),React.createElement("div",{className:"header-cake__corner"}))}})},707:function(module,exports,__webpack_require__){var baseDelay=__webpack_require__(717),restParam=__webpack_require__(44);var defer=restParam(function(func,args){return baseDelay(func,1,args)});module.exports=defer},708:function(module,exports){function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}module.exports=sortedUniq},709:function(module,exports){function first(array){return array?array[0]:undefined}module.exports=first},710:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var SelectDropdownSeparator=React.createClass({displayName:"SelectDropdownSeparator",render:function render(){return React.createElement("li",{className:"select-dropdown__separator"})}});module.exports=SelectDropdownSeparator},712:function(module,exports,__webpack_require__){var baseGet=__webpack_require__(165),baseSlice=__webpack_require__(168),isFunction=__webpack_require__(161),isKey=__webpack_require__(169),last=__webpack_require__(159),toPath=__webpack_require__(167);function result(object,path,defaultValue){var result=object==null?undefined:object[path];if(result===undefined){if(object!=null&&!isKey(path,object)){path=toPath(path);object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));result=object==null?undefined:object[last(path)]}result=result===undefined?defaultValue:result}return isFunction(result)?result.call(object):result}module.exports=result},717:function(module,exports){var FUNC_ERROR_TEXT="Expected a function";function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}module.exports=baseDelay},718:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(process,setImmediate){(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=function(fn){setImmediate(fn)}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==="function"){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true;q.process()},resume:function(){if(q.paused===false){return}q.paused=false;q.process()}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=="undefined"&&module.exports){module.exports=async}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return async}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{root.async=async}})()}).call(exports,__webpack_require__(284),__webpack_require__(691).setImmediate)},721:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:posts-list"),clone=__webpack_require__(154),assign=__webpack_require__(15),transform=__webpack_require__(784),difference=__webpack_require__(82),last=__webpack_require__(159),max=__webpack_require__(739);var Emitter=__webpack_require__(10),Dispatcher=__webpack_require__(30),treeConvert=__webpack_require__(773)("ID"),PostsStore=__webpack_require__(725);var _defaultQuery={siteID:false,type:"post",status:"publish",orderBy:"date",author:false,search:false,perPage:20};var _activeList={postIds:[],errors:[],query:clone(_defaultQuery),page:0,nextPageHandle:false,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false};var _nextId=0;var PostListStore;function queryPosts(options){var query=assign({},_defaultQuery,options),cache=__webpack_require__(810),list;if(query.siteID&&typeof query.siteID==="string"){query.siteID=query.siteID.replace(/::/g,"/")}if(query.status==="draft,pending"){query.orderBy="modified"}list=cache.get(query);if(list){_activeList=list}else{_activeList={id:_nextId,postIds:[],errors:[],query:query,page:0,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false};_nextId++}PostListStore.emit("change")}function cleanParams(params){return transform(params,function(result,value,key){if(value!=null){result[key]=value}},{})}function sort(){var key=_activeList.query.orderBy;_activeList.postIds.sort(function(a,b){var postA=PostsStore.get(a),postB=PostsStore.get(b),timeA=postA[key],timeB=postB[key];if(timeA===timeB){if(postA.title===postB.title){return 0}else{return postA.title>postB.title?1:-1}}return timeA>timeB?-1:1})}function receivePage(id,error,data){var found=data&&data.found,posts,postIds;if(id!==_activeList.id){return}_activeList.isFetchingNextPage=false;if(error){debug("Error fetching PostsList from api:",error);_activeList.errors.push(error);PostListStore.emit("change");return}if(!found){_activeList.isLastPage=true;PostListStore.emit("change");return}_activeList.nextPageHandle=data.meta&&data.meta.next_page;if(!_activeList.nextPageHandle){_activeList.isLastPage=true}posts=data.posts;postIds=posts.map(function(post){return post.global_ID});if(postIds.length){postIds=difference(postIds,_activeList.postIds);if(postIds.length){_activeList.postIds=_activeList.postIds.concat(postIds);_activeList.page++}}PostListStore.emit("change")}function receiveUpdates(id,error,data){var posts,postIds,newPostIds;if(error){debug("An error occurred while fetching updated posts %o",error);return}if(id!==_activeList.id){return}if(!data.posts.length){return}posts=data.posts;debug("Fetched updated posts:",posts);postIds=posts.map(function(post){return post.global_ID});newPostIds=difference(postIds,_activeList.postIds);if(newPostIds.length){_activeList.postIds=_activeList.postIds.concat(newPostIds);sort(_activeList.postIds)}PostListStore.emit("change")}PostListStore={get:function get(){return _activeList},getID:function getID(){return _activeList.id},getSiteID:function getSiteID(){return _activeList.query.siteID},getAll:function getAll(){return _activeList.postIds.map(function(globalID){return PostsStore.get(globalID)})},getTree:function getTree(){var sortedPosts=[];_activeList.postIds.forEach(function(globalID){var post=clone(PostsStore.get(globalID));post.parent=post.parent?post.parent.ID:0;sortedPosts.push(post)});return treeConvert.treeify(sortedPosts)},getPost:function getPost(globalID){if(_activeList.postIds.indexOf(globalID)>-1){return PostsStore.get(globalID)}},getPage:function getPage(){return _activeList.page},isLastPage:function isLastPage(){return _activeList.isLastPage},isFetchingNextPage:function isFetchingNextPage(){return _activeList.isFetchingNextPage},getNextPageParams:function getNextPageParams(){var params={},query=_activeList.query;params.status=query.status;params.order_by=query.orderBy;params.author=query.author;params.number=query.perPage;params.type=query.type;params.page_handle=_activeList.nextPageHandle;params.exclude_tree=query.exclude_tree;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}return cleanParams(params)},getUpdatesParams:function getUpdatesParams(){var params={},query=_activeList.query;params.status=query.status;params.author=query.author;params.type=query.type;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}if(_activeList.postIds.length){params.modified_after=max(PostListStore.getAll(),function(post){return new Date(post.modified).getTime()}).modified;if(query.orderBy!=="modified"&&!_activeList.isLastPage){params.after=PostListStore.getPost(last(_activeList.postIds)).date}}return cleanParams(params)}};Emitter(PostListStore);PostListStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([PostsStore.dispatchToken]);switch(action.type){case"QUERY_POSTS":queryPosts(action.options);break;case"FETCH_NEXT_POSTS_PAGE":_activeList.isFetchingNextPage=true;PostListStore.emit("change");break;case"RECEIVE_POSTS_PAGE":receivePage(action.id,action.error,action.data);break;case"RECEIVE_UPDATED_POSTS":receiveUpdates(action.id,action.error,action.data);break;case"RECEIVE_UPDATED_POST":if(action.post){if(_activeList.postIds.indexOf(action.post.global_ID)>-1){PostListStore.emit("change")}}break}});module.exports=PostListStore},722:function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(738)["default"];exports["default"]=function(obj,key,value){if(key in obj){_Object$defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj};exports.__esModule=true},723:function(module,exports,__webpack_require__){var bindCallback=__webpack_require__(47);function createForOwn(objectFunc){return function(object,iteratee,thisArg){if(typeof iteratee!="function"||thisArg!==undefined){iteratee=bindCallback(iteratee,thisArg,3)}return objectFunc(object,iteratee)}}module.exports=createForOwn},725:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(96),debug=__webpack_require__(1)("calypso:posts");var utils=__webpack_require__(689),Dispatcher=__webpack_require__(30);var _posts={},PostsStore;function setPost(post){var cachedPost=PostsStore.get(post.global_ID);if(cachedPost&&isEqual(post,cachedPost)){return}_posts[post.global_ID]=post}function normalizePost(attributes){if(!attributes.global_ID){debug("global_ID is required for a post");return}utils.normalizeSync(attributes,function(error,post){setPost(post)})}function setAll(posts){posts.forEach(normalizePost)}PostsStore={get:function get(globalID){return _posts[globalID]}};PostsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){setAll(action.data.posts)}break;case"RECEIVE_UPDATED_POST":if(!action.error){normalizePost(action.post)}break}});module.exports=PostsStore},730:function(module,exports,__webpack_require__){var baseClone=__webpack_require__(302),bindCallback=__webpack_require__(47);function cloneDeep(value,customizer,thisArg){return typeof customizer=="function"?baseClone(value,true,bindCallback(customizer,thisArg,1)):baseClone(value,true)}module.exports=cloneDeep},738:function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(757),__esModule:true}},739:function(module,exports,__webpack_require__){module.exports=__webpack_require__(783)},740:function(module,exports,__webpack_require__){var isArrayLike=__webpack_require__(33),isObject=__webpack_require__(17),values=__webpack_require__(286);function toIterable(value){if(value==null){return[]}if(!isArrayLike(value)){return values(value)}return isObject(value)?value:Object(value)}module.exports=toIterable},741:function(module,exports,__webpack_require__){var arrayCopy=__webpack_require__(60),getLength=__webpack_require__(106),isLength=__webpack_require__(50),values=__webpack_require__(286);function toArray(value){var length=value?getLength(value):0;if(!isLength(length)){return values(value)}if(!length){return[]}return arrayCopy(value)}module.exports=toArray},755:function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(73)["default"];var assign=__webpack_require__(15),async=__webpack_require__(718),debug=__webpack_require__(1)("calypso:post-normalizer"),deepClone=__webpack_require__(730),every=__webpack_require__(305),filter=__webpack_require__(97),find=__webpack_require__(56),first=__webpack_require__(709),forEach=__webpack_require__(292),forOwn=__webpack_require__(704),map=__webpack_require__(282),max=__webpack_require__(739),pick=__webpack_require__(153),startsWith=__webpack_require__(59),some=__webpack_require__(57),toArray=__webpack_require__(741),uniq=__webpack_require__(695),url=__webpack_require__(43);var formatting=__webpack_require__(287),safeImageURL=__webpack_require__(312);function debugForPost(post){return function(msg){debug(post.global_ID+": "+msg)}}function stripAutoPlays(query){var keys=_Object$keys(query).filter(function(k){k=k.toLowerCase();return k==="autoplay"||k==="auto_play"});keys.forEach(function(key){var val=query[key].toLowerCase();if(val==="1"){query[key]="0"}else if(val==="true"){query[key]="false"}});return query}var DEFAULT_PHOTON_QUALITY=80,READING_WORDS_PER_SECOND=250/60;function normalizePost(post,transforms,callback){if(!callback){throw new Error("must supply a callback")}if(!post||!transforms){debug("no post or no transform");callback(null,post);return}var normalizedPost=deepClone(post),postDebug=debugForPost(post);postDebug("running transforms");async.eachSeries(transforms,function(transform,transformCallback){postDebug("running transform "+(transform.name||"anonymous"));transform(normalizedPost,transformCallback)},function(err){postDebug("transforms complete");if(err){callback(err)}else{callback(null,normalizedPost)}})}function maxWidthPhotonishURL(imageURL,width){var parsedURL=url.parse(imageURL,true,true),isGravatar,sizeParam;if(!parsedURL.host){return imageURL}isGravatar=parsedURL.host.indexOf("gravatar.com")!==-1;
delete parsedURL.search;forEach(["h","crop","resize","fit"],function(param){delete parsedURL.query[param]});sizeParam=isGravatar?"s":"w";parsedURL.query[sizeParam]=width;if(!isGravatar){parsedURL.query.quality=DEFAULT_PHOTON_QUALITY;parsedURL.query.strip="info"}return url.format(parsedURL)}function makeImageURLSafe(object,propName,maxWidth,baseURL){if(object&&object[propName]){if(baseURL&&!url.parse(object[propName],true,true).hostname){object[propName]=url.resolve(baseURL,object[propName])}object[propName]=safeImageURL(object[propName]);if(maxWidth){object[propName]=maxWidthPhotonishURL(object[propName],maxWidth)}}}function imageForURL(imageUrl){var img=new Image;img.src=imageUrl;return img}function imageSizeFromAttachments(post,imageUrl){var attachments=post.attachments,found;if(!attachments){return}found=find(attachments,function(attachment){return attachment.URL===imageUrl});if(found){return{width:found.width,height:found.height}}}function candidateForCanonicalImage(image){if(!image){return false}if(image.naturalWidth<350){debug(image&&image.src,": not wide enough");return false}if(image.naturalHeight*image.naturalHeight<3e4){debug(image&&image.src,": not enough area");return false}return true}function removeUnsafeAttributes(node){if(!node||!node.hasAttributes()){return}forEach(toArray(node.attributes),function(attr){if(startsWith(attr.name,"on")){node.removeAttribute(attr.name)}})}var excludedContentImageUrlParts=["gravatar.com"];function isCandidateForContentImage(imageUrl){return!imageShouldBeRemovedFromContent(imageUrl)&&every(excludedContentImageUrlParts,function(part){return imageUrl&&imageUrl.toLowerCase().indexOf(part)===-1})}var bannedUrlParts=["feeds.feedburner.com",".feedsportal.com","wp-includes","wp-content/themes","wp-content/plugins","stats.wordpress.com","pixel.wp.com"];function imageShouldBeRemovedFromContent(imageUrl){return some(bannedUrlParts,function(part){return imageUrl&&imageUrl.toLowerCase().indexOf(part)!==-1})}normalizePost.decodeEntities=function decodeEntities(post,callback){forEach(["excerpt","title","site_name"],function(prop){if(post[prop]){post[prop]=formatting.decodeEntities(post[prop])}});if(post.parent&&post.parent.title){post.parent.title=formatting.decodeEntities(post.parent.title)}if(post.author){if(post.author.name){post.author.name=formatting.decodeEntities(post.author.name)}if(post.author.avatar_URL){post.author.avatar_URL=safeImageURL(post.author.avatar_URL)}}if(post.tags){forOwn(post.tags,function(tag){tag.name=formatting.decodeEntities(tag.name)})}callback()};normalizePost.stripHTML=function stripHTML(post,callback){forEach(["excerpt","title","site_name"],function(prop){if(post[prop]){post[prop]=formatting.stripHTML(post[prop])}});if(post.author&&post.author.name){post.author.name=formatting.stripHTML(post.author.name)}callback()};normalizePost.preventWidows=function preventWidows(post,callback){forEach(["title","excerpt"],function(prop){if(post[prop]){post[prop]=formatting.preventWidows(post[prop],2)}});callback()};normalizePost.firstPassCanonicalImage=function firstPassCanonicalImage(post,callback){if(post.featured_image){post.canonical_image=assign({uri:post.featured_image,type:"image"},imageSizeFromAttachments(post.featured_image))}else{var candidate=first(filter(post.attachments,function(attachment){return startsWith(attachment.mime_type,"image/")}));if(candidate){post.canonical_image={uri:candidate.URL,width:candidate.width,height:candidate.height,type:"image"}}}callback()};normalizePost.makeSiteIDSafeForAPI=function makeSiteIDSafeForAPI(post,callback){if(post.site_id){post.normalized_site_id=(""+post.site_id).replace(/::/g,"/")}callback()};normalizePost.pickPrimaryTag=function assignPrimaryTag(post,callback){var NO_ENTRIES_FOUND_MARKER=-Infinity;post.primary_tag=max(post.tags,function(tag){return tag.post_count});if(post.primary_tag===NO_ENTRIES_FOUND_MARKER){delete post.primary_tag}callback()};normalizePost.safeImageProperties=function(maxWidth){return function safeImageProperties(post,callback){makeImageURLSafe(post.author,"avatar_URL",maxWidth);makeImageURLSafe(post,"featured_image",maxWidth,post.URL);if(post.featured_media&&post.featured_media.type==="image"){makeImageURLSafe(post.featured_media,"uri",maxWidth,post.URL)}if(post.canonical_image&&post.canonical_image.type==="image"){makeImageURLSafe(post.canonical_image,"uri",maxWidth,post.URL)}callback()}};function keepImagesThatLoad(image,acceptCallback){if(image.complete&&image.naturalWidth>0){acceptCallback(true);return}image.onload=function(){acceptCallback(true)};image.onerror=function(){acceptCallback(false)}}function convertImageToObject(image){return pick(image,["src","naturalWidth","naturalHeight"])}normalizePost.waitForImagesToLoad=function waitForImagesToLoad(post,callback){function acceptLoadedImages(images){post.images=map(images,convertImageToObject);post.content_images=filter(map(post.content_images,function(image){return find(post.images,{src:image.src})}),Boolean);callback()}var imagesToCheck=[];if(post.featured_image){imagesToCheck.push(imageForURL(post.featured_image))}forEach(post.content_images,function(image){imagesToCheck.push(imageForURL(image.src))});imagesToCheck=uniq(imagesToCheck,function(image){return image.src});if(imagesToCheck.length===0){callback();return}post.images=imagesToCheck;async.filter(post.images,keepImagesThatLoad,acceptLoadedImages)};function imageHasMinWidthAndHeight(width,height){return function(image){return image.naturalWidth>=width&&image.naturalHeight>=height}}normalizePost.keepValidImages=function(minWidth,minHeight){return function keepValidImages(post,callback){var imageFilter=imageHasMinWidthAndHeight(minWidth,minHeight);if(post.images){post.images=filter(post.images,imageFilter)}if(post.content_images){post.content_images=filter(post.content_images,imageFilter)}callback()}};normalizePost.pickCanonicalImage=function pickCanonicalImage(post,callback){var canonicalImage;if(post.images){canonicalImage=filter(post.images,candidateForCanonicalImage)[0];if(canonicalImage){canonicalImage={uri:canonicalImage.src,width:canonicalImage.naturalWidth,height:canonicalImage.naturalHeight}}}else if(post.featured_image){canonicalImage={uri:post.featured_image,width:0,height:0}}if(canonicalImage){post.canonical_image=canonicalImage}callback()};normalizePost.withContentDOM=function(transforms){return function withContentDOM(post,callback){if(!post||!post.content||!transforms){callback();return}var postDebug=debugForPost(post);postDebug("spinning up dom");post.__contentDOM=document.createElement("div");post.__contentDOM.innerHTML=post.content;postDebug("running dom transforms");async.eachSeries(transforms,function(transform,transformCallback){postDebug("running dom transform "+(transform.name||"anonymous"));transform(post,transformCallback)},function(err){postDebug("done with dom transforms");if(!err){post.content=post.__contentDOM.innerHTML}delete post.__contentDOM;callback(err)})}};normalizePost.content={removeStyles:function removeContentStyles(post,callback){if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}if(post.__contentDOM.querySelector(".gallery, .tiled-gallery")){callback();return}var styled=post.__contentDOM.querySelectorAll("[style]");forEach(styled,function(element){element.removeAttribute("style")});forEach(post.__contentDOM.querySelectorAll("style"),function(element){element.parentNode&&element.parentNode.removeChild(element)});callback()},safeContentImages:function safeContentImages(maxWidth){return function safeContentImages(post,callback){var content_images=[],images;if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}images=post.__contentDOM.querySelectorAll("img[src]");forEach(images,function(image){var imgSource=image.getAttribute("src"),hostName=url.parse(imgSource,false,true).hostname,safeSource;if(!hostName){imgSource=url.resolve(post.URL,imgSource)}removeUnsafeAttributes(image);if(imageShouldBeRemovedFromContent(imgSource)){image.parentNode.removeChild(image);image.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");return}safeSource=safeImageURL(imgSource);if(maxWidth){safeSource=maxWidthPhotonishURL(safeSource,maxWidth)}image.setAttribute("src",safeSource);if(isCandidateForContentImage(imgSource)){content_images.push({src:safeSource,original_src:imgSource,width:image.width,height:image.height})}});content_images=filter(content_images,function(image){var edgeLength=image.height+image.width;return edgeLength===0||edgeLength>2});if(content_images.length){post.content_images=content_images}callback()}},makeEmbedsSecure:function makeEmbedsSecure(post,callback){if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}var embeds=post.__contentDOM.querySelectorAll("iframe");forEach(embeds,function(iframe){iframe.src=iframe.src.replace(/^http:/,"https:")});callback()},wordCountAndReadingTime:function wordCountAndReadingTime(post,callback){if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}var textContent=post.__contentDOM.textContent.trim();post.word_count=(textContent.replace(/['";:,.?\-!]+/g,"").match(/\S+/g)||[]).length;if(post.word_count>0){post.reading_time=Math.ceil(post.word_count/READING_WORDS_PER_SECOND)}callback()},detectEmbeds:function detectEmbeds(post,callback){if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}var embeds=toArray(post.__contentDOM.querySelectorAll("iframe"));if(!embeds.length){callback();return}post.content_embeds=map(embeds,function(iframe){var node=iframe,embedType=null,aspectRatio=0,width,height,matches;if(iframe.width&&iframe.height){width=Number(iframe.width);height=Number(iframe.height);aspectRatio=Number(iframe.width)/Number(iframe.height)}do{if(!node.className){continue}matches=node.className.match(/\bembed-([-a-zA-Z0-9_]+)\b/);if(matches){embedType=matches[1];break}}while(node=node.parentNode);return{type:embedType,iframe:iframe.outerHTML,aspectRatio:aspectRatio,width:width,height:height}});callback()},disableAutoPlayOnEmbeds:function disableAutoPlayOnEmbeds(post,callback){if(!post.__contentDOM){throw new Error("this transform must be used as part of withContentDOM")}var embeds=toArray(post.__contentDOM.querySelectorAll("iframe"));embeds.forEach(function(embed){var srcUrl=url.parse(embed.src,true,true);if(srcUrl.query){srcUrl.query=stripAutoPlays(srcUrl.query);srcUrl.search=null;embed.src=url.format(srcUrl)}});callback()}};module.exports=normalizePost},757:function(module,exports,__webpack_require__){var $=__webpack_require__(41);module.exports=function defineProperty(it,key,desc){return $.setDesc(it,key,desc)}},762:function(module,exports,__webpack_require__){"use strict";var findIndex=__webpack_require__(683),some=__webpack_require__(57);function parent(node,tree){return find(tree,function(it){return some(it.items,{id:node.id})})||tree}function _traverse(node,filters,root){filters.forEach(function(filter){node=filter(node,root)},this);if(node.items){node.items=node.items.map(function(item){return _traverse(item,filters,root)})}return node}function find(node,predicate){if(predicate(node)){return node}if(node.items){return mapFindAny(node.items,function(node){return find(node,predicate)})}}function replaceItem(node,newNode,predicate){var i;if(!node.items){return}for(i=0;i<node.items.length;i++){if(predicate(node.items[i])){node.items[i]=newNode;return}replaceItem(node.items[i],newNode,predicate)}}function mapFindAny(array,fn){var i,result,length=array.length;for(i=0;i<length;i++){if(result=fn(array[i])){return result}}}function childInserter(srcNode,dstId){return function(node){if(node.id===dstId){node.items=node.items||[];node.items.push(srcNode)}return node}}function siblingInserter(srcNode,dstId,position){return function(node){var index,offset=position==="before"?0:1;if(~(index=findIndex(node.items,{id:dstId}))){node.items.splice(index+offset,0,srcNode)}return node}}module.exports={traverse:function traverse(root,filters){return _traverse(root,filters,root)},parent:parent,find:find,replaceItem:replaceItem,remover:function remover(id){return function(node){var index;if(~(index=findIndex(node.items,{id:id}))){node.items.splice(index,1)}return node}},inserter:function inserter(srcItem,dstId,position){var func="child"===position?childInserter:siblingInserter;return func(srcItem,dstId,position)}}},771:function(module,exports,__webpack_require__){"use strict";var _Object$freeze=__webpack_require__(285)["default"];var assign=__webpack_require__(15),debug=__webpack_require__(1)("calypso:posts:post-edit-store"),emitter=__webpack_require__(10),isEqual=__webpack_require__(96),clone=__webpack_require__(154),filter=__webpack_require__(97),without=__webpack_require__(172),map=__webpack_require__(282),pick=__webpack_require__(153);var Dispatcher=__webpack_require__(30),utils=__webpack_require__(689);var REGEXP_EMPTY_CONTENT=/^<p>(<br[^>]*>|&nbsp;|\s)*<\/p>$/,CONTENT_LENGTH_ASSUME_SET=50;var _initialRawContent=null,_isAutosaving=false,_isLoading=false,_saveBlockers=[],_isNew=false,_loadingError=null,_post=null,_previewUrl=null,_queue=[],_queueChanges=false,_rawContent=null,_savedPost=null,PostEditStore;function resetState(){debug("Reset state");_initialRawContent=null;_isAutosaving=false;_isLoading=false;_saveBlockers=[];_isNew=false;_loadingError=null;_post=null;_previewUrl=null;_queue=[];_queueChanges=false;_rawContent=null;_savedPost=null}function getCategoryIds(post){if(!post||!post.categories){return[]}return map(post.categories,function(category){if(category.ID){return category.ID}return category})}function getParentId(post){if(!post||!post.parent){return null}if(post.parent.ID){return post.parent.ID}return post.parent}function getPageTemplate(post){if(!post||!post.page_template||post.page_template==="default"){return""}return post.page_template}function startEditing(post){resetState();post=normalize(post);_previewUrl=utils.getPreviewURL(post);_savedPost=_Object$freeze(post);_post=_savedPost;_isLoading=false}function updatePost(post){post=normalize(post);_previewUrl=utils.getPreviewURL(post);_savedPost=_Object$freeze(post);_post=_savedPost;_isNew=false;_loadingError=null;_queue.forEach(function(change){set(change)})}function initializeNewPost(siteId,options){var args;options=options||{};args={site_ID:siteId,status:"draft",type:options.postType||"post",title:""};if(options.defaultPostFormat){args.format=options.defaultPostFormat}if(options.defaultCategory){args.categories=[options.defaultCategory]}startEditing(args);_isNew=true}function setLoadingError(error){resetState();_loadingError=error;_isLoading=false}function set(attributes){var updatedPost;if(!_post){return false}if(_queueChanges){_queue.push(attributes)}updatedPost=assign({},_post,attributes);updatedPost=normalize(updatedPost);if(!isEqual(updatedPost,_post)){if(isEqual(updatedPost,_savedPost)){_post=_savedPost}else{_post=_Object$freeze(updatedPost)}return true}return false}function normalize(post){post.category_ids=getCategoryIds(post);post.parent_id=getParentId(post);if(post.type==="page"){post.page_template=getPageTemplate(post)}return post}function setRawContent(content){if(null===_initialRawContent){debug("Set initial raw content to: %s",content);_initialRawContent=content}if(content!==_rawContent){debug("Set raw content to: %s",content);_rawContent=content;PostEditStore.emit("change")}}function isContentEmpty(content){return!content||content.length<CONTENT_LENGTH_ASSUME_SET&&REGEXP_EMPTY_CONTENT.test(content)}function receiveCategory(category){var existingIndex,temporaryId,postCategories;if(!category){return}postCategories=clone(getCategoryIds(_post));temporaryId=category.temporaryId;if(temporaryId){existingIndex=postCategories.indexOf(temporaryId);if(-1!==existingIndex){postCategories.splice(existingIndex,1,category.ID)}}else{postCategories.push(category.ID)}set({categories:postCategories});PostEditStore.emit("change")}function dispatcherCallback(payload){var action=payload.action,changed,category,postId;switch(action.type){case"EDIT_POST":changed=set(action.post);if(changed){PostEditStore.emit("change")}break;case"RESET_POST_RAW_CONTENT":_initialRawContent=null;setRawContent(null);break;case"EDIT_POST_RAW_CONTENT":setRawContent(action.content);break;case"DRAFT_NEW_POST":initializeNewPost(action.siteId,{postType:action.postType,defaultPostFormat:action.defaultPostFormat,defaultCategory:action.defaultCategory});PostEditStore.emit("change");break;case"START_EDITING_POST":resetState();_isLoading=true;PostEditStore.emit("change");break;case"STOP_EDITING_POST":resetState();PostEditStore.emit("change");break;case"RECEIVE_POST_TO_EDIT":_isLoading=false;if(action.error){setLoadingError(action.error)}else{startEditing(action.post)}PostEditStore.emit("change");break;case"BLOCK_EDIT_POST_SAVE":if(-1===_saveBlockers.indexOf(action.key)){_saveBlockers.push(action.key);PostEditStore.emit("change")}break;case"UNBLOCK_EDIT_POST_SAVE":_saveBlockers=without(_saveBlockers,action.key);PostEditStore.emit("change");break;case"EDIT_POST_SAVE":_queueChanges=true;break;case"RECEIVE_UPDATED_POST_BEING_EDITED":if(!action.error){updatePost(action.post);PostEditStore.emit("change")}_queueChanges=false;_queue=[];break;case"POST_AUTOSAVE":_isAutosaving=true;PostEditStore.emit("change");break;case"RECEIVE_POST_AUTOSAVE":_isAutosaving=false;if(!action.error){_previewUrl=action.autosave.preview_URL}PostEditStore.emit("change");break;case"CREATE_TERM":case"RECEIVE_ADD_TERM":if(action.error||!_post||!action.data||!action.siteId||!Array.isArray(action.data.terms)||!action.data.terms.length){break}category=action.data.terms[0];postId=_post.ID;if(action.siteId!==_post.site_ID||category.postId&&category.postId!==postId||action.data.termType!=="categories"){break}receiveCategory(category);break}}PostEditStore={get:function get(){return _post},getSavedPost:function getSavedPost(){return _savedPost},getChangedAttributes:function getChangedAttributes(){var changedAttributes,metadata;if(this.isNew()){return _post}if(!this.isDirty()){return _Object$freeze({})}changedAttributes=pick(_post,function(value,key){return value!==_savedPost[key]&&"metadata"!==key});if(_post.metadata){metadata=filter(_post.metadata,"operation");if(metadata.length){assign(changedAttributes,{metadata:metadata})}}return _Object$freeze(changedAttributes)},getLoadingError:function getLoadingError(){return _loadingError},isDirty:function isDirty(){return _post!==_savedPost||_rawContent!==_initialRawContent},isNew:function isNew(){return _isNew},isLoading:function isLoading(){return _isLoading},isAutosaving:function isAutosaving(){return _isAutosaving},isSaveBlocked:function isSaveBlocked(){return!!_saveBlockers.length},getPreviewUrl:function getPreviewUrl(){return _previewUrl},hasContent:function hasContent(){if(!_post){return false}if(_post.title&&_post.title.trim()||_post.excerpt){return true}if(_rawContent){return!isContentEmpty(_rawContent)}return!isContentEmpty(_post.content)}};emitter(PostEditStore);PostEditStore.dispatchToken=Dispatcher.register(dispatcherCallback);module.exports=PostEditStore},773:function(module,exports,__webpack_require__){"use strict";var Traverser=__webpack_require__(762);function TreeConvert(key){if(!(this instanceof TreeConvert)){return new TreeConvert(key)}this.key=key||"id"}TreeConvert.prototype.treeify=function(items){var tree=[],indexedNodes={};items.forEach(function(item,i){indexedNodes[items[i][this.key]]=item},this);items.forEach(function(item){var parentNode;if(item.parent>0&&indexedNodes[item.parent]){parentNode=indexedNodes[item.parent];parentNode.items=parentNode.items||[];parentNode.items.push(item)}else{item.parent=0;tree.push(item)}});this.sortItems(tree);this.removeOrderProperty(tree);return tree};TreeConvert.prototype.untreeify=function(tree,list){list=list||[];tree.forEach(function(item,index){if(item.items){TreeConvert.prototype.untreeify(item.items,list)}item.order=index+1;list.push(item)});return list};TreeConvert.prototype.sortItems=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.sort(function(a,b){return a.order-b.order});return node}])};TreeConvert.prototype.removeOrderProperty=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.forEach(function(item){delete item.order});return node}])};module.exports=TreeConvert},776:function(module,exports,__webpack_require__){"use strict";var store=__webpack_require__(21),debug=__webpack_require__(1)("calypso:stats:mixin-toggle");var analytics=__webpack_require__(12),titlecase=__webpack_require__(289);module.exports=function(){var localValue=Array.prototype.slice.call(arguments).pop();return{getInitialState:function getInitialState(){if(this.props.site){var localKey="statsHide"+this.props.site.ID,hiddenSiteModules=store.get(localKey)||[],localStorageValue=this.props.path||localValue;return{showModule:(hiddenSiteModules.indexOf(localStorageValue)<0||this.props.summary)&&!this.props.defaultClosed}}else{return{showModule:!this.props.defaultClosed,showInfo:false}}},toggleInfo:function toggleInfo(event){event.stopPropagation();event.preventDefault();var gaEvent=this.state.showInfo?"Closed":"Opened";if(this.props.path){analytics.ga.recordEvent("Stats",gaEvent+" More Information Panel",titlecase(this.props.path))}this.setState({showInfo:!this.state.showInfo,showModule:this.state.showModule})},toggleModule:function toggleModule(event){event.preventDefault();var localKey="statsHide"+this.props.site.ID,localStorageValue=this.props.path||localValue,hiddenSiteModules=store.get(localKey)||[],showInfo=this.state.showInfo,gaEvent=this.state.showModule?"Collapsed":"Expanded",newState;newState={showModule:!this.state.showModule,showInfo:showInfo};analytics.ga.recordEvent("Stats",gaEvent+" Module",titlecase(this.props.path));if(this.props.summary){return true}else{if(this.state.showModule){hiddenSiteModules.push(localStorageValue)}else{hiddenSiteModules=hiddenSiteModules.filter(function(displayName){return localStorageValue!==displayName},this)}debug("hiddensitemodules",hiddenSiteModules);store.set(localKey,hiddenSiteModules);this.setState(newState)}}}}},779:function(module,exports){function arrayExtremum(array,iteratee,comparator,exValue){var index=-1,length=array.length,computed=exValue,result=computed;while(++index<length){var value=array[index],current=+iteratee(value);if(comparator(current,computed)){computed=current;result=value}}return result}module.exports=arrayExtremum},780:function(module,exports,__webpack_require__){var baseEach=__webpack_require__(45);function baseExtremum(collection,iteratee,comparator,exValue){var computed=exValue,result=computed;baseEach(collection,function(value,index,collection){var current=+iteratee(value,index,collection);if(comparator(current,computed)||current===exValue&&current===result){computed=current;result=value}});return result}module.exports=baseExtremum},781:function(module,exports,__webpack_require__){var arrayExtremum=__webpack_require__(779),baseCallback=__webpack_require__(32),baseExtremum=__webpack_require__(780),isArray=__webpack_require__(8),isIterateeCall=__webpack_require__(27),toIterable=__webpack_require__(740);function createExtremum(comparator,exValue){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=undefined}iteratee=baseCallback(iteratee,thisArg,3);if(iteratee.length==1){collection=isArray(collection)?collection:toIterable(collection);var result=arrayExtremum(collection,iteratee,comparator,exValue);if(!(collection.length&&result===exValue)){return result}}return baseExtremum(collection,iteratee,comparator,exValue)}}module.exports=createExtremum},782:function(module,exports){function gt(value,other){return value>other}module.exports=gt},783:function(module,exports,__webpack_require__){var createExtremum=__webpack_require__(781),gt=__webpack_require__(782);var NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;var max=createExtremum(gt,NEGATIVE_INFINITY);module.exports=max},784:function(module,exports,__webpack_require__){var arrayEach=__webpack_require__(111),baseCallback=__webpack_require__(32),baseCreate=__webpack_require__(112),baseForOwn=__webpack_require__(104),isArray=__webpack_require__(8),isFunction=__webpack_require__(161),isObject=__webpack_require__(17),isTypedArray=__webpack_require__(113);function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=baseCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}module.exports=transform},810:function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(73)["default"];var intersection=__webpack_require__(826);var sites=__webpack_require__(23)(),Dispatcher=__webpack_require__(30);var _cache={},TTL_IN_MS=5*60*1e3;function isStale(list){var now=(new Date).getTime(),timeSaved=list.timeSaved;return now-timeSaved>TTL_IN_MS}function getCacheKey(options){var cacheKey="",keys=_Object$keys(options).sort();keys.forEach(function(key){if(cacheKey.length){cacheKey+=":"}cacheKey+=key+"-"+options[key]});return cacheKey}function get(query){var key=getCacheKey(query);if(_cache[key]&&!isStale(_cache[key])&&!_cache[key].dirty){return _cache[key].list}if(_cache[key]&&_cache[key].dirty){delete _cache[key]}}function set(list){var key=getCacheKey(list.query);if(!_cache[key]||!_cache[key].dirty){_cache[key]={timeStored:(new Date).getTime(),list:list,dirty:false}}}function markDirty(post,oldStatus){var site=sites.getSite(post.site_ID),affectedSites=[site.slug,site.ID,false],affectedStatuses=[post.status,oldStatus],listStatuses,key,entry,list;for(key in _cache){if(!_cache.hasOwnProperty(key)){continue}entry=_cache[key];list=entry.list;if(list.query.type!==post.type){continue}if(-1===affectedSites.indexOf(list.query.siteID)){continue}listStatuses=list.query.status.split(",");if(intersection(listStatuses,affectedStatuses).length===0){continue}entry.dirty=true}}var PostsListCache={get:get};PostsListCache.dispatchToken=Dispatcher.register(function(payload){var action=payload.action,PostListStore=__webpack_require__(721);Dispatcher.waitFor([PostListStore.dispatchToken]);switch(action.type){case"FETCH_NEXT_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_UPDATED_POSTS":set(PostListStore.get());break;case"RECEIVE_UPDATED_POST":case"RECEIVE_UPDATED_POST_BEING_EDITED":if(action.post){markDirty(action.post,action.original?action.original.status:null);set(PostListStore.get())}break}});module.exports=PostsListCache},826:function(module,exports,__webpack_require__){var baseIndexOf=__webpack_require__(109),cacheIndexOf=__webpack_require__(181),createCache=__webpack_require__(182),isArrayLike=__webpack_require__(33),restParam=__webpack_require__(44);var intersection=restParam(function(arrays){var othLength=arrays.length,othIndex=othLength,caches=Array(length),indexOf=baseIndexOf,isCommon=true,result=[];while(othIndex--){var value=arrays[othIndex]=isArrayLike(value=arrays[othIndex])?value:[];caches[othIndex]=isCommon&&value.length>=120?createCache(othIndex&&value):null}var array=arrays[0],index=-1,length=array?array.length:0,seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){var othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if((cache?cacheIndexOf(cache,value):indexOf(arrays[othIndex],value,0))<0){continue outer}}if(seen){seen.push(value)}result.push(value)}}return result});module.exports=intersection},841:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:stats:mixin-skeleton");module.exports=function(dataFn){return{getInitialState:function getInitialState(){var loading=this[dataFn].call()?false:true;return{loading:loading}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var data=this[dataFn].call(nextProps);debug("skeleton found data",data);this.setState({loading:!data})}}}},842:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:list");var StatsListItem=__webpack_require__(1531);module.exports=React.createClass({displayName:"StatsList",getInitialState:function getInitialState(){return{activeGroups:[]}},isGroupActive:function isGroupActive(groupName){return this.state.activeGroups.indexOf(groupName)>=0},clickHandler:function clickHandler(event,data){debug("clickHandler");if("function"===typeof this.props.clickHandler){this.props.clickHandler(event,data)}},buildLists:function buildLists(groups,parentKey){var results,listClass=classNames("module-content-list",{"module-content-list-sublist":parentKey,"is-expanded":this.isGroupActive(parentKey)});results=groups.map(function(group,groupIndex){var childResults,active,groupTree=parentKey?[parentKey]:[],groupKey,clickHandler=this.props.clickHandler?this.props.clickHandler:false;groupTree.push(groupIndex);groupKey=groupTree.join(":");active=this.isGroupActive(groupKey);if(group.children){childResults=this.buildLists(group.children,groupKey)}return React.createElement(StatsListItem,{moduleName:this.props.moduleName,data:group,active:active,children:childResults,key:groupKey,itemClickHandler:clickHandler,followList:this.props.followList})},this);return React.createElement("ul",{className:listClass},results)},render:function render(){var list=this.buildLists(this.props.data);return list}})},869:function(module,exports){"use strict";module.exports={RECEIVE_TOTAL_POST_VIEWS:"RECEIVE_TOTAL_POST_VIEWS",API_CALL_LIMIT_MS:3e4,TTL_IN_SECONDS:300,TTL_FUZZ_IN_SECONDS:60}},879:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);module.exports=React.createClass({displayName:"StatModuleError",render:function render(){var panelClassOptions={},message=this.props.message||this.translate("Some stats didn't load in time. Please try again later.");panelClassOptions[this.props.className]=true;return React.createElement("div",{className:classNames("module-content-text","is-error",panelClassOptions)},React.createElement("p",null,message))}})},880:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var SectionNav=__webpack_require__(700),NavTabs=__webpack_require__(685),NavItem=__webpack_require__(684),siteStatsStickyTabActions=__webpack_require__(336);module.exports=React.createClass({displayName:"exports",propTypes:{section:React.PropTypes.string.isRequired,site:React.PropTypes.object},componentDidMount:function componentDidMount(){var slug=this.props.site?this.props.site.slug:"";siteStatsStickyTabActions.saveFilterAndSlug(this.props.section,slug)},componentDidUpdate:function componentDidUpdate(){var slug=this.props.site?this.props.site.slug:"";siteStatsStickyTabActions.saveFilterAndSlug(this.props.section,slug)},render:function render(){var activeSection=this.props.section,siteFragment=this.props.site?"/"+this.props.site.slug:"",sectionTitles={insights:this.translate("Insights"),day:this.translate("Days"),week:this.translate("Weeks"),month:this.translate("Months"),year:this.translate("Years")};return React.createElement(SectionNav,{selectedText:sectionTitles[activeSection]},React.createElement(NavTabs,{label:this.translate("Stats")},React.createElement(NavItem,{path:"/stats/insights"+siteFragment,selected:activeSection==="insights"
},sectionTitles.insights),React.createElement(NavItem,{path:"/stats/day"+siteFragment,selected:activeSection==="day"},sectionTitles.day),React.createElement(NavItem,{path:"/stats/week"+siteFragment,selected:activeSection==="week"},sectionTitles.week),React.createElement(NavItem,{path:"/stats/month"+siteFragment,selected:activeSection==="month"},sectionTitles.month),React.createElement(NavItem,{path:"/stats/year"+siteFragment,selected:activeSection==="year"},sectionTitles.year)))}})},885:function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(73)["default"];var Emitter=__webpack_require__(10),debug=__webpack_require__(1)("calypso:stats-list");var wpcom=__webpack_require__(20),LocalList=__webpack_require__(1322),statsParser=__webpack_require__(1727)(),analytics=__webpack_require__(12);var responseHandler,buildExportArray,trackExtraStats=false,documentedEndpoints=["statsVideo","statsPublicize","statsStreak","statsFollowers","statsCommentFollowers","statsTopAuthors","statsTags","statsComments","statsPostViews","statsVideoPlays","stats","statsVisits","statsReferrers","statsTopPosts","statsClicks","statsCountryViews","statsSearchTerms"],undocumentedEndpoints=["statsEvents","statsInsights"];responseHandler=function(){return function(error,data){var parsedData=data,timeSpent,timeGroup;debug("new payload",data);if(error){if(this.performRetry){this.performRetry=false;if(trackExtraStats){analytics.mc.bumpStat("calypso_stats_retries",this.statType)}this.fetch()}else{debug("encountered an api error",error);this.error=error;this.loading=false;this.emit("change");analytics.mc.bumpStat("calypso_stats_errors",this.statType)}return}if(this.startedAt&&trackExtraStats){timeSpent=Date.now()-this.startedAt;if(timeSpent<1e3){timeGroup="0-1"}else if(timeSpent<2e3){timeGroup="1-2"}else if(timeSpent<3e3){timeGroup="2-3"}else if(timeSpent<6e3){timeGroup="3-6"}else if(timeSpent<9e3){timeGroup="6-9"}else{timeGroup="9plus"}analytics.mc.bumpStat("calypso_stats_"+this.statType.replace(/^stats/,""),timeGroup)}this.loading=false;if("function"===typeof statsParser[this.statType]){parsedData=statsParser[this.statType].call(this,data)}if(this.isEmpty()&&trackExtraStats){analytics.mc.bumpStat("calypso_stats_empty",this.statType.replace(/^stats/,""))}this.local.set(this.localKey,parsedData);this.response=parsedData;debug("updated data",this);this.emit("change")}};buildExportArray=function(data,parent){var exportData=[],label=parent?parent+" > "+data.label:data.label,escapedLabel;escapedLabel=label.replace(/\"/,'""');exportData.push(['"'+escapedLabel+'"',data.value]);if(data.children){var childData=data.children.map(function(child){return buildExportArray(child,label)});childData=childData.concat.apply([],childData);exportData=exportData.concat(childData)}return exportData};function StatsList(options){if(!(this instanceof StatsList)){return new StatsList(options)}if("number"!==typeof options.siteID){throw new TypeError("options.siteID must be a number")}if(undocumentedEndpoints.indexOf(options.statType)===-1&&documentedEndpoints.indexOf(options.statType)===-1){throw new TypeError("options.statType must be one of the following: "+undocumentedEndpoints.concat(documentedEndpoints).join(", "))}["siteID","statType"].forEach(function(attr){this[attr]=options[attr];delete options[attr]},this);this.options=options;this.response={data:[]};this.error=null;this.loading=true;this.performRetry=true;this.startedAt=null;this.isDocumentedEndpoint=documentedEndpoints.indexOf(this.statType)>=0;this.localStoreKey=this.statType+this.siteID;this.local=new LocalList({localStoreKey:this.localStoreKey});this.localKey=_Object$keys(this.options).map(function(key){return this.options[key]},this).join(":");var localData=this.local.find(this.localKey);if(localData&&!Array.isArray(localData)){debug("local cached found",localData.data);this.loading=false;this.response=localData.data}this.fetch();return this}StatsList.prototype.fetch=function(){var wpcomSite,options=this.options,postIdEndpoints=["statsVideo","statsPostViews"];if(this.isDocumentedEndpoint){wpcomSite=wpcom.site(this.siteID)}else{wpcomSite=wpcom.undocumented().site(this.siteID)}if(postIdEndpoints.indexOf(this.statType)>=0){options=this.options.post}this.startedAt=Date.now();wpcomSite[this.statType].call(wpcomSite,options,responseHandler(this.options).bind(this))};StatsList.prototype.isLoading=function(){return this.loading||0===this.siteID};StatsList.prototype.isError=function(){return!!this.error&&0!==this.siteID};StatsList.prototype.isEmpty=function(dataAttribute){if(this.response.data instanceof Array){return!this.isLoading()&&this.response.data.length===0}else if(dataAttribute&&this.response.data&&this.response.data[dataAttribute]){return!this.isLoading()&&this.response.data[dataAttribute].length===0}};StatsList.prototype.csvData=function(){var csvData=[],data=this.response.data.map(function(item){return buildExportArray(item)});return csvData.concat.apply([],data)};Emitter(StatsList.prototype);module.exports=StatsList},901:function(module,exports,__webpack_require__){"use strict";var FollowListSite=__webpack_require__(1253);function FollowList(){if(!(this instanceof FollowList)){return new FollowList}this.data=[]}FollowList.prototype.add=function(object){var site=this.siteExists(object.site_id);if(!site){site=new FollowListSite(object);this.data.push(site)}return site};FollowList.prototype.siteExists=function(site_id){var match=this.data.filter(function(followListSite){return followListSite.site_id===site_id});return match.length?match[0]:false};module.exports=FollowList},922:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),debug=__webpack_require__(1)("calypso:stats:module-date-picker");module.exports=React.createClass({displayName:"StatsModuleDatePicker",dateForDisplay:function dateForDisplay(){var date=this.moment(this.props.date),formattedDate="";switch(this.props.period){case"week":formattedDate=this.translate("%(startDate)s - %(endDate)s",{context:"Date range for which stats are being displayed",args:{startDate:date.startOf("week").add(1,"d").format("LL"),endDate:date.endOf("week").add(1,"d").format("LL")}});break;case"month":formattedDate=date.format("MMMM YYYY");break;case"year":formattedDate=date.format("YYYY");break;default:formattedDate=date.format("LL")}return formattedDate},render:function render(){debug("Rendering stats date picker");var date=this.dateForDisplay(),period=React.createElement("span",{className:"period"},React.createElement("span",{className:"date"},date)),sectionTitle,dateDisplay;sectionTitle=this.translate("Stats for {{period/}}",{components:{period:period},context:"Stats: Main stats page heading",comment:'Example: "Stats for December 7", "Stats for December 8 - December 14", "Stats for December", "Stats for 2014"'});if(this.props.summary){dateDisplay=React.createElement("h4",{className:"module-header-title",key:"header-title"},sectionTitle)}else{dateDisplay=React.createElement("h3",{className:"stats-section-title"},sectionTitle)}return dateDisplay}})},923:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),page=__webpack_require__(13),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module");var toggle=__webpack_require__(776),skeleton=__webpack_require__(841),observe=__webpack_require__(42),ErrorPanel=__webpack_require__(879),InfoPanel=__webpack_require__(1517),StatsList=__webpack_require__(842),DownloadCsv=__webpack_require__(1130),DatePicker=__webpack_require__(922),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModule",mixins:[toggle(),skeleton("data"),observe("dataList")],data:function data(){return this.props.dataList.response.data},getInitialState:function getInitialState(){return{noData:this.props.dataList.isEmpty()}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.dataList.isEmpty()})},hasSummaryPage:function hasSummaryPage(){var noSummaryPages=["tags-categories","publicize"];return-1===noSummaryPages.indexOf(this.props.path)},viewAllHandler:function viewAllHandler(event){var summaryPageLink="/stats/"+this.props.period.period+"/"+this.props.path+"/"+this.props.site.slug+"?startDate="+this.props.date;event.preventDefault();if(this.props.beforeNavigate){this.props.beforeNavigate()}page(summaryPageLink)},render:function render(){debug("rendering stats module");var data=this.data(),noData=this.props.dataList.isEmpty(),statsList,hasError=this.props.dataList.isError(),moduleHeaderTitle,headerLink=this.props.moduleStrings.title,viewSummary,moduleToggle,classes;classes=classNames("stats-module",{"is-expanded":this.state.showModule,"is-loading":this.props.dataList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":noData,"is-showing-error":hasError||noData});statsList=React.createElement(StatsList,{moduleName:this.props.path,data:data,followList:this.props.followList});if(this.hasSummaryPage()){headerLink=React.createElement("a",{href:"#",onClick:this.viewAllHandler},this.props.moduleStrings.title)}if(!this.props.summary){moduleHeaderTitle=React.createElement("h4",{className:"module-header-title"},headerLink);moduleToggle=React.createElement("li",{className:"module-header-action toggle-services"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),title:this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleModule},React.createElement("span",{className:"noticon"})));if(this.props.dataList.response.viewAll){viewSummary=React.createElement("div",{key:"view-all",className:"module-expand"},React.createElement("a",{href:"#",onClick:this.viewAllHandler},this.translate("View All",{context:"Stats: Button label to expand a panel"}),React.createElement("span",{className:"right"})))}}else{moduleHeaderTitle=React.createElement(DatePicker,{period:this.props.period.period,date:this.props.period.startOf,summary:true})}return React.createElement(Card,{className:classes},React.createElement("div",{className:this.props.className},React.createElement("div",{className:"module-header"},moduleHeaderTitle,React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))),moduleToggle)),React.createElement("div",{className:"module-content"},React.createElement(InfoPanel,{module:this.props.path}),noData&&!hasError?React.createElement(ErrorPanel,{className:"is-empty-message",message:this.props.moduleStrings.empty}):null,hasError?React.createElement(ErrorPanel,{className:"network-error"}):null,React.createElement("div",{className:"stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.props.moduleStrings.value)),React.createElement("span",{className:"module-content-list-item-label"},this.props.moduleStrings.item)))),React.createElement("div",{className:"module-placeholder is-void"}),statsList),this.props.summary?React.createElement(DownloadCsv,{period:this.props.period,path:this.props.path,site:this.props.site,dataList:this.props.dataList}):null),viewSummary))}})},924:function(module,exports,__webpack_require__){"use strict";var i18n=__webpack_require__(16);module.exports=function(){var statsStrings={};statsStrings.posts={title:i18n.translate("Posts & Pages",{context:"Stats: title of module"}),item:i18n.translate("Title",{context:"Stats: module row header for post title."}),value:i18n.translate("Views",{context:"Stats: module row header for number of post views."}),empty:i18n.translate("No posts or pages viewed",{context:"Stats: Info box label when the Posts & Pages module is empty"})};statsStrings.referrers={title:i18n.translate("Referrers",{context:"Stats: title of module"}),item:i18n.translate("Referrer",{context:"Stats: module row header for post referrer."}),value:i18n.translate("Views",{context:"Stats: module row header for number of post views by referrer."}),empty:i18n.translate("No referrers recorded",{context:"Stats: Info box label when the Referrers module is empty"})};statsStrings.clicks={title:i18n.translate("Clicks",{context:"Stats: title of module"}),item:i18n.translate("Link",{context:"Stats: module row header for links in posts."}),value:i18n.translate("Clicks",{context:"Stats: module row header for number of clicks on a given link in a post."}),empty:i18n.translate("No clicks recorded",{context:"Stats: Info box label when the Clicks module is empty"})};statsStrings.search={title:i18n.translate("Search Terms",{context:"Stats: title of module"}),item:i18n.translate("Search Term",{context:"Stats: module row header for search in search terms."}),value:i18n.translate("Views",{context:"Stats: module row header for views of a given search in search terms."}),empty:i18n.translate("No search terms recorded",{context:"Stats: Info box label when the Search Terms module is empty"})};statsStrings.authors={title:i18n.translate("Authors",{context:"Stats: title of module"}),item:i18n.translate("Author",{context:"Stats: module row header for authors."}),value:i18n.translate("Views",{context:"Stats: module row header for number of views per author."}),empty:i18n.translate("No posts or pages viewed",{context:"Stats: Info box label when the Authors module is empty"})};statsStrings.videoplays={title:i18n.translate("Videos",{context:"Stats: title of module"}),item:i18n.translate("Video",{context:"Stats: module row header for videos."}),value:i18n.translate("Plays",{context:"Stats: module row header for number of plays per video."}),empty:i18n.translate("No videos played",{context:"Stats: Info box label when the Videos module is empty"})};statsStrings.tags={title:i18n.translate("Tags & Categories",{context:"Stats: title of module"}),item:i18n.translate("Topic",{context:"Stats: module row header for tags and categories."}),value:i18n.translate("Views",{context:"Stats: module row header for number of views per tag or category."}),empty:i18n.translate("No tagged posts or pages viewed",{context:"Stats: Info box label when the Tags module is empty"})};statsStrings.publicize={title:i18n.translate("Publicize",{context:"Stats: title of module"}),item:i18n.translate("Service",{context:"Stats: module row header for publicize service."}),value:i18n.translate("Followers",{context:"Stats: module row header for number of followers on the service."}),empty:i18n.translate("No publicize followers recorded",{context:"Stats: Info box label when the publicize module is empty"})};return statsStrings}},947:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),PureRenderMixin=React.addons.PureRenderMixin,punycode=__webpack_require__(349);var baseCDNUrl="//s0.wp.com/wp-content/mu-plugins/emoji/twemoji/";module.exports=React.createClass({displayName:"exports",mixins:[PureRenderMixin],propTypes:{children:React.PropTypes.string.isRequired,size:React.PropTypes.oneOf(["16x16","36x36","72x72"])},getDefaultProps:function getDefaultProps(){return{size:"36x36"}},isEmojiCode:function isEmojiCode(charCode){return charCode>=127744&&charCode<=128511||charCode>=128512&&charCode<=128591||charCode>=128640&&charCode<=128767||charCode>=9728&&charCode<=9983},emojiTransform:function emojiTransform(text){var decoded,entries=[];if(null===text){return null}decoded=punycode.ucs2.decode(text);decoded.forEach(function(charCode,idx){var hexCode,lastIdx,src,char;if(this.isEmojiCode(charCode)){hexCode=charCode.toString(16);src=encodeURI(baseCDNUrl+this.props.size+"/"+hexCode+".png");entries.push(React.createElement("img",{className:"emojified__emoji",src:src,key:idx,alt:"U+"+hexCode}))}else{char=punycode.ucs2.encode([charCode]);lastIdx=entries.length-1;if(typeof entries[lastIdx]==="string"){entries[lastIdx]+=char}else{entries.push(char)}}},this);return entries},render:function render(){return React.createElement("span",null,this.emojiTransform(this.props.children))}})},981:function(module,exports,__webpack_require__){"use strict";var wpcom=__webpack_require__(20),Dispatcher=__webpack_require__(30);var constants=__webpack_require__(869),_fetching={};function getStatKey(stat,siteId,postId){return stat+"|"+siteId+"|"+postId}function receiveTotalViews(siteId,postId,error,data){var key=getStatKey("totalViews",siteId,postId);delete _fetching[key];Dispatcher.handleServerAction({type:constants.RECEIVE_TOTAL_POST_VIEWS,siteId:siteId,postId:postId,error:error,data:data})}function fetch(stat,siteId,postId,force){var key=getStatKey(stat,siteId,postId);if(!force&&isBlocked(key)){return}_fetching[key]=(new Date).getTime();switch(stat){case"totalViews":wpcom.site(siteId).statsPostViews(postId,{fields:"views"},receiveTotalViews.bind(null,siteId,postId));break}}function fetchTotalViews(siteId,postId,force){fetch("totalViews",siteId,postId,force)}function isBlocked(key){return _fetching[key]&&_fetching[key]+constants.API_CALL_LIMIT_MS>(new Date).getTime()}var PostStatsActions={fetchTotalViews:fetchTotalViews};module.exports=PostStatsActions},982:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(30),store=__webpack_require__(21);var Emitter=__webpack_require__(10),actions=__webpack_require__(981),constants=__webpack_require__(869),validStats=["totalViews"],_bySite={};function localStorageKey(stat,siteId,postId){return"PostStatsStore_"+stat+"_"+siteId+"_"+postId}function isStale(timeStampInMs){var now=(new Date).getTime(),rand=Math.random()*constants.TTL_FUZZ_IN_SECONDS-constants.TTL_FUZZ_IN_SECONDS/2;return rand+(now-timeStampInMs)/1e3>constants.TTL_IN_SECONDS}function getCachedItem(stat,siteId,postId){var key,cachedRecord;if(validStats.indexOf(stat)===-1){return false}if(_bySite[siteId]&&_bySite[siteId][postId]&&_bySite[siteId][postId][stat]){return _bySite[siteId][postId][stat]}key=localStorageKey(stat,siteId,postId);cachedRecord=store.get(key);if(!cachedRecord){return}_bySite[siteId]=_bySite[siteId]||{};_bySite[siteId][postId]=_bySite[siteId][postId]||{};_bySite[siteId][postId][stat]=cachedRecord;return cachedRecord}function setItem(stat,siteId,postId,data){if(validStats.indexOf(stat)===-1){return}_bySite[siteId]=_bySite[siteId]||{};_bySite[siteId][postId]=_bySite[siteId][postId]||{};_bySite[siteId][postId][stat]=data;return store.set(localStorageKey(stat,siteId,postId),data)}var postStatsStore={getItem:function getItem(stat,siteId,postId){var cachedRecord;if(validStats.indexOf(stat)===-1){return false}cachedRecord=getCachedItem(stat,siteId,postId);if(!cachedRecord||typeof cachedRecord[stat]==="undefined"||!cachedRecord.updatedAt){actions.fetchTotalViews(siteId,postId);return false}if(isStale(cachedRecord.updatedAt)){actions.fetchTotalViews(siteId,postId)}return cachedRecord[stat]}};Emitter(postStatsStore);postStatsStore.setMaxListeners(100);postStatsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case constants.RECEIVE_TOTAL_POST_VIEWS:if(!action.error&&action.data&&!isNaN(action.data.views)){setItem("totalViews",action.siteId,action.postId,{totalViews:action.data.views,updatedAt:(new Date).getTime()});this.emit("change")}break;default:}return true}.bind(postStatsStore));module.exports=postStatsStore},1018:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-countries");var toggle=__webpack_require__(776),Geochart=__webpack_require__(1516),StatsList=__webpack_require__(842),observe=__webpack_require__(42),ErrorPanel=__webpack_require__(879),skeleton=__webpack_require__(841),DownloadCsv=__webpack_require__(1130),DatePicker=__webpack_require__(922),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleCountries",mixins:[toggle("Countries"),skeleton("data"),observe("dataList")],data:function data(nextProps){var props=nextProps||this.props;return props.dataList.response.data},getInitialState:function getInitialState(){return{noData:this.props.dataList.isEmpty()}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.dataList.isEmpty()})},render:function render(){debug("Rendering stats countries module");var countries,moduleExpand,mapData=[[this.translate("Country").toString(),this.translate("Views").toString()]],data=this.data(),hasError=this.props.dataList.isError(),noData=this.props.dataList.isEmpty(),moduleHeaderTitle,summaryPageLink,viewSummary,geochart,moduleToggle,classes;classes=["stats-module","is-countries",{"is-expanded":this.state.showModule,summary:this.props.summary,"is-loading":this.props.dataList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":noData,"is-showing-error":hasError||noData}];data.forEach(function(country){mapData.push([country.label,country.value])});summaryPageLink="/stats/"+this.props.period.period+"/countryviews/"+this.props.site.slug+"?startDate="+this.props.date;if(!this.props.summary){moduleExpand=React.createElement("div",{key:"other",className:"module-expand"},React.createElement("a",{href:"#"},this.translate("View All"),React.createElement("span",{className:"right"})))}if(!this.props.summary){moduleHeaderTitle=React.createElement("h4",{className:"module-header-title"},React.createElement("a",{href:summaryPageLink},this.translate("Countries")));moduleToggle=React.createElement("li",{className:"module-header-action toggle-services"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),title:this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleModule},React.createElement("span",{className:"noticon"})));if(this.props.dataList.response.viewAll){viewSummary=React.createElement("div",{key:"view-all",className:"module-expand"},React.createElement("a",{href:summaryPageLink},this.translate("View All",{context:"Stats: Button label to expand a panel"}),React.createElement("span",{className:"right"})))}}else{moduleHeaderTitle=React.createElement(DatePicker,{period:this.props.period.period,date:this.props.period.startOf,summary:true})}geochart=React.createElement(Geochart,{data:mapData,dataList:this.props.dataList});countries=React.createElement(StatsList,{moduleName:this.props.path,data:data});return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"countryviews"},React.createElement("div",{className:"module-header"},moduleHeaderTitle,React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))),moduleToggle)),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("Explore the list to see which countries and regions generate the most traffic to your site.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:"http://en.support.wordpress.com/stats/#views-by-country",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"})," ",this.translate("About Countries"))))),noData&&!hasError?React.createElement(ErrorPanel,{className:"is-empty-message",message:this.translate("No countries recorded")}):null,geochart,React.createElement("div",{className:"module-placeholder module-placeholder-block"}),React.createElement("div",{className:"stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.translate("Views"))),React.createElement("span",{className:"module-content-list-item-label"},this.translate("Country"))))),React.createElement("div",{className:"module-placeholder is-void"}),countries),this.props.summary?React.createElement(DownloadCsv,{period:this.props.period,path:this.props.path,site:this.props.site,dataList:this.props.dataList}):null,hasError?React.createElement(ErrorPanel,{className:"network-error"}):null),viewSummary))}})},1064:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),debug=__webpack_require__(1)("calypso:chart"),noop=__webpack_require__(35),throttle=__webpack_require__(308);var BarContainer=__webpack_require__(1186),observe=__webpack_require__(42),touchDetect=__webpack_require__(299);module.exports=React.createClass({displayName:"ModuleChart",mixins:[observe("dataList")],propTypes:{loading:React.PropTypes.bool,data:React.PropTypes.array,minTouchBarWidth:React.PropTypes.number,minBarWidth:React.PropTypes.number,barClick:React.PropTypes.func},getInitialState:function getInitialState(){return{maxBars:100,width:650}},getDefaultProps:function getDefaultProps(){return{minTouchBarWidth:42,minBarWidth:15,barClick:noop}},componentDidMount:function componentDidMount(){this.resize=throttle(this.resize,400);window.addEventListener("resize",this.resize);this.resize()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this.resize)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.loading&&!nextProps.loading){this.resize()}},resize:function resize(){if(this.isMounted()){var node=this.getDOMNode(),width=node.clientWidth-82,maxBars;if(touchDetect.hasTouch()){width=width<=0?350:width;maxBars=Math.floor(width/this.props.minTouchBarWidth)}else{maxBars=Math.floor(width/this.props.minBarWidth)}this.setState({maxBars:maxBars,width:width})}},getYAxisMax:function getYAxisMax(values){var max=Math.max.apply(null,values),operand=Math.pow(10,max.toString().length-1),rounded=Math.ceil((max+1)/operand)*operand;if(rounded<10){rounded=10}return rounded},getData:function getData(){var data=this.props.data;data=data.slice(0-this.state.maxBars);return data},getValues:function getValues(){var data=this.getData();data=data.map(function(item){return item.value},this);return data},isEmptyChart:function isEmptyChart(values){values=values.filter(function(value){return value>0},this);return values.length===0},render:function render(){debug("Rendering chart with props: ",this.props);var values=this.getValues(),yAxisMax=this.getYAxisMax(values),data=this.getData(),emptyChart;if(values.length&&this.isEmptyChart(values)){emptyChart=React.createElement("div",{className:"chart__empty"},React.createElement("span",{className:"notice"},this.translate("No activity this period",{context:"Message on empty bar chart in Stats",comment:"Should be limited to 32 characters to prevent wrapping"})))}return React.createElement("div",{className:"chart"},React.createElement("div",{className:"chart__y-axis-markers"},React.createElement("div",{className:"chart__y-axis-marker is-hundred"}),React.createElement("div",{className:"chart__y-axis-marker is-fifty"}),React.createElement("div",{className:"chart__y-axis-marker is-zero"})),React.createElement("div",{className:"chart__y-axis"},React.createElement("div",{className:"chart__y-axis-width-fix"},this.numberFormat(1e5)),React.createElement("div",{className:"chart__y-axis-label is-hundred"},this.numberFormat(yAxisMax)),React.createElement("div",{className:"chart__y-axis-label is-fifty"},this.numberFormat(yAxisMax/2)),React.createElement("div",{className:"chart__y-axis-label is-zero"},this.numberFormat(0))),React.createElement(BarContainer,{barClick:this.props.barClick,data:data,yAxisMax:yAxisMax,chartWidth:this.state.width,isTouch:touchDetect.hasTouch()}),emptyChart)}})},1065:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2);module.exports=React.createClass({displayName:"ChartTooltip",propTypes:{data:React.PropTypes.array.isRequired},render:function render(){var listItemElements;listItemElements=this.props.data.map(function(options,i){var noticonClasses=["noticon"],wrapperClasses=["module-content-list-item"],noticon;if(options.noticon){noticonClasses.push("noticon-"+options.noticon);noticon=React.createElement("span",{className:noticonClasses.join(" ")})}wrapperClasses.push(options.className);return React.createElement("li",{key:i,className:wrapperClasses.join(" ")},React.createElement("span",{className:"wrapper"},React.createElement("span",{className:"value"},options.value),React.createElement("span",{className:"label"},noticon,options.label)))});return React.createElement("ul",null,listItemElements)}})},1130:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),fileSaver=__webpack_require__(1749);var titlecase=__webpack_require__(289),analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsCsvExport",propTypes:{site:React.PropTypes.object.isRequired,path:React.PropTypes.string.isRequired,period:React.PropTypes.object.isRequired,dataList:React.PropTypes.object.isRequired},downloadCsv:function downloadCsv(event){var csvData,fileName,data=this.props.dataList.csvData(),blob;fileName=[this.props.site.slug,this.props.path,this.props.period.period,this.props.period.startOf.format("L"),this.props.period.endOf.format("L")].join("_")+".csv";event.preventDefault();analytics.ga.recordEvent("Stats","CSV Download "+titlecase(this.props.path));csvData=data.map(function(row){return row.join(",")}).join("\n");blob=new Blob([csvData],{type:"text/csv;charset=utf-8"});fileSaver(blob,fileName)},render:function render(){var downloadLabel,isFileSaverSupported,downloadLink;try{isFileSaverSupported=!!new Blob}catch(e){}if(isFileSaverSupported){downloadLabel=this.translate("Download data as CSV",{context:"Action shown in stats to download data as csv."});downloadLink=React.createElement("div",{className:"module-content-text"},React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.downloadCsv},downloadLabel,React.createElement("span",{className:"noticon noticon-download"})))))}return downloadLink}})},1131:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var ElementChart=__webpack_require__(1064),Legend=__webpack_require__(1189),StatTabs=__webpack_require__(1522),analytics=__webpack_require__(12),observe=__webpack_require__(42),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleChartTabs",mixins:[observe("visitsList","activeTabVisitsList")],getInitialState:function getInitialState(){var activeTab=this.getActiveTab(),activeCharts=activeTab.legendOptions.slice()||[];
return{activeLegendCharts:activeCharts,activeTab:activeTab}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var activeTab=this.getActiveTab(nextProps),activeCharts=activeTab.legendOptions?activeTab.legendOptions.slice():[];if(activeTab!==this.state.activeTab){this.setState({activeLegendCharts:activeCharts,activeTab:activeTab})}},buildTooltipData:function buildTooltipData(item){var tooltipData=[],date=this.moment(item.data.period),dateLabel;switch(this.props.period.period){case"day":dateLabel=date.format("LL");break;case"week":dateLabel=date.format("L")+" - "+date.add(6,"days").format("L");break;case"month":dateLabel=date.format("MMMM YYYY");break;case"year":dateLabel=date.format("YYYY");break}tooltipData.push({label:dateLabel,className:"dateLabel",value:null});switch(this.props.chartTab){case"comments":tooltipData.push({label:this.translate("Comments"),value:this.numberFormat(item.value),noticon:"comment"});break;case"likes":tooltipData.push({label:this.translate("Likes"),value:this.numberFormat(item.value),noticon:"like"});break;default:tooltipData.push({label:this.translate("Views"),value:this.numberFormat(item.data.views),noticon:"show"});tooltipData.push({label:this.translate("Visitors"),value:this.numberFormat(item.data.visitors),noticon:"user"});tooltipData.push({label:this.translate("Views Per Visitor"),value:this.numberFormat(item.data.views/item.data.visitors,{decimals:2}),noticon:"activity"});if(item.data.post_titles&&item.data.post_titles.length){if(item.data.post_titles.length>2){tooltipData.push({label:this.translate("Posts Published"),value:this.numberFormat(item.data.post_titles.length),noticon:"title"})}else{tooltipData.push({label:this.translate("Post Published","Posts Published",{textOnly:true,count:item.data.post_titles.length})+":",className:"published",noticon:"title",value:""});item.data.post_titles.forEach(function(post_title){tooltipData.push({className:"published-item",noticon:"dot",label:post_title})})}}break}return tooltipData},onLegendClick:function onLegendClick(chartItem){var activeLegendCharts=this.state.activeLegendCharts,chartIndex=activeLegendCharts.indexOf(chartItem),gaEvent="Toggled Nested Chart "+chartItem,gaEventAction;if(-1===chartIndex){activeLegendCharts.push(chartItem);gaEventAction=" on"}else{activeLegendCharts.splice(chartIndex);gaEventAction=" off"}analytics.ga.recordEvent("Stats",gaEvent+gaEventAction);this.setState({activeLegendCharts:activeLegendCharts})},getActiveTab:function getActiveTab(nextProps){var props=nextProps||this.props;return props.charts.filter(function(chart){return chart.attr===props.chartTab},this).shift()},buildChartData:function buildChartData(){var chartData,labelKey,dataList="visitsList",activeTab=this.props.chartTab;labelKey="label"+this.props.period.period.charAt(0).toUpperCase()+this.props.period.period.slice(1);if(this.props.visitsList.isLoading()){dataList="activeTabVisitsList"}chartData=this.props[dataList].response.data.map(function(record){var chartDataItem,recordClassName,className,nestedValue;if(record.classNames&&record.classNames.length){recordClassName=record.classNames.join(" ")}if(this.state.activeLegendCharts.length){nestedValue=record[this.state.activeLegendCharts[0]]}className=classNames(recordClassName,{"is-selected":record.period===this.props.queryDate});chartDataItem={label:record[labelKey],value:record[activeTab],nestedValue:nestedValue,className:className,data:record};chartDataItem.tooltipData=this.buildTooltipData(chartDataItem);return chartDataItem},this);return chartData},render:function render(){var data=this.buildChartData(),activeTab=this.getActiveTab(),dataKeys=[this.props.chartTab],visitsList=this.props.visitsList,availableCharts=[],activeTabLoading=this.props.activeTabVisitsList.isLoading()&&this.props.visitsList.isLoading(),classes;classes=["stats-module","is-chart-tabs",{"is-loading":activeTabLoading}];if(visitsList.isLoading()){visitsList=this.props.activeTabVisitsList}if(activeTab.legendOptions){dataKeys=dataKeys.concat(this.state.activeLegendCharts);availableCharts=activeTab.legendOptions}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement(Legend,{tabs:this.props.charts,activeTab:activeTab,availableCharts:availableCharts,activeCharts:this.state.activeLegendCharts,clickHandler:this.onLegendClick}),React.createElement("div",{className:"module-placeholder is-void is-chart"}),React.createElement(ElementChart,{loading:activeTabLoading,data:data,barClick:this.props.barClick}),React.createElement(StatTabs,{dataList:visitsList,tabs:this.props.charts,switchTab:this.props.switchTab,selectedTab:this.props.chartTab,activeIndex:this.props.queryDate,activeKey:"period"}))}})},1132:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-comments");var toggle=__webpack_require__(776),SelectDropdown=__webpack_require__(696),StatsList=__webpack_require__(842),observe=__webpack_require__(42),ErrorPanel=__webpack_require__(879),skeleton=__webpack_require__(841),analytics=__webpack_require__(12),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleComments",mixins:[toggle("Comments"),skeleton("data"),observe("commentsList","commentFollowersList")],data:function data(nextProps){var props=nextProps||this.props;return props.commentsList.response.data.authors},getInitialState:function getInitialState(){return{activeFilter:"top-authors",noData:this.props.commentsList.isEmpty("authors")}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.commentsList.isEmpty("authors")})},changeFilter:function changeFilter(selection){var gaEvent,filter=selection.value;if(filter!==this.state.activeFilter){switch(filter){case"top-authors":gaEvent="Clicked By Authors Comments Toggle";break;case"top-content":gaEvent="Clicked By Posts & Pages Comments Toggle";break}if(gaEvent){analytics.ga.recordEvent("Stats",gaEvent)}this.setState({activeFilter:filter})}},filterSelect:function filterSelect(){var selectFilter,options=[{value:"top-authors",label:this.translate("Comments By Authors")},{value:"top-content",label:this.translate("Comments By Posts & Pages")}];selectFilter=React.createElement("div",{className:"select-dropdown__wrapper"},React.createElement(SelectDropdown,{options:options,onSelect:this.changeFilter}));return selectFilter},render:function render(){var data=this.data(),commentsList=this.props.commentsList,hasError=this.props.commentsList.isError(),noData=this.props.commentsList.isEmpty("authors"),classes,topCommenters,mostCommented,summary,moduleHeaderTitle,moduleToggle,commentFollowers,commentFollowURL,activeTab;activeTab="tab-"+this.state.activeFilter;classes=["stats-module",activeTab,{"is-expanded":this.state.showModule,"is-loading":!data,"is-showing-info":this.state.showInfo,"has-no-data":noData,"is-showing-error":hasError||noData}];debug("Rendering comments with data",classes);debug("data is",this.props.commentsList.data);if(commentsList.response.data&&commentsList.response.data.authors){topCommenters=React.createElement(StatsList,{moduleName:"Top Commenters",data:commentsList.response.data.authors,followList:this.props.followList})}if(commentsList.response.data&&commentsList.response.data.posts){mostCommented=React.createElement(StatsList,{moduleName:"Most Commented",data:commentsList.response.data.posts})}if(data&&data.monthly_comments){summary=React.createElement("div",{className:"module-content-text"},React.createElement("p",null,this.translate("Average comments per month:")," ",this.numberFormat(data.monthly_comments)))}if(!this.props.summary){moduleToggle=React.createElement("li",{className:"module-header-action toggle-services"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),title:this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleModule},React.createElement("span",{className:"noticon"})))}if(this.props.commentFollowersList.response.data&&this.props.commentFollowersList.response.data.total){commentFollowURL="/stats/follows/comment/"+this.props.site.slug;commentFollowers=React.createElement("div",{className:"module-content-text module-content-text-stat"},React.createElement("p",null,this.translate("Total posts with comment followers:")," ",React.createElement("a",{href:commentFollowURL},this.numberFormat(this.props.commentFollowersList.response.data.total))))}moduleHeaderTitle=React.createElement("h4",{className:"module-header-title"},this.translate("Comments"));return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",null,React.createElement("div",{className:"module-header"},moduleHeaderTitle,React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))),moduleToggle)),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("If you allow comments on your site, track your top commenters and discover what content sparks the liveliest conversations, based on the most recent 1,000 comments.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:"http://en.support.wordpress.com/enable-disable-comments/",target:"_blank"},React.createElement("span",{className:"noticon noticon-help"})," ",this.translate("How do I turn on/off comments?"))),React.createElement("li",null,React.createElement("a",{href:"http://en.support.wordpress.com/category/comments/",target:"_blank"},React.createElement("span",{className:"noticon noticon-book"})," ",this.translate("About Comments"))))),noData&&!hasError?React.createElement(ErrorPanel,{className:"is-empty-message",message:this.translate("No comments posted")}):null,this.filterSelect(),commentFollowers,hasError?React.createElement(ErrorPanel,{className:"network-error"}):null,React.createElement("div",{className:"tab-content top-authors stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.translate("Comments"))),React.createElement("span",{className:"module-content-list-item-label"},this.translate("Author"))))),topCommenters),React.createElement("div",{className:"tab-content top-content stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.translate("Comments"))),React.createElement("span",{className:"module-content-list-item-label"},this.translate("Title"))))),mostCommented),summary,React.createElement("div",{className:"module-placeholder is-void"}))))}})},1133:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-followers");var toggle=__webpack_require__(776),SelectDropdown=__webpack_require__(696),StatsList=__webpack_require__(842),observe=__webpack_require__(42),ErrorPanel=__webpack_require__(879),skeleton=__webpack_require__(841),analytics=__webpack_require__(12),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleFollowers",mixins:[toggle("Followers"),skeleton("data"),observe("wpcomFollowersList","emailFollowersList")],data:function data(list){if(list&&this.props[list]){return this.props[list].response.data}},getInitialState:function getInitialState(){return{activeFilter:"wpcom-followers",noData:this.props.wpcomFollowersList.isEmpty("subscribers")&&this.props.emailFollowersList.isEmpty("subscribers")}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.wpcomFollowersList.isEmpty("subscribers")&&nextProps.emailFollowersList.isEmpty("subscribers")})},changeFilter:function changeFilter(selection){var gaEvent,filter=selection.value;if(filter!==this.state.activeFilter){switch(filter){case"wpcom-followers":gaEvent="Clicked By WordPress.com Followers Toggle";break;case"email-followers":gaEvent="Clicked Email Followers Toggle";break}if(gaEvent){analytics.ga.recordEvent("Stats",gaEvent)}this.setState({activeFilter:filter})}},filterSelect:function filterSelect(){var selectFilter,options=[{value:"wpcom-followers",label:this.translate("WordPress.com Followers")},{value:"email-followers",label:this.translate("Email Followers")}];if(!this.props.wpcomFollowersList.isEmpty("subscribers")&&!this.props.emailFollowersList.isEmpty("subscribers")){selectFilter=React.createElement("div",{className:"select-dropdown__wrapper"},React.createElement(SelectDropdown,{options:options,onSelect:this.changeFilter}))}return selectFilter},render:function render(){debug("Rendering stats followers module");var wpcomData=this.data("wpcomFollowersList"),emailData=this.data("emailFollowersList"),noData=this.props.wpcomFollowersList.isEmpty("subscribers")&&this.props.emailFollowersList.isEmpty("subscribers"),hasError=this.props.wpcomFollowersList.isError()||this.props.emailFollowersList.isError(),wpcomFollowers,emailFollowers,wpcomTotalFollowers,emailTotalFollowers,moduleHeaderTitle,moduleToggle,summaryPageLink,viewSummary,activeFilter,activeFilterClass,classes;activeFilter=this.state.activeFilter;if(this.props.wpcomFollowersList.isEmpty("subscribers")){activeFilter="email-followers"}activeFilterClass="tab-"+activeFilter;classes=["stats-module","is-followers",activeFilterClass,{"is-expanded":this.state.showModule,"is-loading":this.props.wpcomFollowersList.isLoading()||this.props.emailFollowersList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":noData,"is-showing-error":hasError||noData}];if("email-followers"===activeFilter){summaryPageLink="/stats/follows/email/"+this.props.site.slug}else{summaryPageLink="/stats/follows/wpcom/"+this.props.site.slug}if(wpcomData&&wpcomData.subscribers){wpcomFollowers=React.createElement(StatsList,{moduleName:"wpcomFollowers",data:wpcomData.subscribers,followList:this.props.followList})}if(emailData&&emailData.subscribers){emailFollowers=React.createElement(StatsList,{moduleName:"EmailFollowers",data:emailData.subscribers})}if(wpcomData&&wpcomData.total){wpcomTotalFollowers=React.createElement("p",null,this.translate("Total WordPress.com Followers"),": ",this.numberFormat(wpcomData.total))}if(emailData&&emailData.total){emailTotalFollowers=React.createElement("p",null,this.translate("Total Email Followers"),": ",this.numberFormat(emailData.total))}if(!this.props.summary){moduleToggle=React.createElement("li",{className:"module-header-action toggle-services"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),title:this.translate("Expand or collapse panel",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleModule},React.createElement("span",{className:"noticon"})))}moduleHeaderTitle=React.createElement("h4",{className:"module-header-title"},React.createElement("a",{href:summaryPageLink},this.translate("Followers")));if(wpcomData&&wpcomData.viewAll||emailData&&emailData.viewAll){viewSummary=React.createElement("div",{key:"view-all",className:"module-expand"},React.createElement("a",{href:summaryPageLink},this.translate("View All",{context:"Stats: Button label to expand a panel"}),React.createElement("span",{className:"right"})))}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"followers"},React.createElement("div",{className:"module-header"},moduleHeaderTitle,React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))),moduleToggle)),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("Keep track of your overall number of followers, and how long each one has been following your site.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:"http://en.support.wordpress.com/followers/",target:"_blank"},React.createElement("span",{className:"noticon noticon-book"})," ",this.translate("About Followers"))))),noData&&!hasError?React.createElement(ErrorPanel,{className:"is-empty-message",message:this.translate("No followers")}):null,this.filterSelect(),React.createElement("div",{className:"tab-content wpcom-followers stats-async-metabox-wrapper"},React.createElement("div",{className:"module-content-text module-content-text-stat"},wpcomTotalFollowers),React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.translate("Since"))),React.createElement("span",{className:"module-content-list-item-label"},this.translate("Follower"))))),wpcomFollowers,this.props.wpcomFollowersList.isError()?React.createElement(ErrorPanel,{className:"is-error"}):null),React.createElement("div",{className:"tab-content email-followers stats-async-metabox-wrapper"},React.createElement("div",{className:"module-content-text module-content-text-stat"},emailTotalFollowers),React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},this.translate("Since"))),React.createElement("span",{className:"module-content-list-item-label"},this.translate("Follower"))))),emailFollowers,this.props.emailFollowersList.isError()?React.createElement(ErrorPanel,{className:"network-error"}):null),React.createElement("div",{className:"module-placeholder is-void"})),viewSummary))}})},1134:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsOverviewPlaceholder",propTypes:{insights:React.PropTypes.bool},render:function render(){var icon=null;if(!this.props.insights){icon=React.createElement("div",{className:"site-icon"},React.createElement("img",{width:"22",height:"22"}))}return React.createElement(Card,{className:"stats-module is-loading"},React.createElement("div",{className:"module-header"},React.createElement("h3",{className:"module-header-title"},React.createElement("a",{href:"#",className:"module-header__link"},React.createElement("div",{className:"module-header__site-icon"},React.createElement("img",{width:"22",height:"22"})),React.createElement("span",{className:"module-header__right-icon"},React.createElement("span",{className:"noticon noticon-milestone"})),React.createElement("span",null,this.translate("Loading Stats"))))),React.createElement("ul",{className:"module-tabs"},React.createElement("li",{className:"module-tab is-views is-loading"},React.createElement("a",{href:"#"},React.createElement("span",{className:"noticon noticon-show"}),React.createElement("span",{className:"label"},"Views")," ",React.createElement("span",{className:"value"},""))),React.createElement("li",{className:"module-tab is-visitors is-loading"},React.createElement("a",{href:"#"},React.createElement("span",{className:"noticon noticon-user"}),React.createElement("span",{className:"label"},"Visitors")," ",React.createElement("span",{className:"value"},""))),React.createElement("li",{className:"module-tab is-likes is-loading"},React.createElement("a",{href:"#"},React.createElement("span",{className:"noticon noticon-like"}),React.createElement("span",{className:"label"},"Likes")," ",React.createElement("span",{className:"value"},""))),React.createElement("li",{className:"module-tab is-comments is-loading"},React.createElement("a",{href:"#"},React.createElement("span",{className:"noticon noticon-comment"}),React.createElement("span",{className:"label"},"Comments")," ",React.createElement("span",{className:"value"},"")))))}})},1135:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),isEqual=__webpack_require__(96),debug=__webpack_require__(1)("calypso:stats:module-summary-chart");var observe=__webpack_require__(42),ElementChart=__webpack_require__(1064),StatTab=__webpack_require__(1136),analytics=__webpack_require__(12),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsSummaryChart",propTypes:{dataList:React.PropTypes.object.isRequired,labelKey:React.PropTypes.string.isRequired,dataKey:React.PropTypes.string.isRequired},mixins:[observe("dataList")],getInitialState:function getInitialState(){var chartDataLength=this.props.dataList.response.data?this.props.dataList.response.data.length:null;return{selectedBar:chartDataLength?this.props.dataList.response.data[chartDataLength-1]:null}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var selectedBar=this.state.selectedBar,chartDataLength=nextProps.dataList.response.data?nextProps.dataList.response.data.length:null;if(!selectedBar&&chartDataLength){selectedBar=nextProps.dataList.response.data[chartDataLength-1]}this.setState({selectedBar:selectedBar})},barClick:function barClick(bar){var selectedBar=this.props.dataList.response.data.filter(function(data){return isEqual(data,bar.data)},this).shift();analytics.ga.recordEvent("Stats","Clicked Summary Chart Bar");this.setState({selectedBar:selectedBar})},buildTooltipData:function buildTooltipData(item){var tooltipData=[];tooltipData.push({label:item.period,className:"dateLabel",value:null});tooltipData.push({label:this.props.tabLabel,noticon:this.props.labelClass,value:item.value});return tooltipData},buildChartData:function buildChartData(){var data;data=this.props.dataList.response.data.map(function(record){var chartDataItem,className;className=classNames({"is-selected":isEqual(this.state.selectedBar,record)});chartDataItem={label:record.period,value:record.value,nestedValue:null,className:className,data:record};chartDataItem.tooltipData=this.buildTooltipData(record);return chartDataItem},this);return data},chartTabs:function chartTabs(){var tabOptions,label,tabs,selectedBar=this.state.selectedBar;label=selectedBar?": "+selectedBar[this.props.labelKey]:"";tabOptions={attr:this.props.labelKey,value:selectedBar?this.state.selectedBar[this.props.dataKey]:null,selected:true,className:"noticon-"+this.props.labelClass,label:this.props.tabLabel+label};tabs=React.createElement(StatTab,{key:"chart-tab",tab:tabOptions});return React.createElement("ul",{className:"module-tabs is-expanded"},tabs)},render:function render(){debug("Rendering stats/post.jsx",this.props);var classes;classes=["stats-module","is-summary-chart",{"is-loading":this.props.dataList.isLoading()}];return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"module-chart module-placeholder is-void is-chart"}),React.createElement(ElementChart,{key:"chart",loading:this.props.dataList.isLoading(),data:this.buildChartData(),barClick:this.barClick}),this.chartTabs())}})},1136:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);module.exports=React.createClass({displayName:"StatModuleTab",clickHandler:function clickHandler(event){if("function"===typeof this.props.tabClick){event.preventDefault();this.props.tabClick(this.props.tab)}},ensureValue:function ensureValue(value){if(!this.props.tab.loading&&(value||value===0)){return this.numberFormat(value)}else{return String.fromCharCode(8211)}},handleLinkClick:function handleLinkClick(event){if(!this.props.href){event.preventDefault()}},render:function render(){var tab=this.props.tab,tabClassOptions,tabClassSet,linkClassSet,linkClassOptions={},href=tab.href?tab.href:"#";tabClassOptions={"is-selected":tab.selected,"is-loading":tab.loading,"is-low":!tab.value};tabClassOptions["is-"+tab.attr]=true;tabClassSet=classNames(tabClassOptions);linkClassOptions[tab.className]=true;linkClassSet=classNames("noticon",linkClassOptions);return React.createElement("li",{className:"module-tab "+tabClassSet,onClick:this.clickHandler},React.createElement("a",{href:href,onClick:this.handleLinkClick},React.createElement("span",{className:linkClassSet}),React.createElement("span",{className:"label"},tab.label),React.createElement("span",{className:"value"},this.ensureValue(tab.value))))}})},1137:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),classNames=__webpack_require__(11);var Card=__webpack_require__(95),observe=__webpack_require__(42),toggle=__webpack_require__(776);module.exports=React.createClass({displayName:"StatsModuleMostPopular",propTypes:{insightsList:React.PropTypes.object.isRequired},mixins:[observe("insightsList"),toggle("mostPopular")],render:function render(){var classes,data,isLoading,isEmpty,emptyMessage=null;data=this.props.insightsList.response;isLoading=this.props.insightsList.isLoading();isEmpty=!data.percent;classes=["stats-module","stats-most-popular","is-site-overview",{"is-expanded":this.state.showModule,"is-showing-info":this.state.showInfo,"is-loading":isLoading,"is-empty":isEmpty}];if(isEmpty&&!isLoading){emptyMessage=React.createElement("div",{className:"stats-popular__empty"},React.createElement("span",{className:"notice"},this.translate("No popular day and time recorded",{context:"Message on empty bar chart in Stats",comment:"Should be limited to 32 characters to prevent wrapping"})))}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"module-header"},React.createElement("h1",{className:"module-header-title"},this.translate("Most popular day and hour")),React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))))),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("This is the day and hour when you have been getting the most Views on average. The best timing for publishing a post may be around this period."))),React.createElement("div",{className:"stats-popular"},React.createElement("div",{className:"stats-popular__item"},React.createElement("span",{className:"stats-popular__label"},this.translate("Most popular day")),React.createElement("span",{className:"stats-popular__day"},data.day),React.createElement("span",{className:"stats-popular__percentage"},this.translate("%(percent)d%% of views",{args:{percent:data.percent||0},context:"Stats: Percentage of views"}))),React.createElement("div",{className:"stats-popular__item"},React.createElement("span",{className:"stats-popular__label"},this.translate("Most popular hour")),React.createElement("span",{className:"stats-popular__hour"},data.hour),React.createElement("span",{className:"stats-popular__percentage"},this.translate("%(percent)d%% of views",{args:{percent:data.hour_percent||0},context:"Stats: Percentage of views"}))),emptyMessage)))}})},1138:function(module,exports,__webpack_require__){"use strict";var i18n=__webpack_require__(16);module.exports={countryViews:[{icon:"https://secure.gravatar.com/blavatar/9f4faa5ad0c723474f7a6d810172447c?s=48",label:"United States",region:"021",value:68},{icon:"https://secure.gravatar.com/blavatar/b9d80c42eb6af7503f8eb1cd1e88659c?s=48",label:"Ireland",region:"154",value:23}],referrers:[{icon:"https://secure.gravatar.com/blavatar/4cdb265b8260a6a032a1ed197e39b92d?s=48",label:"WordPress.com",value:82,link:"http://wordpress.com",noticon:"external"},{icon:"https://secure.gravatar.com/blavatar/6741a05f4bc6e5b65f504c4f3df388a1?s=48",label:"Google Search",value:75,link:"http://google.com",noticon:"external"},{icon:"https://secure.gravatar.com/blavatar/5029a4a8e7da221ae517ddaa0dd5422b?s=48",label:"Yahoo Search",value:54,link:"http://yahoo.com",noticon:"external"},{icon:null,label:"techcrunch.com",value:16,link:"http://techcrunch.com",noticon:"external"},{icon:null,label:"news.com",value:10,link:"http://news.com",noticon:"external"},{icon:"https://secure.gravatar.com/blavatar/7905d1c4e12c54933a44d19fcd5f9356?s=48",label:"Twitter",value:7,link:"http://twitter.com",noticon:"external"}],insights:{day:i18n.moment().day("Tuesday").format("dddd"),percent:45,hour:i18n.moment().hour(8).startOf("hour").format("LT"),hour_percent:52}}},1139:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-site-overview");var SiteIcon=__webpack_require__(102),observe=__webpack_require__(42),route=__webpack_require__(74),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsModuleSiteOverview",proptypes:{site:React.PropTypes.object.isRequired,summaryData:React.PropTypes.object.isRequired,path:React.PropTypes.string.isRequired},mixins:[observe("summaryData")],ensureValue:function ensureValue(value){if(value||value===0){return this.numberFormat(value)}else{return String.fromCharCode(8211)}},render:function render(){debug("Rendering module site overview");var site=this.props.site,statTabs=["views","visitors","likes","comments"],data=this.props.summaryData.data,classSets={},siteStatsPath=[this.props.path,site.slug].join("/"),headerPath=siteStatsPath,classes,title,icon=null;statTabs.forEach(function(tabName){var tabClassOptions={};if(data&&0===data[tabName]){tabClassOptions["is-low"]=true}tabClassOptions["module-tab"]=true;tabClassOptions["is-"+tabName]=true;classSets[tabName]=classNames(tabClassOptions);
});classes=["stats__overview","stats-module","is-site-overview"];if(this.props.insights){title=this.translate("Today's Stats")}else{title=site.title;icon=React.createElement("div",{className:"module-header__site-icon"},React.createElement(SiteIcon,{site:site,size:24}));headerPath=route.getStatsDefaultSitePage(site.slug)}return React.createElement(Card,{key:site.ID,className:classNames.apply(null,classes)},React.createElement("div",{className:"module-header"},React.createElement("h3",{className:"module-header-title"},React.createElement("a",{href:headerPath,className:"module-header__link"},icon,React.createElement("span",{className:"module-header__right-icon"},React.createElement("span",{className:"noticon noticon-milestone"})),title))),React.createElement("ul",{className:"module-tabs"},React.createElement("li",{className:classSets.views},React.createElement("a",{href:siteStatsPath},React.createElement("span",{className:"noticon noticon-show"}),React.createElement("span",{className:"label"},this.translate("Views",{context:"noun"})),React.createElement("span",{className:"value"},this.ensureValue(data.views)))),React.createElement("li",{className:classSets.visitors},React.createElement("a",{href:siteStatsPath+"?tab=visitors"},React.createElement("span",{className:"noticon noticon-user"}),React.createElement("span",{className:"label"},this.translate("Visitors",{context:"noun"})),React.createElement("span",{className:"value"},this.ensureValue(data.visitors)))),React.createElement("li",{className:classSets.likes},React.createElement("a",{href:siteStatsPath+"?tab=likes"},React.createElement("span",{className:"noticon noticon-like"}),React.createElement("span",{className:"label"},this.translate("Likes",{context:"noun"}))," ",React.createElement("span",{className:"value"},this.ensureValue(data.likes)))),React.createElement("li",{className:classSets.comments},React.createElement("a",{href:siteStatsPath+"?tab=comments"},React.createElement("span",{className:"noticon noticon-comment"}),React.createElement("span",{className:"label"},this.translate("Comments",{context:"noun"}))," ",React.createElement("span",{className:"value"},this.ensureValue(data.comments))))))}})},1164:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:stats-data-summary-list");var Model=__webpack_require__(1728);function StatsDataSummaryList(options){var requiredStrings=["period"];debug("New StatsDataSummary Loading with options ",options);if(!(this instanceof StatsDataSummaryList)){return new StatsDataSummaryList(options)}if("object"!==typeof options){throw new TypeError("a config `object` must be passed in")}if("object"!==typeof options.sites){throw new TypeError("a options.sites array must be passed in")}requiredStrings.forEach(function(attr){if("string"!==typeof options[attr]){throw new TypeError("a `options."+attr+"` must be passed in")}});this.sites=options.sites;this.period=options.period;this.records={};this.sites.forEach(function(site){this.records[site.ID]=new Model({siteId:site.ID,period:this.period,date:site.date})}.bind(this))}StatsDataSummaryList.prototype.updatePeriod=function(options){this.date=options.date;this.period=options.period;this.siteIds.forEach(function(siteId){this.records[siteId].fetchPeriod({period:this.period,date:this.date})}.bind(this));return true};StatsDataSummaryList.prototype.get=function(siteId,date){if(!this.records[siteId]){this.records[siteId]=new Model({siteId:siteId,period:this.period,date:date})}return this.records[siteId]};StatsDataSummaryList.prototype.lastUpdate=function(){var time=(new Date).getTime(),allUpdates;allUpdates=this.siteIds.map(function(siteId){var record=this.records[siteId];if(record.data&&record.data.updatedAt){return record.data.updatedAt}else{return time}}.bind(this)).sort();return allUpdates.pop()};module.exports=StatsDataSummaryList},1186:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2);var Bar=__webpack_require__(1187),XAxis=__webpack_require__(1190),user=__webpack_require__(26)();module.exports=React.createClass({displayName:"ModuleChartBarContainer",propTypes:{isTouch:React.PropTypes.bool,data:React.PropTypes.array,yAxisMax:React.PropTypes.number,width:React.PropTypes.number,barClick:React.PropTypes.func},buildBars:function buildBars(max){var bars,numberBars=this.props.data.length,tooltipPosition=user.isRTL()?"bottom left":"bottom right",width=this.props.chartWidth,barWidth=width/numberBars;bars=this.props.data.map(function(item,index){var barOffset=barWidth*(index+1);if(barOffset+230>width&&barOffset+barWidth-230>0){tooltipPosition=user.isRTL()?"bottom right":"bottom left"}return React.createElement(Bar,{index:index,key:index,isTouch:this.props.isTouch,tooltipPosition:tooltipPosition,className:item.className,clickHandler:this.props.barClick,data:item,max:max,count:numberBars})},this);return bars},render:function render(){return React.createElement("div",null,React.createElement("div",{className:"chart__bars"},this.buildBars(this.props.yAxisMax)),React.createElement(XAxis,{data:this.props.data,labelWidth:42}))}})},1187:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),noop=__webpack_require__(35),debug=__webpack_require__(1)("calypso:module-chart:bar");var Popover=__webpack_require__(291),Tooltip=__webpack_require__(1065);module.exports=React.createClass({displayName:"ModuleChartBar",propTypes:{isTouch:React.PropTypes.bool,tooltipPosition:React.PropTypes.string,className:React.PropTypes.string,clickHandler:React.PropTypes.func,data:React.PropTypes.object.isRequired,max:React.PropTypes.number,count:React.PropTypes.number},getInitialState:function getInitialState(){return{showPopover:false}},buildSections:function buildSections(){var value=this.props.data.value,max=this.props.max,percentage=max?Math.ceil(value/max*1e4)/100:0,remain=100-percentage,remainFloor=Math.max(1,Math.floor(remain)),sections=[],remainStyle,valueStyle,nestedValue=this.props.data.nestedValue,nestedBar,nestedPercentage,nestedStyle,spacerClassOptions={"chart__bar-section":true,"is-spacer":true,"is-ghost":100===remain&&!this.props.active};remainStyle={height:remainFloor+"%"};sections.push(React.createElement("div",{key:"spacer",className:classNames(spacerClassOptions),style:remainStyle}));valueStyle={top:remainFloor+"%"};if(nestedValue){nestedPercentage=value?Math.ceil(nestedValue/value*1e4)/100:0;nestedStyle={height:nestedPercentage+"%"};nestedBar=React.createElement("div",{key:"nestedValue",className:"chart__bar-section-inner",style:nestedStyle})}sections.push(React.createElement("div",{ref:"valueBar",key:"value",className:"chart__bar-section is-bar",style:valueStyle},nestedBar));sections.push(React.createElement("div",{key:"label",className:"chart__bar-label"},this.props.label));return sections},clickHandler:function clickHandler(){if("function"===typeof this.props.clickHandler){this.props.clickHandler(this.props.data)}},mouseEnter:function mouseEnter(){this.setState({showPopover:true})},mouseLeave:function mouseLeave(){this.setState({showPopover:false})},render:function render(){debug("Rendering bar",this.state);var barStyle,barClass,count=this.props.count||1,tooltip;barClass={chart__bar:true};if(this.props.className){barClass[this.props.className]=true}barStyle={width:1/count*100+"%"};if(this.props.data.tooltipData&&this.props.data.tooltipData.length&&!this.props.isTouch){tooltip=React.createElement(Popover,{context:this.refs&&this.refs.valueBar,isVisible:this.state.showPopover,position:this.props.tooltipPosition,onClose:noop,className:"chart__tooltip"},React.createElement(Tooltip,{data:this.props.data.tooltipData}))}return React.createElement("div",{onClick:this.clickHandler,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave,className:classNames(barClass),style:barStyle},this.buildSections(),React.createElement("div",{className:"chart__bar-marker is-hundred"}),React.createElement("div",{className:"chart__bar-marker is-fifty"}),React.createElement("div",{className:"chart__bar-marker is-zero"}),tooltip)}})},1188:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),debug=__webpack_require__(1)("calypso:module-chart:label");var user=__webpack_require__(26)();module.exports=React.createClass({displayName:"ModuleChartLabel",propTypes:{width:React.PropTypes.number.isRequired,x:React.PropTypes.number.isRequired,label:React.PropTypes.string.isRequired},render:function render(){debug("Rendering label");var labelStyle,dir=user.isRTL()?"right":"left";labelStyle={width:this.props.width+"px"};labelStyle[dir]=this.props.x+"px";return React.createElement("div",{className:"chart__x-axis-label",style:labelStyle},this.props.label)}})},1189:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),PureRenderMixin=React.addons.PureRenderMixin,debug=__webpack_require__(1)("calypso:module-chart:legend");var LegendItem=React.createClass({displayName:"ModuleChartLegendItem",mixins:[PureRenderMixin],propTypes:{checked:React.PropTypes.bool.isRequired,label:React.PropTypes.oneOfType([React.PropTypes.object,React.PropTypes.string]),attr:React.PropTypes.string.isRequired,changeHandler:React.PropTypes.func.isRequired},clickHandler:function clickHandler(){this.props.changeHandler(this.props.attr)},render:function render(){return React.createElement("li",{className:"chart__legend-option"},React.createElement("label",{htmlFor:"checkbox",className:"chart__legend-label is-selectable",onClick:this.clickHandler},React.createElement("input",{type:"checkbox",className:"chart__legend-checkbox",checked:this.props.checked,onChange:function(){}}),React.createElement("span",{className:this.props.className}),this.props.label))}});var Legend=React.createClass({displayName:"ModuleChartLegend",propTypes:{activeTab:React.PropTypes.object.isRequired,tabs:React.PropTypes.array.isRequired,activeCharts:React.PropTypes.array.isRequired,availableCharts:React.PropTypes.array.isRequired,clickHandler:React.PropTypes.func.isRequired},onFilterChange:function onFilterChange(chartItem){this.props.clickHandler(chartItem)},render:function render(){debug("Rendering legend",this.props);var legendColors=["chart__legend-color is-dark-blue"],tab=this.props.activeTab,legendItems;legendItems=this.props.availableCharts.map(function(legendItem,index){var colorClass=legendColors[index],checked=-1!==this.props.activeCharts.indexOf(legendItem),tab;tab=this.props.tabs.filter(function(tab){return tab.attr===legendItem}).shift();return React.createElement(LegendItem,{key:index,className:colorClass,label:tab.label,attr:tab.attr,changeHandler:this.onFilterChange,checked:checked})},this);return React.createElement("div",{className:"chart__legend"},React.createElement("ul",{className:"chart__legend-options"},React.createElement("li",{className:"chart__legend-option",key:"default-tab"},React.createElement("span",{className:"chart__legend-label"},React.createElement("span",{className:"chart__legend-color is-wordpress-blue"}),tab.label)),legendItems))}});module.exports=Legend},1190:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),debug=__webpack_require__(1)("calypso:module-chart:x-axis"),throttle=__webpack_require__(308);var Label=__webpack_require__(1188);module.exports=React.createClass({displayName:"ModuleChartXAxis",propTypes:{labelWidth:React.PropTypes.number.isRequired,data:React.PropTypes.array.isRequired},getInitialState:function getInitialState(){return{divisor:1,spacing:this.props.labelWidth}},componentDidMount:function componentDidMount(){this.resizeThrottled=throttle(this.resize,400);window.addEventListener("resize",this.resizeThrottled);this.resize()},componentWillUnmount:function componentWillUnmount(){if(this.resizeThrottled.cancel){this.resizeThrottled.cancel()}window.removeEventListener("resize",this.resizeThrottled)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.resize(nextProps)},resize:function resize(nextProps){if(this.isMounted()){var node,props=this.props,width,dataCount,spacing,labelWidth,divisor;node=this.getDOMNode();if(nextProps&&!(nextProps instanceof Event)){props=nextProps}node.style.overflow="hidden";width=node.clientWidth;node.style.overflow="visible";dataCount=props.data.length||1;spacing=width/dataCount;labelWidth=props.labelWidth;divisor=Math.ceil(labelWidth/spacing);this.setState({divisor:divisor,spacing:spacing})}},render:function render(){debug("Rendering chart x-axis",this.props.data);var labels,data=this.props.data;labels=data.map(function(item,index){var x=index*this.state.spacing+(this.state.spacing-this.props.labelWidth)/2,rightIndex=data.length-index-1,label;if(rightIndex%this.state.divisor===0){label=React.createElement(Label,{key:index,label:item.label,width:this.props.labelWidth,x:x})}return label},this);return React.createElement("div",{className:"chart__x-axis"},labels)}})},1253:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:follow-list:site");var wpcom=__webpack_require__(20),Emitter=__webpack_require__(10);function FollowListSite(args){if(!(this instanceof FollowListSite)){return new FollowListSite(args)}this.site_id=args.site_id;this.is_following=args.is_following;this.blog_domain=args.blog_domain}Emitter(FollowListSite.prototype);FollowListSite.prototype.follow=function(){if(!this.is_following){debug("following site",this.site_id);this.is_following=true;this.emit("change");wpcom.site(this.site_id).follow().add(function(resp){debug("follow success",resp)})}};FollowListSite.prototype.unfollow=function(){if(this.is_following){this.is_following=false;this.emit("change");wpcom.site(this.site_id).follow().del(function(resp){debug("unfollow success",resp)})}};module.exports=FollowListSite},1322:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:stats-data:local-list"),store=__webpack_require__(21);function StatsDataLocalList(options){if(!(this instanceof StatsDataLocalList)){return new StatsDataLocalList(options)}if("string"!==typeof options.localStoreKey){throw new TypeError("a options.localStoreKey must be passed in")}debug("creating new local list");this.localStoreKey=options.localStoreKey;this.limit=options.limit||10;return this}StatsDataLocalList.prototype.getData=function(){var localStoreData=store.get(this.localStoreKey)||[];return localStoreData};StatsDataLocalList.prototype.clear=function(){store.set(this.localStoreKey,[]);return true};StatsDataLocalList.prototype.set=function(key,value){var record={key:key,createdAt:(new Date).getTime(),data:value},localData=this.getData(),newLocalData;debug("storing data locally "+key,value);newLocalData=localData.filter(function(cachedRecord){return cachedRecord&&cachedRecord.key!==key});newLocalData.push(record);if(newLocalData.length>this.limit){newLocalData=newLocalData.slice(newLocalData.length-this.limit)}store.set(this.localStoreKey,newLocalData);return record};StatsDataLocalList.prototype.find=function(key){var matchedRecord;matchedRecord=this.getData().filter(function(cachedRecord){return cachedRecord&&cachedRecord.key===key});if(matchedRecord.length>0){debug("found local record for "+key,matchedRecord[0]);return matchedRecord[0]}else{return false}};module.exports=StatsDataLocalList},1439:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),noop=__webpack_require__(35),classNames=__webpack_require__(11);var i18n=__webpack_require__(16),Popover=__webpack_require__(291),Tooltip=__webpack_require__(1065);module.exports=React.createClass({displayName:"PostTrendsDay",propTypes:{days:React.PropTypes.object.isRequired,date:React.PropTypes.object.isRequired,month:React.PropTypes.object.isRequired,max:React.PropTypes.number.isRequired},getInitialState:function getInitialState(){return{showPopover:false}},mouseEnter:function mouseEnter(){this.setState({showPopover:true})},mouseLeave:function mouseLeave(){this.setState({showPopover:false})},buildTooltipData:function buildTooltipData(date,data){var tooltipData=[],count=0,label,labelWrapper;count=data[date.format("YYYY-MM-DD")]||0;label=this.translate("%(posts)d post on","%(posts)d posts on",{count:count,args:{posts:count},comment:"How many posts published on a certain date."});labelWrapper=React.createElement("span",null,React.createElement("span",{className:"post-count"},label," "),React.createElement("span",{className:"date"},date.format("L")));tooltipData.push({label:labelWrapper});return tooltipData},render:function render(){var level,data=this.props.days,date=this.props.date,max=this.props.max,dayClasses={},tooltip=null,showTooltip=false;level=Math.ceil(data[date.format("YYYY-MM-DD")]/max*4);if(date.isBefore(i18n.moment(this.props.month).startOf("month"))||date.isAfter(i18n.moment(this.props.month).endOf("month"))){dayClasses["is-outside-month"]=true}else if(date.isAfter(i18n.moment().endOf("day"))){dayClasses["is-after-today"]=true}else if(level){if(level>4){level=4}dayClasses["is-level-"+level]=true;showTooltip=true;dayClasses["is-hovered"]=this.state.showPopover}dayClasses=classNames("post-trends__day",dayClasses);if(showTooltip){tooltip=React.createElement(Popover,{context:this.refs&&this.refs.day,isVisible:this.state.showPopover,position:"top",onClose:noop,className:"chart__tooltip is-streak"},React.createElement(Tooltip,{data:this.buildTooltipData(date,data)}))}return React.createElement("div",{className:dayClasses,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave,ref:"day"},tooltip)}})},1440:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),classNames=__webpack_require__(11),throttle=__webpack_require__(308);var observe=__webpack_require__(42),i18n=__webpack_require__(16),Month=__webpack_require__(1441);module.exports=React.createClass({displayName:"PostTrends",mixins:[observe("streakList")],propTypes:{streakList:React.PropTypes.object.isRequired},getInitialState:function getInitialState(){return{canScrollLeft:false,canScrollRight:false}},componentDidMount:function componentDidMount(){var node=this.refs.wrapper.getDOMNode(),yearNode=this.refs.year.getDOMNode(),computedStyle=window.getComputedStyle(yearNode),margin=parseInt(computedStyle.getPropertyValue("margin-left"),10)+parseInt(computedStyle.getPropertyValue("margin-right"),10);yearNode.style.left=0-yearNode.scrollWidth+node.clientWidth-margin+"px";this.resize=throttle(this.resize,400);window.addEventListener("resize",this.resize);this.resize()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this.resize)},resize:function resize(){var scrollProps={},node=this.refs.wrapper.getDOMNode(),yearNode=this.refs.year.getDOMNode(),computedStyle=window.getComputedStyle(yearNode),margin=parseInt(computedStyle.getPropertyValue("margin-left"),10)+parseInt(computedStyle.getPropertyValue("margin-right"),10),left=parseInt(yearNode.style.left,10);scrollProps.canScrollLeft=left<0;scrollProps.canScrollRight=left>0-yearNode.scrollWidth+node.clientWidth-margin;if(this.state.canScrollLeft&&node.clientWidth>yearNode.scrollWidth-margin){yearNode.style.left="0px"}this.setState(scrollProps)},scroll:function scroll(direction){var node=this.refs.wrapper.getDOMNode(),yearNode=this.refs.year.getDOMNode(),computedStyle=window.getComputedStyle(yearNode),margin=parseInt(computedStyle.getPropertyValue("margin-left"),10)+parseInt(computedStyle.getPropertyValue("margin-right"),10),left=parseInt(computedStyle.getPropertyValue("left"),10);if(1!==direction){direction=-1}left-=Math.ceil(direction*node.clientWidth*.8);if(left>0){left=0}else if(left<0-yearNode.scrollWidth+node.clientWidth-margin){left=0-yearNode.scrollWidth+node.clientWidth-margin}yearNode.style.left=left+"px";this.resize()},scrollLeft:function scrollLeft(){this.scroll(-1)},scrollRight:function scrollRight(){this.scroll(1)},getMonthComponents:function getMonthComponents(){var i,months=[],startDate;for(i=11;i>=0;i--){startDate=i18n.moment().subtract(i,"months").startOf("month");months.push(React.createElement(Month,{key:startDate.format("YYYYMM"),startDate:startDate,data:this.props.streakList}))}return months},render:function render(){var leftClass,rightClass,containerClass;leftClass=classNames("post-trends__scroll-left",{"is-active":this.state.canScrollLeft});rightClass=classNames("post-trends__scroll-right",{"is-active":this.state.canScrollRight});containerClass=classNames("post-trends",{"is-loading":this.props.streakList.isLoading()});return React.createElement("div",{className:containerClass},React.createElement("h1",{className:"post-trends__title"},this.translate("Posting activity")),React.createElement("div",{ref:"wrapper",className:"post-trends__wrapper"},React.createElement("div",{ref:"year",className:"post-trends__year"},this.getMonthComponents())),React.createElement("div",{className:leftClass,onClick:this.scrollLeft},React.createElement("span",{className:"left-arrow"})),React.createElement("div",{className:rightClass,onClick:this.scrollRight},React.createElement("span",{className:"right-arrow"})),React.createElement("div",{className:"post-trends__key-container"},React.createElement("span",{className:"post-trends__key-label"},this.translate("Fewer Posts",{context:"Legend label in stats post trends visualization"})),React.createElement("ul",{className:"post-trends__key"},React.createElement("li",{className:"post-trends__key-day is-today"}),React.createElement("li",{className:"post-trends__key-day is-level-1"}),React.createElement("li",{className:"post-trends__key-day is-level-2"}),React.createElement("li",{className:"post-trends__key-day is-level-3"}),React.createElement("li",{className:"post-trends__key-day is-level-4"})),React.createElement("span",{className:"post-trends__key-label"},this.translate("More Posts",{context:"Legend label in stats post trends visualization"}))))}})},1441:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var i18n=__webpack_require__(16),Week=__webpack_require__(1442);module.exports=React.createClass({displayName:"PostTrendsMonth",propTypes:{startDate:React.PropTypes.object.isRequired,data:React.PropTypes.object.isRequired},getWeekComponents:function getWeekComponents(){var monthStart=i18n.moment(this.props.startDate),monthEnd=i18n.moment(monthStart).endOf("month"),weekStart=i18n.moment(monthStart).startOf("week"),weeks=[];if(0===monthStart.day()){weekStart.subtract(6,"day")}else{weekStart.add(1,"day")}do{weeks.push(React.createElement(Week,{key:weekStart.format("YYYYMMDD"),startDate:i18n.moment(weekStart),month:monthStart,data:this.props.data}));weekStart.add(1,"week")}while(weekStart.isBefore(monthEnd,"day")||weekStart.isSame(monthEnd,"day"));return weeks},render:function render(){return React.createElement("div",{className:"post-trends__month"},React.createElement("div",{key:"weeks",className:"post-trends__weeks"},this.getWeekComponents()),React.createElement("div",{key:"label",className:"post-trends__label"},this.props.startDate.format("MMM")))}})},1442:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var i18n=__webpack_require__(16),Day=__webpack_require__(1439);module.exports=React.createClass({displayName:"PostTrendsWeek",propTypes:{startDate:React.PropTypes.object.isRequired,month:React.PropTypes.object.isRequired,data:React.PropTypes.object.isRequired},getDayComponents:function getDayComponents(){var i,data=this.props.data.response.days||{},max=this.props.data.response.max||1,days=[],dayDate;for(i=0;i<7;i++){dayDate=i18n.moment(this.props.startDate).add(i,"day");days.push(React.createElement(Day,{days:data,key:dayDate.format("MMDD"),date:dayDate,month:this.props.month,max:max}))}return days},render:function render(){return React.createElement("div",{className:"post-trends__week"},this.getDayComponents())}})},1509:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:action-follow");var observe=__webpack_require__(42),analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsActionFollow",mixins:[observe("followSite")],clickHandler:function clickHandler(event){var site=this.props.followSite,gaEvent;event.stopPropagation();event.preventDefault();debug("handling follower click",this.props.data);if(!site.is_following){gaEvent="Follow";site.follow()}else{gaEvent="Unfollow";site.unfollow()}analytics.ga.recordEvent("Stats","Clicked "+gaEvent+" in "+this.props.moduleName+" List")},render:function render(){var site=this.props.followSite,following=site.is_following,wrapperClass=classNames("module-content-list-item-action-wrapper",{follow:!following,following:following}),label=following?this.translate("Following",{context:"Stats: Follow action / Following status"}):this.translate("Follow",{context:"Stats: Follow action / Following status"}),wrapperClassSet;wrapperClassSet=classNames(wrapperClass);return React.createElement("li",{className:"module-content-list-item-action"},React.createElement("a",{href:"#",onClick:this.clickHandler,className:wrapperClassSet,title:site.blog_domain,"aria-label":this.translate("Follow or unfollow user",{textOnly:true,context:"Stats ARIA label: Follow/Unfollow action"})},React.createElement("span",{className:"module-content-list-item-action-label"},label),React.createElement("span",{className:"module-content-list-item-action-label unfollow"},this.translate("Unfollow",{context:"Stats ARIA label: Unfollow action"}))))}})},1510:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14);var analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsActionLink",clickHandler:function clickHandler(event){event.stopPropagation();event.preventDefault();analytics.ga.recordEvent("Stats","Clicked on External Link in "+this.props.moduleName+" List Action Menu");window.open(this.props.href)},render:function render(){return React.createElement("li",{className:"module-content-list-item-action"},React.createElement("a",{href:this.props.href,onClick:this.clickHandler,target:"_blank",className:"module-content-list-item-action-wrapper",title:this.translate("View content in a new window",{textOnly:true,context:"Stats action tooltip: View content in a new window"}),"aria-label":this.translate("View content in a new window",{textOnly:true,context:"Stats ARIA label: View content in new window action"})},React.createElement("span",{className:"noticon noticon-external"}),React.createElement("span",{className:"module-content-list-item-action-label module-content-list-item-action-label-view"},this.translate("View",{context:"Stats: List item action to view content"}))))}})},1511:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),page=__webpack_require__(13),debug=__webpack_require__(1)("calypso:stats:action-page");var analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsActionPage",clickHandler:function clickHandler(event){event.stopPropagation();event.preventDefault();debug("handling page click",this.props);analytics.ga.recordEvent("Stats","Clicked on Summary Link in "+this.props.moduleName+" List Action Menu");page(this.props.page)},render:function render(){return React.createElement("li",{className:"module-content-list-item-action"},React.createElement("a",{href:"#",onClick:this.clickHandler,className:"module-content-list-item-action-wrapper",title:this.translate("View in a new window",{textOnly:true,context:"Stats action tooltip: View content in a new window"}),"aria-label":this.translate("View in a new window",{textOnly:true,context:"Stats ARIA label: View content in a new window"})},React.createElement("span",{className:"noticon noticon-milestone"}),React.createElement("span",{className:"module-content-list-item-action-label"},this.translate("View",{context:"Stats: List item action to view content"}))))}})},1512:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:action-spam");var wpcom=__webpack_require__(20),analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsActionSpam",getInitialState:function getInitialState(){return{spammed:false}},clickHandler:function clickHandler(event){var spamType=this.state.spammed?"statsReferrersSpamDelete":"statsReferrersSpamNew",gaEvent=this.state.spammed?"Undid Referrer Spam":"Marked Referrer as Spam",wpcomSite;event.stopPropagation();event.preventDefault();debug(this.state);this.setState({spammed:!this.state.spammed});if(this.props.afterChange){this.props.afterChange(!this.state.spammed)}wpcomSite=wpcom.site(this.props.data.siteID);wpcomSite[spamType].call(wpcomSite,this.props.data.domain,function(){});analytics.ga.recordEvent("Stats",gaEvent+" in "+this.props.moduleName+" List")},render:function render(){var label=this.state.spammed?this.translate("Not Spam"):this.translate("Spam",{context:"Stats: Action to mark an item as spam",comment:'Default label (changes into "Not Spam").'}),title=this.state.spammed?this.translate("Not Spam",{textOnly:true,context:"Stats: Action to undo marking an item as spam",comment:'Secondary label (default label is "Spam"). Recommended to use a very short label.'}):this.translate("Spam",{textOnly:true,context:"Stats: Action to mark an item as spam",comment:'Default label (changes into "Not Spam").'}),wrapperClass=classNames("module-content-list-item-action-wrapper",{spam:!this.state.spammed,unspam:this.state.spammed});return React.createElement("li",{className:"module-content-list-item-action"},React.createElement("a",{href:"#",onClick:this.clickHandler,className:wrapperClass,title:title,"aria-label":title},React.createElement("span",{className:"module-content-list-item-action-label"},label)))}})},1513:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var observe=__webpack_require__(42),Card=__webpack_require__(95),user=__webpack_require__(26)(),toggle=__webpack_require__(776),Gridicon=__webpack_require__(281);module.exports=React.createClass({displayName:"StatsAllTime",mixins:[toggle("allTimeList"),observe("allTimeList")],propTypes:{allTimeList:React.PropTypes.object.isRequired},ensureValue:function ensureValue(value){if(value||value===0){return this.numberFormat(value)}else{return String.fromCharCode(8211)}},render:function render(){var bestDay=null,valueClass,classes;if(this.props.allTimeList.response["best-views"]&&this.props.allTimeList.response["best-views"].day){bestDay=this.moment(this.props.allTimeList.response["best-views"].day).format("LL")}valueClass=classNames("stats-all-time__value",{"is-loading":this.props.allTimeList.isLoading()});classes=["stats-module","stats-all-time",{"is-expanded":this.state.showModule,"is-showing-info":this.state.showInfo,"is-loading":this.props.allTimeList.isLoading(),"is-non-en":user.data.localeSlug&&user.data.localeSlug!=="en"}];return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"module-header"},React.createElement("h1",{className:"module-header-title"},this.translate("All-time posts, views, and visitors")),React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))))),React.createElement("div",{
className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("These are your site's overall total number of Posts, Views and Visitors as well as the day when you had the most number of Views."))),React.createElement("ul",{className:"stats-all-time__list"},React.createElement("li",{className:"stats-all-time__list-item stats-all-time__item-posts"},React.createElement(Gridicon,{icon:"posts",size:18}),React.createElement("span",{className:"stats-all-time__label"},this.translate("Posts")),React.createElement("span",{className:valueClass},this.ensureValue(this.props.allTimeList.response.posts))),React.createElement("li",{className:"stats-all-time__list-item"},React.createElement(Gridicon,{icon:"visible",size:18}),React.createElement("span",{className:"stats-all-time__label"},this.translate("Views")),React.createElement("span",{className:valueClass},this.ensureValue(this.props.allTimeList.response.views))),React.createElement("li",{className:"stats-all-time__list-item"},React.createElement(Gridicon,{icon:"user",size:18}),React.createElement("span",{className:"stats-all-time__label"},this.translate("Visitors")),React.createElement("span",{className:valueClass},this.ensureValue(this.props.allTimeList.response.visitors))),React.createElement("li",{className:"stats-all-time__list-item stats-all-time__best"},React.createElement(Gridicon,{icon:"star",size:18}),React.createElement("span",{className:"stats-all-time__label"},this.translate("Best Views Ever")),React.createElement("span",{className:valueClass},this.ensureValue(this.props.allTimeList.response["best-views"]?this.props.allTimeList.response["best-views"].count:null)),React.createElement("span",{className:"stats-all-time__best-day"},bestDay)))))}})},1514:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),store=__webpack_require__(21),page=__webpack_require__(13),querystring=__webpack_require__(108),debug=__webpack_require__(1)("calypso:stats:controller");var user=__webpack_require__(26)(),sites=__webpack_require__(23)(),route=__webpack_require__(74),analytics=__webpack_require__(12),titlecase=__webpack_require__(289),i18n=__webpack_require__(16),analyticsPageTitle="Stats",config=__webpack_require__(4),abtest=__webpack_require__(170).abtest,layoutFocus=__webpack_require__(75);function getVisitDates(){var statsVisitDates=store.get("statVisits")||[];return statsVisitDates}function recordVisitDate(){var statsVisitDates=getVisitDates(),visitDate=i18n.moment().format("YYYY-MM-DD");if(statsVisitDates.indexOf(visitDate)===-1){statsVisitDates.push(visitDate)}if(statsVisitDates.length>10){statsVisitDates=statsVisitDates.slice(statsVisitDates.length-10)}store.set("statVisits",statsVisitDates)}function rangeOfPeriod(period,date){var periodRange={period:period,startOf:date.clone().startOf(period),endOf:date.clone().endOf(period)};if("week"===period){if("0"===date.format("d")){periodRange.startOf.subtract(6,"d");periodRange.endOf.subtract(6,"d")}else{periodRange.startOf.add(1,"d");periodRange.endOf.add(1,"d")}}periodRange.key=period+":"+periodRange.endOf.format("YYYY-MM-DD");return periodRange}function getNumPeriodAgo(momentSiteZone,date,period){var endOfCurrentPeriod=momentSiteZone.endOf(period),durationAgo=i18n.moment.duration(endOfCurrentPeriod.diff(date)),numPeriodAgo;switch(period){case"day":numPeriodAgo=durationAgo.asDays();break;case"week":numPeriodAgo=durationAgo.asWeeks();break;case"month":numPeriodAgo=durationAgo.asMonths();break;case"year":numPeriodAgo=durationAgo.asYears();break}return numPeriodAgo}function getSiteFilters(siteId){var filters=[{title:i18n.translate("Insights"),path:"/stats/insights/"+siteId,id:"stats-insights"},{title:i18n.translate("Days"),path:"/stats/day/"+siteId,id:"stats-day",period:"day"},{title:i18n.translate("Weeks"),path:"/stats/week/"+siteId,id:"stats-week",period:"week"},{title:i18n.translate("Months"),path:"/stats/month/"+siteId,id:"stats-month",period:"month"},{title:i18n.translate("Years"),path:"/stats/year/"+siteId,id:"stats-year",period:"year"}];return filters}module.exports={redirectToDefaultSitePage:function redirectToDefaultSitePage(context,next){var siteFragment=route.getSiteFragment(context.path);if(siteFragment){layoutFocus.setNext(layoutFocus.getCurrent());page.redirect(route.getStatsDefaultSitePage(siteFragment))}else{next()}},insights:function insights(context,next){var Insights=__webpack_require__(1518),StatsList=__webpack_require__(885),StatsSummaryList=__webpack_require__(1164),NuxInsights=__webpack_require__(1524),FollowList=__webpack_require__(901),site,siteId=context.params.site_id,filters=getSiteFilters.bind(null,siteId),activeFilter=false,basePath=route.sectionify(context.path),followList,streakList,allTimeList,insightsList,statSummaryList,commentsList,tagsList,publicizeList,wpcomFollowersList,emailFollowersList,commentFollowersList,summaryDate,summarySites=[],startDate=i18n.moment().subtract(1,"year").startOf("month").format("YYYY-MM-DD"),endDate=i18n.moment().endOf("month").format("YYYY-MM-DD"),momentSiteZone=i18n.moment(),StatsComponent=Insights,twoWeeksAgo=i18n.moment().subtract(2,"week"),siteCreated,isNux;followList=new FollowList;context.layout.title.set(i18n.translate("Stats",{textOnly:true}));activeFilter=filters().filter(function(filter){return"stats-insights"===filter.id});activeFilter=activeFilter.shift();site=sites.getSite(siteId);if(!site){site=sites.getSite(parseInt(siteId,10))}siteId=site?site.ID||0:0;if(0===siteId){if(0===sites.data.length){sites.once("change",function(){page(context.path)})}else{next()}}if(site&&site.options&&typeof site.options.gmt_offset!=="undefined"){momentSiteZone=i18n.moment().utcOffset(site.options.gmt_offset);summaryDate=momentSiteZone.format("YYYY-MM-DD");summarySites.push({ID:siteId,date:summaryDate});siteCreated=i18n.moment(site.options.created_at)}allTimeList=new StatsList({siteID:siteId,statType:"stats"});streakList=new StatsList({siteID:siteId,statType:"statsStreak",startDate:startDate,endDate:endDate,max:3e3});statSummaryList=new StatsSummaryList({period:"day",sites:summarySites});insightsList=new StatsList({siteID:siteId,statType:"statsInsights"});commentsList=new StatsList({siteID:siteId,statType:"statsComments",domain:site.slug});tagsList=new StatsList({siteID:siteId,statType:"statsTags",domain:site.slug});publicizeList=new StatsList({siteID:siteId,statType:"statsPublicize",domain:site.slug});wpcomFollowersList=new StatsList({siteID:siteId,statType:"statsFollowers",type:"wpcom",domain:site.slug,max:7});emailFollowersList=new StatsList({siteID:siteId,statType:"statsFollowers",type:"email",domain:site.slug,max:7});commentFollowersList=new StatsList({siteID:siteId,statType:"statsCommentFollowers",domain:site.slug,max:7});analytics.pageView.record(basePath,analyticsPageTitle+" > Insights");if(site.post_count<=2&&twoWeeksAgo.isBefore(siteCreated)&&!site.jetpack){isNux=true}if(isNux&&config.isEnabled("manage/stats/nux")){StatsComponent=NuxInsights}React.render(React.createElement(StatsComponent,{site:site,followList:followList,streakList:streakList,allTimeList:allTimeList,statSummaryList:statSummaryList,insightsList:insightsList,commentsList:commentsList,tagsList:tagsList,publicizeList:publicizeList,wpcomFollowersList:wpcomFollowersList,emailFollowersList:emailFollowersList,commentFollowersList:commentFollowersList,summaryDate:summaryDate}),document.getElementById("primary"))},overview:function overview(context,next){var StatsComponent=__webpack_require__(1532),StatsSummaryList=__webpack_require__(1164),filters=function filters(){return[{title:i18n.translate("Days"),path:"/stats/day",altPaths:["/stats"],id:"stats-day",period:"day"},{title:i18n.translate("Weeks"),path:"/stats/week",id:"stats-week",period:"week"},{title:i18n.translate("Months"),path:"/stats/month",id:"stats-month",period:"month"},{title:i18n.translate("Years"),path:"/stats/year",id:"stats-year",period:"year"}]},activeFilter=false,queryOptions=querystring.parse(context.querystring),basePath=route.sectionify(context.path),statSummaryList,summarySites;debug("Stats controller, overview method");context.layout.title.set(i18n.translate("Stats",{textOnly:true}));activeFilter=filters().filter(function(filter){return context.pathname===filter.path||filter.altPaths&&-1!==filter.altPaths.indexOf(context.pathname)},this);debug("activeFilter is",activeFilter);if(0===activeFilter.length){next()}else{if(queryOptions.from){store.set("oldStatsLink",queryOptions.from)}summarySites=sites.getVisible().map(function(site){var momentSiteZone=i18n.moment();if("object"===typeof site.options&&"undefined"!==typeof site.options.gmt_offset){momentSiteZone=i18n.moment().utcOffset(site.options.gmt_offset)}return{ID:site.ID,date:momentSiteZone.endOf(activeFilter.period).format("YYYY-MM-DD")}});activeFilter=activeFilter.shift();statSummaryList=new StatsSummaryList({period:activeFilter.period,sites:summarySites});analytics.mc.bumpStat("calypso_stats_overview_period",activeFilter.period);analytics.pageView.record(basePath,analyticsPageTitle+" > "+titlecase(activeFilter.period));recordVisitDate();React.render(React.createElement(StatsComponent,{period:activeFilter.period,sites:sites,statSummaryList:statSummaryList,path:context.pathname,user:user}),document.getElementById("primary"))}},site:function site(context,next){var currentSite,siteId=context.params.site_id,siteFragment=route.getSiteFragment(context.path),queryOptions=querystring.parse(context.querystring),FollowList=__webpack_require__(901),SiteStatsComponent=__webpack_require__(1530),NuxSite=__webpack_require__(1525),StatsList=__webpack_require__(885),filters=getSiteFilters.bind(null,siteId),activeFilter=false,followList,activeTabVisitsList,visitsList,date,charts=function charts(){return[{attr:"views",legendOptions:["visitors"],className:"noticon-show",label:i18n.translate("Views",{context:"noun"})},{attr:"visitors",className:"noticon-user",label:i18n.translate("Visitors",{context:"noun"})},{attr:"likes",className:"noticon-like",label:i18n.translate("Likes",{context:"noun"})},{attr:"comments",className:"noticon-comment",label:i18n.translate("Comments",{context:"noun"})}]},chartDate,chartTab,visitsListFields,startDate,endDate,chartEndDate,postsPagesList,tagsList,referrersList,clicksList,authorsList,period,chartPeriod,countriesList,videoPlaysList,commentsList,wpcomFollowersList,emailFollowersList,commentFollowersList,publicizeList,searchTermsList,siteOffset=0,momentSiteZone=i18n.moment(),numPeriodAgo=0,basePath=route.sectionify(context.path),baseAnalyticsPath,chartQuantity=10,siteComponent,twoWeeksAgo=i18n.moment().subtract(2,"week"),siteCreated,isNux;debug("Stats controller, site method");context.layout.title.set(i18n.translate("Stats",{textOnly:true}));currentSite=sites.getSite(siteId);if(!currentSite){currentSite=sites.getSite(parseInt(siteId,10))}siteId=currentSite?currentSite.ID||0:0;activeFilter=filters().filter(function(filter){return context.pathname===filter.path||filter.altPaths&&-1!==filter.altPaths.indexOf(context.pathname)},this);debug("context",context);debug("activeFilter",activeFilter);debug("site",currentSite);if(!siteFragment||0===activeFilter.length){next()}else{if(0===siteId){if(0===sites.data.length){sites.once("change",function(){page(context.path)})}else{next()}}if(currentSite&&currentSite.domain){context.layout.title.set(i18n.translate("Stats",{textOnly:true}),{siteID:currentSite.domain})}if("object"===typeof currentSite.options&&"undefined"!==typeof currentSite.options.gmt_offset){siteOffset=currentSite.options.gmt_offset}momentSiteZone=i18n.moment().utcOffset(siteOffset);activeFilter=activeFilter.shift();chartDate=rangeOfPeriod(activeFilter.period,momentSiteZone.clone()).endOf;if(queryOptions.startDate&&i18n.moment(queryOptions.startDate).isValid){date=i18n.moment(queryOptions.startDate);numPeriodAgo=getNumPeriodAgo(momentSiteZone,date,activeFilter.period)}else{date=rangeOfPeriod(activeFilter.period,momentSiteZone.clone()).startOf}numPeriodAgo=parseInt(numPeriodAgo,10);if(numPeriodAgo){if(numPeriodAgo>9){numPeriodAgo="10plus"}numPeriodAgo="-"+numPeriodAgo}else{numPeriodAgo=""}baseAnalyticsPath=basePath+"/:site";analytics.mc.bumpStat("calypso_stats_site_period",activeFilter.period+numPeriodAgo);analytics.pageView.record(baseAnalyticsPath,analyticsPageTitle+" > "+titlecase(activeFilter.period));recordVisitDate();period=rangeOfPeriod(activeFilter.period,date);chartPeriod=rangeOfPeriod(activeFilter.period,chartDate);startDate=period.startOf.format("YYYY-MM-DD");endDate=period.endOf.format("YYYY-MM-DD");chartEndDate=chartPeriod.endOf.format("YYYY-MM-DD");if(queryOptions.from){store.set("oldStatsLink",queryOptions.from)}if(store.get("statTab"+siteId)){chartTab=store.get("statTab"+siteId);store.remove("statTab"+siteId)}else{chartTab="views"}visitsListFields=chartTab;if("views"===visitsListFields){visitsListFields="views,visitors"}if(queryOptions.tab){store.set("statTab"+siteId,queryOptions.tab);page.redirect(context.pathname)}switch(activeFilter.period){case"day":chartQuantity=30;break;case"month":chartQuantity=12;break;case"week":chartQuantity=13;break;case"year":break;default:chartQuantity=10;break}followList=new FollowList;activeTabVisitsList=new StatsList({siteID:siteId,statType:"statsVisits",unit:activeFilter.period,quantity:chartQuantity,date:chartEndDate,stat_fields:visitsListFields});visitsList=new StatsList({siteID:siteId,statType:"statsVisits",unit:activeFilter.period,quantity:chartQuantity,date:chartEndDate,stat_fields:"views,visitors,likes,comments,post_titles"});postsPagesList=new StatsList({siteID:siteId,statType:"statsTopPosts",period:activeFilter.period,date:endDate,domain:currentSite.slug});referrersList=new StatsList({siteID:siteId,statType:"statsReferrers",period:activeFilter.period,date:endDate,domain:currentSite.slug});clicksList=new StatsList({siteID:siteId,statType:"statsClicks",period:activeFilter.period,date:endDate,domain:currentSite.slug});authorsList=new StatsList({siteID:siteId,statType:"statsTopAuthors",period:activeFilter.period,date:endDate,domain:currentSite.slug});countriesList=new StatsList({siteID:siteId,statType:"statsCountryViews",period:activeFilter.period,date:endDate,domain:currentSite.slug});videoPlaysList=new StatsList({siteID:siteId,statType:"statsVideoPlays",period:activeFilter.period,date:endDate,domain:currentSite.slug});searchTermsList=new StatsList({siteID:siteId,statType:"statsSearchTerms",period:activeFilter.period,date:endDate,domain:currentSite.slug});tagsList=new StatsList({siteID:siteId,statType:"statsTags",domain:currentSite.slug});commentsList=new StatsList({siteID:siteId,statType:"statsComments",domain:currentSite.slug});wpcomFollowersList=new StatsList({siteID:siteId,statType:"statsFollowers",type:"wpcom",domain:currentSite.slug,max:7});emailFollowersList=new StatsList({siteID:siteId,statType:"statsFollowers",type:"email",domain:currentSite.slug,max:7});commentFollowersList=new StatsList({siteID:siteId,statType:"statsCommentFollowers",domain:currentSite.slug,max:7});publicizeList=new StatsList({siteID:siteId,statType:"statsPublicize",domain:currentSite.slug});siteComponent=SiteStatsComponent;if(currentSite&&currentSite.options){siteCreated=i18n.moment(currentSite.options.created_at)}if(currentSite.post_count<=2&&twoWeeksAgo.isBefore(siteCreated)&&!currentSite.jetpack){isNux=true}if(isNux&&config.isEnabled("manage/stats/nux")){siteComponent=NuxSite}React.render(React.createElement(siteComponent,{date:date,charts:charts,chartDate:chartDate,chartTab:chartTab,path:context.pathname,context:context,sites:sites,activeTabVisitsList:activeTabVisitsList,visitsList:visitsList,postsPagesList:postsPagesList,referrersList:referrersList,clicksList:clicksList,authorsList:authorsList,countriesList:countriesList,videoPlaysList:videoPlaysList,siteId:siteId,period:period,chartPeriod:chartPeriod,tagsList:tagsList,commentsList:commentsList,wpcomFollowersList:wpcomFollowersList,emailFollowersList:emailFollowersList,commentFollowersList:commentFollowersList,publicizeList:publicizeList,followList:followList,searchTermsList:searchTermsList,slug:currentSite.slug}),document.getElementById("primary"))}},summary:function summary(context,next){var site,siteId=context.params.site_id,siteFragment=route.getSiteFragment(context.path),queryOptions=querystring.parse(context.querystring),StatsList=__webpack_require__(885),FollowList=__webpack_require__(901),StatsSummaryComponent=__webpack_require__(1533),filters=function(contextModule,siteId){return[{title:i18n.translate("Days"),path:"/stats/"+contextModule+"/"+siteId,altPaths:["/stats/day/"+contextModule+"/"+siteId],id:"stats-day",period:"day",back:"/stats/"+siteId},{title:i18n.translate("Weeks"),path:"/stats/week/"+contextModule+"/"+siteId,id:"stats-week",period:"week",back:"/stats/week/"+siteId},{title:i18n.translate("Months"),path:"/stats/month/"+contextModule+"/"+siteId,id:"stats-month",period:"month",back:"/stats/month/"+siteId},{title:i18n.translate("Years"),path:"/stats/year/"+contextModule+"/"+siteId,id:"stats-year",period:"year",back:"/stats/year/"+siteId}]}.bind(null,context.params.module,siteId),activeFilter=false,date,endDate,period,summaryList,visitsList,followList=new FollowList,validModules=["posts","referrers","clicks","countryviews","authors","videoplays","videodetails","searchterms"],momentSiteZone=i18n.moment(),basePath=route.sectionify(context.path);debug("Stats controller, summary method");site=sites.getSite(siteId);if(!site){site=sites.getSite(parseInt(siteId,10))}siteId=site?site.ID||0:0;activeFilter=filters().filter(function(filter){return context.pathname===filter.path||filter.altPaths&&-1!==filter.altPaths.indexOf(context.pathname)},this);if(siteFragment&&0===siteId){if(0===sites.data.length){sites.once("change",function(){page(context.path)})}else{window.location="/stats"}}else if(0===activeFilter.length||-1===validModules.indexOf(context.params.module)){next()}else{if("object"===typeof site.options&&"undefined"!==typeof site.options.gmt_offset){momentSiteZone=i18n.moment().utcOffset(site.options.gmt_offset)}activeFilter=activeFilter.shift();if(queryOptions.startDate&&i18n.moment(queryOptions.startDate).isValid){date=i18n.moment(queryOptions.startDate)}else{date=momentSiteZone.endOf(activeFilter.period)}period=rangeOfPeriod(activeFilter.period,date);endDate=period.endOf.format("YYYY-MM-DD");switch(context.params.module){case"posts":visitsList=new StatsList({statType:"statsVisits",unit:activeFilter.period,siteID:siteId,quantity:10,date:endDate});summaryList=new StatsList({statType:"statsTopPosts",siteID:siteId,period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"referrers":summaryList=new StatsList({siteID:siteId,statType:"statsReferrers",period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"clicks":summaryList=new StatsList({statType:"statsClicks",siteID:siteId,period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"countryviews":summaryList=new StatsList({siteID:siteId,statType:"statsCountryViews",period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"authors":summaryList=new StatsList({statType:"statsTopAuthors",siteID:siteId,period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"videoplays":summaryList=new StatsList({statType:"statsVideoPlays",siteID:siteId,period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"videodetails":summaryList=new StatsList({statType:"statsVideo",post:queryOptions.post,siteID:siteId,period:activeFilter.period,date:endDate,max:0,domain:site.slug});break;case"searchterms":summaryList=new StatsList({siteID:siteId,statType:"statsSearchTerms",period:activeFilter.period,date:endDate,max:0,domain:site.slug});break}analytics.pageView.record(basePath,analyticsPageTitle+" > "+titlecase(activeFilter.period)+" > "+titlecase(context.params.module));React.render(React.createElement(StatsSummaryComponent,{date:date,context:context,path:context.pathname,sites:sites,filters:filters,summaryList:summaryList,visitsList:visitsList,followList:followList,siteId:siteId,period:period}),document.getElementById("primary"))}},post:function post(context){var site,siteId=context.params.site_id,postId=parseInt(context.params.post_id,10),StatsPostComponent=__webpack_require__(1529),StatsList=__webpack_require__(885),pathParts=context.path.split("/"),postOrPage=pathParts[2]==="post"?"post":"page",postViewsList;debug("Stats controller, post method");site=sites.getSite(siteId);if(!site){site=sites.getSite(parseInt(siteId,10))}siteId=site?site.ID||0:0;if(0===siteId){if(0===sites.data.length){sites.once("change",function(){page(context.path)})}else{window.location="/stats"}}else{postViewsList=new StatsList({statType:"statsPostViews",siteID:siteId,post:postId,domain:site.slug});analytics.pageView.record("/stats/"+postOrPage+"/:post_id/:site",analyticsPageTitle+" > Single "+titlecase(postOrPage));React.render(React.createElement(StatsPostComponent,{siteId:siteId,postId:postId,sites:sites,context:context,path:context.path,postViewsList:postViewsList}),document.getElementById("primary"))}},follows:function follows(context,next){var site,siteId=context.params.site_id,FollowList=__webpack_require__(901),FollowsComponent=__webpack_require__(1515),StatsList=__webpack_require__(885),validFollowTypes=["wpcom","email","comment"],followType=context.params.follow_type,pageNum=context.params.page_num,followList=new FollowList,followersList,basePath=route.sectionify(context.path);debug("Stats controller, follows method");site=sites.getSite(siteId);if(!site){site=sites.getSite(parseInt(siteId,10))}siteId=site?site.ID||0:0;if(-1===validFollowTypes.indexOf(followType)){next()}else if(0===siteId){if(0===sites.data.length){sites.once("change",function(){page(context.path)})}else{window.location="/stats"}}else{pageNum=parseInt(pageNum,10);if(!pageNum||pageNum<1){pageNum=1}switch(followType){case"comment":followersList=new StatsList({siteID:siteId,statType:"statsCommentFollowers",domain:site.slug,max:20,page:pageNum});break;case"email":case"wpcom":followersList=new StatsList({siteID:siteId,statType:"statsFollowers",domain:site.slug,max:20,page:pageNum,type:followType});break}analytics.pageView.record(basePath.replace("/"+pageNum,""),analyticsPageTitle+" > Followers > "+titlecase(followType));React.render(React.createElement(FollowsComponent,{path:context.path,sites:sites,siteId:siteId,page:pageNum,perPage:20,total:10,followersList:followersList,followType:followType,followList:followList,domain:site.slug}),document.getElementById("primary"))}}}},1515:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),page=__webpack_require__(13),debug=__webpack_require__(1)("calypso:stats:follows");var observe=__webpack_require__(42),Followers=__webpack_require__(1519),HeaderCake=__webpack_require__(705),analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsFollows",mixins:[observe("sites","site","followersList")],goBack:function goBack(){var pathParts=this.props.path.split("/");page("/stats/"+pathParts[pathParts.length-1])},componentDidMount:function componentDidMount(){window.scrollTo(0,0)},paginationHandler:function paginationHandler(pageNum){var path="/stats/follows/"+this.props.followType+"/";if(pageNum>1){path+=pageNum+"/"}path+=this.props.domain;analytics.ga.recordEvent("Stats","Used Pagination on Followers Page",pageNum);page(path)},changeFilter:function changeFilter(selection){var site=this.props.sites.getSelectedSite(),filter=selection.value;page("/stats/follows/"+filter+"/"+site.slug)},render:function render(){debug("Rendering stats follows");var site=this.props.sites.getSelectedSite();return React.createElement("div",{className:"main main-column",role:"main"},React.createElement("div",{id:"my-stats-content",className:"follows-detail follows-detail-"+this.props.followType},React.createElement(HeaderCake,{onClick:this.goBack},this.translate("Followers")),React.createElement(Followers,{path:this.props.followType+"-follow-summary",site:site,followersList:this.props.followersList,followType:this.props.followType,followList:this.props.followList,page:this.props.page,perPage:this.props.perPage,pageClick:this.paginationHandler,changeFilter:this.changeFilter})))}})},1516:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),throttle=__webpack_require__(308),debug=__webpack_require__(1)("calypso:stats:geochart");var analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsGeochart",visualizationsLoaded:false,visualization:null,propTypes:{data:React.PropTypes.array.isRequired,dataList:React.PropTypes.object.isRequired},recordEvent:function recordEvent(){analytics.ga.recordEvent("Stats","Clicked Country on Map")},drawRegionsMap:function drawRegionsMap(){if(this.isMounted()){debug("this should only be called once ");this.visualizationsLoaded=true;this.visualization=new window.google.visualization.GeoChart(this.getDOMNode());window.google.visualization.events.addListener(this.visualization,"regionClick",this.recordEvent);this.drawData()}},resize:function resize(){if(this.visualizationsLoaded){this.drawData()}},drawData:function drawData(){var regionCodes=[];if(this.props.data.length>1){var data=window.google.visualization.arrayToDataTable(this.props.data),node=this.getDOMNode(),width=node.clientWidth,options={width:100+"%",height:width<=480?"238":"480",keepAspectRatio:true,enableRegionInteractivity:true,region:"world",colorAxis:{colors:["#FFF088","#F34605"]}};this.props.dataList.response.data.map(function(country){if(-1===regionCodes.indexOf(country.region)){regionCodes.push(country.region)}});if(1===regionCodes.length){options.region=regionCodes[0]}debug("here are the data points ",this.props.data);this.visualization.draw(data,options)}},loadVisualizations:function loadVisualizations(){if(window.google){window.google.load("visualization","1",{packages:["geochart"],callback:this.drawRegionsMap});clearTimeout(this.timer)}else{debug("no google");this.tick()}},componentDidMount:function componentDidMount(){var domNode=this.getDOMNode(),script=document.createElement("script");script.src="https://www.google.com/jsapi";if(!window.google){domNode.appendChild(script);this.tick()}else{this.loadVisualizations()}this.resize=throttle(this.resize,1e3);window.addEventListener("resize",this.resize)},componentDidUpdate:function componentDidUpdate(){if(this.visualizationsLoaded){this.drawData()}},componentWillUnmount:function componentWillUnmount(){if(this.visualization){window.google.visualization.events.removeListener(this.visualization,"regionClick",this.recordEvent);this.visualization.clearChart()}if(this.resize.cancel){this.resize.cancel()}window.removeEventListener("resize",this.resize)},tick:function tick(){this.timer=setTimeout(this.loadVisualizations,1e3)},render:function render(){return React.createElement("div",{className:"stats-geochart"})}})},1517:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),debug=__webpack_require__(1)("calypso:stats:info-panel");var analytics=__webpack_require__(12),titlecase=__webpack_require__(289);module.exports=React.createClass({displayName:"StatsInfoPanel",recordEvent:function recordEvent(){analytics.ga.recordEvent("Stats","Clicked More Panel Information Help Link",titlecase(this.props.module))},render:function render(){debug("Rendering stats info panel",this.props);var infoView,infoPanelClass="module-content-text module-content-text-info";switch(this.props.module){case"referrers":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Learn more about your sites visibility by looking at the websites and search engines that send the most traffic your way.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/stats/#marking-spam-referrers",target:"_blank"},React.createElement("span",{className:"noticon noticon-help"}),this.translate("How do I mark a referrer as spam?"))),React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/stats/#referrers",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Referrers")))));break;case"clicks":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("When your content includes links to other sites, youll see which ones your visitors click on the most.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/stats/#clicks",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Clicks")))));break;case"searchterms":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Learn more about your search traffic by looking at the terms your visitors searched for to find your site.",{context:"Stats: search terms info module"})),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/stats/#search-engine-terms",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Search Terms",{context:"Stats: search terms info module documentation link"})))));break;case"tags-categories":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Get an overview of the most popular topics on your site, as reflected in your top posts and pages from the past week.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/getting-more-views-and-traffic/#use-appropriate-tags",target:"_blank"},React.createElement("span",{className:"noticon noticon-help"}),this.translate("How do I tag content effectively?"))),React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/posts/categories-vs-tags/",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Tags & Categories")))));break;case"posts":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Discover what your most-viewed content is, and check how individual posts and pages perform over time.",{context:"Stats: Posts & Pages info box description"})),React.createElement("p",{className:"legend published"},this.translate("= The post or page was published within the selected period",{context:"Legend for the posts & pages panel in Stats",comment:"A vertical, orange bar is displayed to the left of the = sign."})),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/getting-more-views-and-traffic/",target:"_blank"},React.createElement("span",{className:"noticon noticon-help"}),this.translate("How do I get more visitors?",{context:"Stats: Posts & Pages info box documentation link"}))),React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/stats/#top-posts-pages",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Posts & Pages",{context:"Stats: Posts & Pages info box documentation link"})))));break;case"authors":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Track the views on each contributors posts or pages, and zoom in to discover the most popular content by each author.")),React.createElement("ul",{
className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/adding-users/",target:"_blank"},React.createElement("span",{className:"noticon noticon-help"}),this.translate("How do I invite someone to my website?"))),React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/category/users/",target:"_blank"},React.createElement("span",{className:"noticon noticon-book"}),this.translate("About Users")))));break;case"videoplays":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("If youve uploaded videos using VideoPress, find out how many times theyve been watched.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/videos/",target:"_blank"},React.createElement("span",{className:"noticon noticon-book"}),this.translate("About Videos on WordPress.com")))));break;case"publicize":infoView=React.createElement("div",{className:infoPanelClass},React.createElement("p",null,this.translate("Keep track of your followers from various social networking services using publicize.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{onClick:this.recordEvent,href:"http://en.support.wordpress.com/publicize/",target:"_blank"},React.createElement("span",{className:"noticon noticon-document"}),this.translate("About Publicize")))));break}return infoView}})},1518:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),store=__webpack_require__(21);var StatsNavigation=__webpack_require__(880),SidebarNavigation=__webpack_require__(686),AllTime=__webpack_require__(1513),Comments=__webpack_require__(1132),Followers=__webpack_require__(1133),PostTrends=__webpack_require__(1440),SiteOverview=__webpack_require__(1139),SiteOverviewPlaceholder=__webpack_require__(1134),StatsModule=__webpack_require__(923),statsStrings=__webpack_require__(924),MostPopular=__webpack_require__(1137),PostPerformance=__webpack_require__(1528),analytics=__webpack_require__(12),observe=__webpack_require__(42),touchDetect=__webpack_require__(299),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsInsights",mixins:[observe("summaryData")],propTypes:{streakList:React.PropTypes.object.isRequired,allTimeList:React.PropTypes.object.isRequired,statSummaryList:React.PropTypes.object.isRequired,insightsList:React.PropTypes.object.isRequired,summaryDate:React.PropTypes.string},getInitialState:function getInitialState(){return{surveyAnswered:false}},surveyYes:function surveyYes(){this.setState({surveyAnswered:true});store.set("StatsInsightsSurvey",true);analytics.tracks.recordEvent("calypso_insights_survey_taken",{insights_survey_response:"yes"})},surveyNo:function surveyNo(){this.setState({surveyAnswered:true});store.set("StatsInsightsSurvey",true);analytics.tracks.recordEvent("calypso_insights_survey_taken",{insights_survey_response:"no"})},render:function render(){var site=this.props.site,summaryData,moduleStrings=statsStrings(),overview=React.createElement(SiteOverviewPlaceholder,{insights:true}),postTrends=null,survey=null,tagsList=null;if(site){summaryData=this.props.statSummaryList.get(site.ID,this.props.summaryDate);if(summaryData){overview=React.createElement(SiteOverview,{site:site,summaryData:summaryData,path:"/stats/day",insights:true})}if(!site.jetpack){tagsList=React.createElement(StatsModule,{path:"tags-categories",moduleStrings:moduleStrings.tags,site:site,dataList:this.props.tagsList,beforeNavigate:this.updateScrollPosition})}}if(!touchDetect.hasTouch()){postTrends=React.createElement(PostTrends,{streakList:this.props.streakList})}if(store.enabled&&!store.get("StatsInsightsSurvey")){survey=React.createElement(Card,{className:"stats-poll"},React.createElement("span",{className:"stats-poll__message"},"Did you find this page useful?"),React.createElement("button",{className:"button stats-poll__button",onClick:this.surveyYes},"Yes"),React.createElement("button",{className:"button stats-poll__button",onClick:this.surveyNo},"No"))}else if(this.state.surveyAnswered){survey=React.createElement(Card,{className:"stats-poll is-gone"},"Thanks for your feedback!")}return React.createElement("div",{className:"main main-column",role:"main"},React.createElement(SidebarNavigation,null),React.createElement(StatsNavigation,{section:"insights",site:site}),React.createElement("div",{id:"my-stats-content"},postTrends,React.createElement(MostPopular,{insightsList:this.props.insightsList}),React.createElement(AllTime,{allTimeList:this.props.allTimeList}),overview,React.createElement(PostPerformance,{site:this.props.site}),React.createElement("div",{className:"stats-nonperiodic has-recent"},React.createElement("h3",{className:"stats-section-title"},this.translate("Other Recent Stats",{context:"Heading for non periodic site stats"})),React.createElement("div",{className:"module-list"},React.createElement("div",{className:"module-column"},React.createElement(Comments,{path:"comments",site:site,commentsList:this.props.commentsList,followList:this.props.followList,commentFollowersList:this.props.commentFollowersList}),tagsList),React.createElement("div",{className:"module-column"},React.createElement(Followers,{path:"followers",site:site,wpcomFollowersList:this.props.wpcomFollowersList,emailFollowersList:this.props.emailFollowersList,followList:this.props.followList}),React.createElement(StatsModule,{path:"publicize",moduleStrings:moduleStrings.publicize,site:site,dataList:this.props.publicizeList}))))))}})},1519:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-followers-page");var StatsList=__webpack_require__(842),SelectDropdown=__webpack_require__(696),toggle=__webpack_require__(776),skeleton=__webpack_require__(841),ErrorPanel=__webpack_require__(879),Pagination=__webpack_require__(1526),analytics=__webpack_require__(12),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleFollowersPage",mixins:[toggle("FollowersPage"),skeleton("data")],data:function data(nextProps){var props=nextProps||this.props;return props.followersList.response.data},getInitialState:function getInitialState(){return{activeFilter:"wpcom-followers",noData:this.props.followersList.isEmpty("subscribers")}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.followersList.isEmpty("subscribers")})},filterSelect:function filterSelect(){var selectFilter,options=[{value:"wpcom",label:this.translate("WordPress.com Followers")},{value:"email",label:this.translate("Email Followers")}];if("comment"!==this.props.followType){selectFilter=React.createElement("div",{className:"select-dropdown__wrapper"},React.createElement(SelectDropdown,{options:options,onSelect:this.props.changeFilter}))}return selectFilter},recordDownloadClick:function recordDownloadClick(){analytics.ga.recordEvent("Stats","Clicked Download Email Followers CSV link")},render:function render(){debug("Rendering stats followers page");var data=this.data(),hasError=this.props.followersList.isError(),noData=this.props.followersList.isEmpty("subscribers"),followers,moduleHeaderTitle,labelLegend,valueLegend,pagination,paginationSummary,startIndex,endIndex,emailExportUrl,emailExportLink,itemType,classes;classes=["stats-module","is-expanded","summary","is-followers-page",{"is-loading":this.props.followersList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":noData,"is-showing-error":hasError||noData}];switch(this.props.followType){case"comment":itemType=this.translate("Comments");break;case"email":itemType=this.translate("Email");break;case"wpcom":itemType=this.translate("WordPress.com");break}if(data.total){startIndex=this.props.perPage*(this.props.page-1)+1;endIndex=this.props.perPage*this.props.page;if(endIndex>data.total){endIndex=data.total}paginationSummary=this.translate("Showing %(startIndex)s - %(endIndex)s of %(total)s %(itemType)s followers",{context:"pagination",comment:'"Showing [start index] - [end index] of [total] [item]" Example: Showing 21 - 40 of 300 WordPress.com followers',args:{startIndex:this.numberFormat(startIndex),endIndex:this.numberFormat(endIndex),total:this.numberFormat(data.total),itemType:itemType}});paginationSummary=React.createElement("div",{className:"module-content-text module-content-text-stat"},React.createElement("p",null,paginationSummary))}pagination=React.createElement(Pagination,{page:this.props.page,perPage:this.props.perPage,total:data.total,pageClick:this.props.pageClick});if(data&&data.posts){followers=React.createElement(StatsList,{data:data.posts,moduleName:"Followers"});labelLegend=this.translate("Post",{context:"noun"});valueLegend=this.translate("Followers")}else if(data&&data.subscribers){followers=React.createElement(StatsList,{data:data.subscribers,followList:this.props.followList,moduleName:"Followers"});labelLegend=this.translate("Follower");valueLegend=this.translate("Since")}moduleHeaderTitle=React.createElement("h4",{className:"module-header-title"},this.translate("Followers"));if("email"===this.props.followType){emailExportUrl="https://dashboard.wordpress.com/wp-admin/index.php?page=stats&blog="+this.props.site.ID+"&blog_subscribers=csv&type=email";emailExportLink=React.createElement("div",{className:"module-content-text"},React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:emailExportUrl,target:"_blank",onClick:this.recordDownloadClick},React.createElement("span",{className:"noticon noticon-download"}),this.translate("Download all email followers as CSV",{context:"Action shown in stats followers module to download all email followers."})))))}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"followers"},React.createElement("div",{className:"module-header"},moduleHeaderTitle,React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))))),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",null,this.translate("Keep track of your overall number of followers, and how long each one has been following your site.")),React.createElement("ul",{className:"documentation"},React.createElement("li",null,React.createElement("a",{href:"http://en.support.wordpress.com/followers/",target:"_blank"},React.createElement("span",{className:"noticon noticon-book"})," ",this.translate("About Followers"))))),this.filterSelect(),noData&&!hasError?React.createElement(ErrorPanel,{className:"is-empty-message",message:this.translate("No followers")}):null,paginationSummary,pagination,React.createElement("div",{className:"stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-right"},React.createElement("span",{className:"module-content-list-item-value"},valueLegend)),React.createElement("span",{className:"module-content-list-item-label"},labelLegend)))),followers,hasError?React.createElement(ErrorPanel,{className:"network-error"}):null),React.createElement("div",{className:"module-placeholder is-void"}),pagination,emailExportLink)))}})},1520:function(module,exports,__webpack_require__){"use strict";var _Object$keys=__webpack_require__(73)["default"];var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:post");var toggle=__webpack_require__(776),observe=__webpack_require__(42),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsPostMonths",mixins:[toggle("PostMonth"),observe("site","postViewsList")],getInitialState:function getInitialState(){return{noData:this.props.postViewsList.isEmpty()}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.postViewsList.isEmpty()})},render:function render(){debug("Rendering module post months");var data=this.props.postViewsList.response,title=this.props.title,total=this.props.total,dataKey=this.props.dataKey,tableHeader,tableRows,tableBody,highest,classes;classes=["stats-module","is-expanded","is-post-months",{"is-loading":this.props.postViewsList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":this.state.noData}];if(data&&data[dataKey]){tableHeader=React.createElement("thead",null,React.createElement("tr",{className:"top"},React.createElement("th",{className:"spacer"},"0000"),React.createElement("th",null,this.translate("Jan")),React.createElement("th",null,this.translate("Feb")),React.createElement("th",null,this.translate("Mar")),React.createElement("th",null,this.translate("Apr")),React.createElement("th",null,this.translate("May")),React.createElement("th",null,this.translate("Jun")),React.createElement("th",null,this.translate("Jul")),React.createElement("th",null,this.translate("Aug")),React.createElement("th",null,this.translate("Sep")),React.createElement("th",null,this.translate("Oct")),React.createElement("th",null,this.translate("Nov")),React.createElement("th",null,this.translate("Dec")),React.createElement("th",null,total)));highest="years"===dataKey?data.highest_month:data.highest_day_average;tableRows=_Object$keys(data[dataKey]).map(function(i){var j,cellClass,year=data[dataKey][i],cells=[],hasData;cells.push(React.createElement("th",{key:"header"+i},i));for(j=1;j<=12;j++){hasData=year.months[j]||0===year.months[j];cellClass=classNames({"highest-count":0!==highest&&year.months[j]===highest,"has-no-data":!hasData});if(hasData){cells.push(React.createElement("td",{className:cellClass,key:"y"+i+"m"+j},React.createElement("span",{className:"value"},this.numberFormat(year.months[j]))))}else{cells.push(React.createElement("td",{className:cellClass,key:"y"+i+"m"+j}))}}cells.push(React.createElement("td",{key:"total"+i},this.numberFormat("years"===dataKey?year.total:year.overall)));return React.createElement("tr",{key:i},cells)},this);tableBody=React.createElement("tbody",null,tableRows)}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"module-header"},React.createElement("h4",{className:"module-header-title"},title),React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))))),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",{className:"message"},this.translate("No views yet",{context:"Empty info box title for post stats page in Stats"})),React.createElement("p",null,this.translate("This panel gives you an overview of how many views your website gets on average.",{context:"Info box description for post stats page in Stats"})),React.createElement("p",{className:"legend achievement"},this.translate("{{icon/}} = The all-time highest value.",{components:{icon:React.createElement("span",{className:"noticon noticon-trophy"})},context:"Legend for post stats page in Stats",comment:"The icon is a small golden trophy and is displayed within the table of data."}))),React.createElement("div",{className:"module-placeholder is-void"}),React.createElement("div",{className:"module-content-table"},React.createElement("div",{className:"module-content-table-scroll"},React.createElement("table",{cellPadding:"0",cellSpacing:"0"},tableHeader,tableBody)))))}})},1521:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:post");var observe=__webpack_require__(42),toggle=__webpack_require__(776),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatsPostWeeks",mixins:[toggle("PostWeek"),observe("site","postViewsList")],getInitialState:function getInitialState(){return{noData:this.props.postViewsList.isEmpty()}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({noData:nextProps.postViewsList.isEmpty()})},render:function render(){debug("Rendering module post weeks");var data=this.props.postViewsList.response,tableHeader,tableRows,tableBody,highest,classes;classes=["stats-module","is-expanded","is-post-weeks",{"is-loading":this.props.postViewsList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":this.state.noData}];if(data&&data.weeks){highest=data.highest_week_average;tableHeader=React.createElement("thead",null,React.createElement("tr",{className:"top"},React.createElement("th",null,this.translate("Mon")),React.createElement("th",null,this.translate("Tue")),React.createElement("th",null,this.translate("Wed")),React.createElement("th",null,this.translate("Thu")),React.createElement("th",null,this.translate("Fri")),React.createElement("th",null,this.translate("Sat")),React.createElement("th",null,this.translate("Sun")),React.createElement("th",null,this.translate("Total")),React.createElement("th",null,this.translate("Average")),React.createElement("th",null,this.translate("Change",{context:"Stats: noun - change over a period in weekly numbers"}))));tableRows=data.weeks.map(function(e,i){var j,dayCells,cells=[],changeClass;if(e.days.length<7&&0===i){for(j=0;j<7-e.days.length;j++){cells.push(React.createElement("td",{key:"w0e"+j}))}}dayCells=e.days.map(function(e){var day=this.moment(e.day,"YYYY-MM-DD"),cellClass=classNames({"highest-count":0!==highest&&e.count===highest});return React.createElement("td",{key:e.day,className:cellClass},React.createElement("span",{className:"date"},day.format("MMM D")),React.createElement("span",{className:"value"},this.numberFormat(e.count)))},this);cells=cells.concat(dayCells);if(e.days.length<7&&0!==i){for(j=0;j<7-e.days.length;j++){cells.push(React.createElement("td",{key:"w"+i+"e"+j}))}}cells.push(React.createElement("td",{key:"total"+i},this.numberFormat(e.total)));cells.push(React.createElement("td",{key:"average"+i},this.numberFormat(e.average)));if("number"===typeof e.change){changeClass=classNames({"value-rising":e.change>0,"value-falling":e.change<0});cells.push(React.createElement("td",{className:changeClass,key:"change"+i},React.createElement("span",{className:"value"},this.numberFormat(e.change,2),"%")))}else if("object"===typeof e.change&&null!==e.change&&e.change.isInfinity){cells.push(React.createElement("td",{key:"change"+i},""))}else{cells.push(React.createElement("td",{className:"no-data",key:"change"+i}))}return React.createElement("tr",{key:i},cells)},this);tableBody=React.createElement("tbody",null,tableRows)}return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"module-header"},React.createElement("h4",{className:"module-header-title"},this.translate("Recent Weeks")),React.createElement("ul",{className:"module-header-actions"},React.createElement("li",{className:"module-header-action toggle-info"},React.createElement("a",{href:"#",className:"module-header-action-link","aria-label":this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),title:this.translate("Show or hide panel information",{textOnly:true,context:"Stats panel action"}),onClick:this.toggleInfo},React.createElement("span",{className:"noticon noticon-info"}))))),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"module-content-text module-content-text-info"},React.createElement("p",{className:"message"},this.translate("No views yet")),React.createElement("p",null,this.translate("This panel gives you an overview of how many views your website is getting recently.")),React.createElement("p",{className:"legend achievement"},this.translate("{{icon/}} = The highest recent value.",{components:{icon:React.createElement("span",{className:"noticon noticon-trophy"})},context:"Legend for post stats page in Stats",comment:"The icon is a small golden trophy and is displayed within the table of data."}))),React.createElement("div",{className:"module-placeholder is-void"}),React.createElement("div",{className:"module-content-table"},React.createElement("div",{className:"module-content-table-scroll"},React.createElement("table",{cellPadding:"0",cellSpacing:"0"},tableHeader,tableBody)))))}})},1522:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2);var StatTab=__webpack_require__(1136);module.exports=React.createClass({displayName:"StatModuleTabs",render:function render(){var tabs,data;data=this.props.dataList.response.data.filter(function(item){return item[this.props.activeKey]===this.props.activeIndex},this);if(data.length){data=data.pop()}tabs=this.props.tabs.map(function(tab){var tabOptions,hasData=data&&data[tab.attr]>=0&&data[tab.attr]!==null;tabOptions={attr:tab.attr,value:hasData?data[tab.attr]:null,selected:this.props.selectedTab===tab.attr,className:tab.className,label:tab.label,loading:!hasData};return React.createElement(StatTab,{key:tab.attr,tab:tabOptions,tabClick:this.props.switchTab})},this);return React.createElement("ul",{className:"module-tabs is-enabled"},tabs)}})},1523:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:module-video-details");var StatsList=__webpack_require__(842),skeleton=__webpack_require__(841),Card=__webpack_require__(95);module.exports=React.createClass({displayName:"StatModuleVideoDetails",mixins:[skeleton("data")],data:function data(nextProps){var props=nextProps||this.props;return props.summaryList.data},render:function render(){debug("Rendering video details");var classes;classes=["stats-module","is-expanded","summary","is-video-details",{"is-loading":this.props.summaryList.isLoading(),"is-showing-info":this.state.showInfo,"has-no-data":this.props.summaryList.isEmpty()}];return React.createElement(Card,{className:classNames.apply(null,classes)},React.createElement("div",{className:"videoplays"},React.createElement("div",{className:"module-header"},React.createElement("h4",{className:"module-header-title"},this.translate("Video Embeds"))),React.createElement("div",{className:"module-content"},React.createElement("div",{className:"stats-async-metabox-wrapper"},React.createElement("ul",{className:"module-content-list module-content-list-legend"},React.createElement("li",{className:"module-content-list-item"},React.createElement("span",{className:"module-content-list-item-wrapper"},React.createElement("span",{className:"module-content-list-item-label"},this.translate("Page"))))),React.createElement("div",{className:"module-placeholder is-void"}),React.createElement(StatsList,{moduleName:"Video Details",data:this.props.summaryList.response.pages?this.props.summaryList.response.pages:[]})))))}})},1524:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),page=__webpack_require__(13);var observe=__webpack_require__(42),StatsNavigation=__webpack_require__(880),SidebarNavigation=__webpack_require__(686),MostPopular=__webpack_require__(1137),nuxData=__webpack_require__(1138),SidebarNavigation=__webpack_require__(686),abtest=__webpack_require__(170).abtest,analytics=__webpack_require__(12),Card=__webpack_require__(95),productsValues=__webpack_require__(58),CompactCard=__webpack_require__(694);module.exports=React.createClass({displayName:"StatsNuxInsights",mixins:[observe("insightsList")],getInitialState:function getInitialState(){return{insightsList:nuxData.insights}},clickPostLink:function clickPostLink(event){event.preventDefault();page("/post/"+this.props.site.slug)},clickUpgradeLink:function clickUpgradeLink(event){event.preventDefault();analytics.tracks.recordEvent("calypso_stats_upgrade_click",{test_group:abtest("upgradeBoxStatsPage")});page("/plans/"+this.props.site.slug)},buildPostSummary:function buildPostSummary(){return React.createElement(Card,{className:"stats__overview stats-module is-site-overview stats-nux"},React.createElement("div",{className:"module-header"},React.createElement("h3",{className:"module-header-title"},this.translate("Latest Post Summary"))),React.createElement("div",{className:"module-content-text"},React.createElement("p",null,this.translate("It's been %(timeLapsed)s since {{href}}{{postTitle/}}{{/href}} was published. Here's how the post has performed so far...",{args:{timeLapsed:"8 hours"},components:{href:React.createElement("a",null),postTitle:React.createElement("span",null,"Coffee Time")},context:"Stats: Sentence showing how much time has passed since the last post, and how the stats are"}))),React.createElement("ul",{className:"module-tabs is-nux"},React.createElement("li",{className:"module-tab",key:"views"},React.createElement("span",{className:"label"},React.createElement("span",{className:"noticon noticon-show"}),React.createElement("span",null,this.translate("Views"))),React.createElement("span",{className:"value"},"12")),React.createElement("li",{className:"module-tab",key:"likes"},React.createElement("span",{className:"label"},React.createElement("span",{className:"noticon noticon-star"}),React.createElement("span",null,this.translate("Likes"))),React.createElement("span",{className:"value"},"8")),React.createElement("li",{className:"module-tab",key:"comments"},React.createElement("span",{className:"label"},React.createElement("span",{className:"noticon noticon-comment"}),React.createElement("span",null,this.translate("Comments"))),React.createElement("span",{className:"value"},"4"))))},buildPromo:function buildPromo(){var content,nudge="";if(!this.props.site.jetpack&&!productsValues.isPlan(this.props.site.plan)){analytics.tracks.recordEvent("calypso_stats_upgrade_view",{test_group:abtest("upgradeBoxStatsPage")});if(abtest("upgradeBoxStatsPage")==="dataInformedCopy"){nudge=React.createElement(CompactCard,{className:"stats-section-upgrade-nudge"},React.createElement("strong",null,this.translate("It's a fact!")),React.createElement("h1",{className:"stats-section-title"},this.translate("Your new site deserves more")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Premium and Business sites get 30% more views than regular sites.")),React.createElement("button",{className:"button",onClick:this.clickUpgradeLink},this.translate("Check it out now!")))}else{nudge=React.createElement(CompactCard,{className:"stats-section-upgrade-nudge"},React.createElement("strong",null,this.translate("Upgrade Available")),React.createElement("h1",{className:"stats-section-title"},this.translate("Want to take your site to the nextlevel?")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Get a custom domain, advanced customization, and more with our Premium and Business plans.")),React.createElement("button",{className:"button",onClick:this.clickUpgradeLink},this.translate("Upgrade Now")))}}content=React.createElement("div",{className:"module-list"},React.createElement("div",{className:"module-column"},React.createElement("div",{className:"module-overlay"}),React.createElement(MostPopular,{insightsList:this.props.insightsList})),React.createElement("div",{className:"module-column"},React.createElement("h1",{className:"stats-section-title"},this.translate("Want to learn more about how your content performs?")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Attract new views, likes, and comments.")),React.createElement("button",{className:"button is-primary",onClick:this.clickPostLink},this.translate("Write a Post")),nudge));return content},render:function render(){this.props.insightsList.response=this.state.insightsList;this.props.insightsList.loading=false;return React.createElement("div",{className:"stats-nux is-insights"},React.createElement("div",{className:"main main-column",role:"main"},React.createElement(SidebarNavigation,null),React.createElement(StatsNavigation,{section:"insights",site:this.props.site}),React.createElement("div",{id:"my-stats-content"},React.createElement("h3",{className:"stats-section-title"},this.translate("Activate Your Stats Page")),this.buildPromo())))}})},1525:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),page=__webpack_require__(13),noop=__webpack_require__(35);var observe=__webpack_require__(42),StatsNavigation=__webpack_require__(880),SidebarNavigation=__webpack_require__(686),ChartTabs=__webpack_require__(1131),nuxData=__webpack_require__(1138),Countries=__webpack_require__(1018),statsStrings=__webpack_require__(924),StatsModule=__webpack_require__(923),abtest=__webpack_require__(170).abtest,analytics=__webpack_require__(12),SidebarNavigation=__webpack_require__(686),productsValues=__webpack_require__(58),CompactCard=__webpack_require__(694);module.exports=React.createClass({displayName:"StatsNuxSite",mixins:[observe("countriesList","referrersList")],getInitialState:function getInitialState(){return{countryViews:nuxData.countryViews,referrersList:nuxData.referrers,chartTab:"views"}},switchChart:function switchChart(tab){if(tab.attr!==this.state.charTab){this.setState({chartTab:tab.attr})}},clickPostLink:function clickPostLink(event){var site=this.props.sites.getSite(this.props.siteId);event.preventDefault();page("/post/"+site.slug)},clickUpgradeLink:function clickUpgradeLink(event){event.preventDefault();var site=this.props.sites.getSite(this.props.siteId);analytics.tracks.recordEvent("calypso_stats_upgrade_click",{test_group:abtest("upgradeBoxStatsPage")});page("/plans/"+site.slug)},buildPromo:function buildPromo(){var promo,site=this.props.sites.getSite(this.props.siteId),moduleStrings=statsStrings(),queryDate=this.props.date.format("YYYY-MM-DD"),nudge="";if(!site.jetpack&&!productsValues.isPlan(site.plan)){analytics.tracks.recordEvent("calypso_stats_upgrade_view",{test_group:abtest("upgradeBoxStatsPage")});if(abtest("upgradeBoxStatsPage")==="dataInformedCopy"){nudge=React.createElement(CompactCard,{className:"stats-section-upgrade-nudge"},React.createElement("strong",null,this.translate("It's a fact!")),React.createElement("h1",{className:"stats-section-title"},this.translate("Your new site deserves more")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Premium and Business sites get 30% more views than regular sites.")),React.createElement("button",{className:"button",onClick:this.clickUpgradeLink},this.translate("Check it out now!")))}else{nudge=React.createElement(CompactCard,{className:"stats-section-upgrade-nudge"},React.createElement("strong",null,this.translate("Upgrade Available")),React.createElement("h1",{
className:"stats-section-title"},this.translate("Want to take your site to the nextlevel?")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Get a custom domain, advanced customization, and more with our Premium and Business plans.")),React.createElement("button",{className:"button",onClick:this.clickUpgradeLink},this.translate("Upgrade Now")))}}promo=React.createElement("div",{className:"module-list"},React.createElement("div",{className:"module-column"},React.createElement("div",{className:"module-overlay"}),React.createElement(Countries,{path:"countries",site:site,dataList:this.props.countriesList,period:this.props.period,date:queryDate})),React.createElement("div",{className:"module-column"},React.createElement("h1",{className:"stats-section-title"},this.translate("Want to learn more about how your content performs?")),React.createElement("p",{className:"stats-section-blurb"},this.translate("Attract visitors from around the globe.")),React.createElement("button",{className:"button is-primary",onClick:this.clickPostLink},this.translate("Write a Post")),nudge));return promo},render:function render(){var site=this.props.sites.getSite(this.props.siteId);this.props.countriesList.response.data=this.state.countryViews;this.props.countriesList.loading=false;this.props.referrersList.response.data=this.state.referrersList;this.props.referrersList.loading=false;return React.createElement("div",{className:"stats-nux is-period"},React.createElement("div",{className:"main main-column",role:"main"},React.createElement(SidebarNavigation,null),React.createElement(StatsNavigation,{section:this.props.period.period,site:site}),React.createElement("div",{id:"my-stats-content"},React.createElement(ChartTabs,{visitsList:this.props.visitsList,activeTabVisitsList:this.props.activeTabVisitsList,barClick:noop,switchTab:this.switchChart,charts:this.props.charts(),period:this.props.period,queryDate:this.props.date.format("YYYY-MM-DD"),chartTab:this.state.chartTab}),React.createElement("h3",{className:"stats-section-title"},this.translate("Activate Your Stats Page")),this.buildPromo())))}})},1526:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2);var PaginationPage=__webpack_require__(1527);module.exports=React.createClass({displayName:"StatModulePagination",propTypes:{page:React.PropTypes.number.isRequired,perPage:React.PropTypes.number.isRequired,total:React.PropTypes.number,pageClick:React.PropTypes.func.isRequired},render:function render(){var props=this.props,currentPage=props.page,pageList=[],perPage=props.perPage,total=props.total,pageCount=Math.ceil(total/perPage),pagination=null,i;if(pageCount>1){pageList=[1,currentPage-2,currentPage-1,currentPage,currentPage+1,currentPage+2,pageCount];pageList.sort(function(a,b){return a-b});pageList=pageList.filter(function(pageNumber,index,originalPageList){return pageNumber>=1&&pageNumber<=pageCount&&originalPageList.lastIndexOf(pageNumber)===index});for(i=pageList.length-2;i>=0;i--){if(2===pageList[i+1]-pageList[i]){pageList.splice(i+1,0,pageList[i+1]-1)}else if(pageList[i+1]-pageList[i]>1){pageList.splice(i+1,0,"...")}}pageList.unshift("-->");pageList.unshift("<--");pageList=pageList.map(function(pageNumber,index){return React.createElement(PaginationPage,{key:index,pageNumber:pageNumber,currentPage:currentPage,totalPages:pageCount,pageClick:this.props.pageClick})},this)}if(pageCount>1){pagination=React.createElement("div",{className:"stats-pagination"},React.createElement("ul",{className:"stats-pagination__list"},pageList))}else{pagination=null}return pagination}})},1527:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11);var Gridicon=__webpack_require__(281);module.exports=React.createClass({displayName:"StatModulePaginationPage",propTypes:{pageNumber:React.PropTypes.node.isRequired,currentPage:React.PropTypes.number.isRequired,totalPages:React.PropTypes.number.isRequired,pageClick:React.PropTypes.func.isRequired},clickHandler:function clickHandler(event){event.stopPropagation();switch(this.props.pageNumber){case"<--":if(this.props.currentPage-1<1){return}this.props.pageClick(this.props.currentPage-1);break;case"-->":if(this.props.currentPage+1>this.props.totalPages){return}this.props.pageClick(this.props.currentPage+1);break;default:if(this.props.currentPage===this.props.pageNumber){return}this.props.pageClick(this.props.pageNumber);break}},render:function render(){var listClass,pageNumberElement;switch(this.props.pageNumber){case"...":pageNumberElement=React.createElement("li",{className:"stats-pagination__list-item stats-pagination__ellipsis","aria-hidden":"true"},"");break;case"<--":listClass=classNames("stats-pagination__list-item stats-pagination__arrow","is-left",{"is-active":this.props.currentPage>1});pageNumberElement=React.createElement("li",{className:listClass,onClick:this.clickHandler,tabIndex:"0"},React.createElement(Gridicon,{icon:"arrow-left"}));break;case"-->":listClass=classNames("stats-pagination__list-item stats-pagination__arrow","is-right",{"is-active":this.props.currentPage<this.props.totalPages});pageNumberElement=React.createElement("li",{className:listClass,onClick:this.clickHandler,tabIndex:"0"},React.createElement(Gridicon,{icon:"arrow-right"}));break;default:listClass=classNames("stats-pagination__list-item stats-pagination__page-number",{"is-selected":this.props.currentPage===this.props.pageNumber});pageNumberElement=React.createElement("li",{className:listClass,onClick:this.clickHandler,tabIndex:"0"},this.numberFormat(this.props.pageNumber));break}return pageNumberElement}})},1528:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(14),debug=__webpack_require__(1)("calypso:stats:postPerformance"),classNames=__webpack_require__(11);var Card=__webpack_require__(95),PostListStore=__webpack_require__(721),PostStatsStore=__webpack_require__(982),Emojify=__webpack_require__(947),actions=__webpack_require__(682);function getPostState(){var posts=PostListStore.getAll(),post=posts.length?posts[0]:null;return{post:post,postID:post?post.ID:null,loading:PostListStore.isFetchingNextPage(),views:post?PostStatsStore.getItem("totalViews",post.site_ID,post.ID):String.fromCharCode(8211)}}function queryPosts(siteID){actions.queryPosts({type:"post",siteID:siteID,status:"published"});actions.fetchNextPage()}module.exports=React.createClass({displayName:"StatsPostPerformance",propTypes:{site:React.PropTypes.oneOfType([React.PropTypes.bool,React.PropTypes.object])},componentWillMount:function componentWillMount(){PostListStore.on("change",this.onPostsChange);queryPosts(this.props.site.ID);PostStatsStore.on("change",this.onViewsChange)},componentWillUnmount:function componentWillUnmount(){PostListStore.off("change",this.onPostsChange);PostStatsStore.off("change",this.onViewsChange)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.site.ID!==this.props.siteID){queryPosts(nextProps.site.ID)}},getInitialState:function getInitialState(){return{loading:true,post:null,postID:null,views:String.fromCharCode(8211)}},onPostsChange:function onPostsChange(){var postState=getPostState();this.setState(postState)},onViewsChange:function onViewsChange(){var views=this.getTotalViews();if(this.state.views!==views){this.setState({views:this.getTotalViews()})}},getTotalViews:function getTotalViews(){var views=null;if(this.state.post){views=PostStatsStore.getItem("totalViews",this.props.site.ID,this.state.post.ID)}return views},buildTabs:function buildTabs(summaryUrl){var post=this.state.post,isLoading=this.state.loading,emptyString=String.fromCharCode(8211),values={views:this.state.views,likes:post?post.like_count:emptyString,comments:post?post.discussion.comment_count:emptyString},tabs=[{label:this.translate("Views"),labelIcon:"noticon-show",value:values.views,link:summaryUrl},{label:this.translate("Likes"),labelIcon:"noticon-star",value:values.likes},{label:this.translate("Comments"),labelIcon:"noticon-comment",value:values.comments}];return tabs.map(function(tabOptions,index){var valueClass=classNames("value",{"is-low":tabOptions.value===0}),wrapperClass=classNames({"module-tab":true,"is-post-summary":true,"is-loading":isLoading}),tabInnerClass=classNames({"no-link":!tabOptions.link}),tabContent;tabContent=React.createElement("span",{className:tabInnerClass},React.createElement("span",{className:"label"},React.createElement("span",{className:classNames.apply(null,["noticon",tabOptions.labelIcon])}),tabOptions.label),React.createElement("span",{className:valueClass},tabOptions.value));return React.createElement("li",{className:wrapperClass,key:index},tabOptions.link?React.createElement("a",{href:summaryUrl},tabContent):tabContent)})},render:function render(){var post=this.state.post,postTime=post?this.moment(post.date):this.moment(),cardClass=classNames({"is-loading":this.state.loading,stats__overview:true,"stats-module":true,"is-site-overview":true,"is-hidden":!this.state.loading&&!this.state.post}),summaryUrl=post?"/stats/post/"+post.ID+"/"+this.props.site.slug:"#";debug("rendering",this.state);return React.createElement(Card,{className:cardClass},React.createElement("div",{className:"module-header"},React.createElement("h3",{className:"module-header-title"},React.createElement("a",{href:summaryUrl,className:"module-header__link"},React.createElement("span",{className:"module-header__right-icon"},React.createElement("span",{className:"noticon noticon-milestone"})),this.translate("Latest Post Summary")))),React.createElement("div",{className:"module-content-text"},post?React.createElement("p",null,this.translate("It's been %(timeLapsed)s since {{href}}{{postTitle/}}{{/href}} was published. Here's how the post has performed so far...",{args:{timeLapsed:postTime.fromNow(true)},components:{href:React.createElement("a",{href:post.URL,target:"_blank"}),postTitle:React.createElement(Emojify,null,post.title)},context:"Stats: Sentence showing how much time has passed since the last post, and how the stats are"})):null),React.createElement("ul",{className:"module-tabs"},this.buildTabs(summaryUrl)))}})},1529:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),page=__webpack_require__(13),debug=__webpack_require__(1)("calypso:stats:post");var observe=__webpack_require__(42),SummaryChart=__webpack_require__(1135),PostMonths=__webpack_require__(1520),PostWeeks=__webpack_require__(1521),Emojify=__webpack_require__(947),HeaderCake=__webpack_require__(705);module.exports=React.createClass({displayName:"StatsPost",mixins:[observe("site","postViewsList")],goBack:function goBack(){var pathParts=this.props.path.split("/"),defaultBack="/stats/"+pathParts[pathParts.length-1];page(this.props.context.prevPath||defaultBack)},componentDidMount:function componentDidMount(){window.scrollTo(0,0)},render:function render(){debug("Rendering stats/post.jsx",this.props);var title="",stats="";if(this.props.postViewsList.response.post&&this.props.postViewsList.response.post.post_title){title=this.translate("Stats for %(posttitle)s",{comment:"Title of the individual post stats page.",args:{posttitle:this.props.postViewsList.response.post.post_title}})}if(this.props.postViewsList.isError()){title=this.translate("We don't have that post on record yet.")}stats=this.translate("Stats");return React.createElement("div",{className:"main main-column",role:"main"},React.createElement("div",{id:"my-stats-content"},React.createElement(HeaderCake,{onClick:this.goBack},React.createElement(Emojify,null,title)),React.createElement(SummaryChart,{key:"chart",loading:this.props.postViewsList.isLoading(),dataList:this.props.postViewsList,barClick:this.props.barClick,activeKey:"period",dataKey:"value",labelKey:"period",labelClass:"show",tabLabel:this.translate("Views")}),React.createElement(PostMonths,{dataKey:"years",title:this.translate("Months and Years"),total:this.translate("Total"),postViewsList:this.props.postViewsList}),React.createElement(PostMonths,{dataKey:"averages",title:this.translate("Average per Day"),total:this.translate("Overall"),postViewsList:this.props.postViewsList}),React.createElement(PostWeeks,{postViewsList:this.props.postViewsList})))}})},1530:function(module,exports,__webpack_require__){"use strict";var page=__webpack_require__(13),React=__webpack_require__(2),store=__webpack_require__(21),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:site"),url=__webpack_require__(43);var StatsNavigation=__webpack_require__(880),SidebarNavigation=__webpack_require__(686),DatePicker=__webpack_require__(922),Countries=__webpack_require__(1018),Comments=__webpack_require__(1132),Followers=__webpack_require__(1133),ChartTabs=__webpack_require__(1131),StatsModule=__webpack_require__(923),statsStrings=__webpack_require__(924),titlecase=__webpack_require__(289),analytics=__webpack_require__(12),config=__webpack_require__(4),user=__webpack_require__(26)();module.exports=React.createClass({displayName:"StatsSite",getInitialState:function getInitialState(){var scrollPosition=this.props.context.state.scrollPosition||0;return{date:this.props.date,chartDate:this.props.date,chartTab:this.props.chartTab,tabSwitched:false,period:this.props.period.period,scrollPosition:scrollPosition}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var newDate=this.moment(nextProps.date),newState={date:newDate,chartDate:newDate};if(!this.state.tabSwitched||this.state.period!==nextProps.period.period){newState.chartTab=nextProps.chartTab;newState.period=nextProps.period.period;newState.tabSwitched=true}this.setState(newState)},scrollTop:function scrollTop(){if(window.pageYOffset){return window.pageYOffset}return document.documentElement.clientHeight?document.documentElement.scrollTop:document.body.scrollTop},componentDidMount:function componentDidMount(){var scrollPosition=this.state.scrollPosition;setTimeout(function(){window.scrollTo(0,scrollPosition)});var localKey="statsHide"+this.props.siteId,hiddenSiteModules=store.get(localKey)||[];if(hiddenSiteModules.length){analytics.mc.bumpStat("calypso_stats_mod_hidden",hiddenSiteModules.length)}},updateScrollPosition:function updateScrollPosition(){this.props.context.state.scrollPosition=this.scrollTop();this.props.context.save()},chartBarClick:function chartBarClick(bar){page.redirect(this.props.path+"?startDate="+bar.period)},trackOldStats:function trackOldStats(){var oldStatsLocation="wp-admin"===store.get("oldStatsLink")?"wp-admin":"my-stats";analytics.mc.bumpStat("calypso_stats_return",oldStatsLocation);analytics.ga.recordEvent("Stats","Clicked Visit Old Stats Page Button",oldStatsLocation)},trackOtherStats:function trackOtherStats(){analytics.mc.bumpStat("calypso_stats_other_recent","click");analytics.ga.recordEvent("Stats","Clicked Other Recent Stats Link");analytics.tracks.recordEvent("calypso_stats_other_recent_click")},barClick:function barClick(bar){analytics.ga.recordEvent("Stats","Clicked Chart Bar");page.redirect(this.props.path+"?startDate="+bar.data.period)},switchChart:function switchChart(tab){if(!tab.loading&&tab.attr!==this.state.chartTab){analytics.ga.recordEvent("Stats","Clicked "+titlecase(tab.attr)+" Tab");this.setState({chartTab:tab.attr,tabSwitched:true})}},render:function render(){debug("Rendering site stats component",this.props);var site=this.props.sites.getSite(this.props.siteId),charts=this.props.charts(),queryDate=this.props.date.format("YYYY-MM-DD"),videoList,moduleClass,oldStatsMessage=null,tagsList,nonPeriodicModules,moduleStrings=statsStrings(),oldStatsLink="https://wordpress.com/my-stats/?poll=1&blog="+this.props.siteId,currentUser=user.get(),period=this.props.period.period;if(!site.jetpack&&"wp-admin"===store.get("oldStatsLink")){oldStatsLink=url.resolve(site.options.admin_url,"index.php?poll=1&page=stats")}moduleClass=classNames("stats-module",{"is-expanded":this.state.showModule});if(currentUser.ID<83541513){oldStatsMessage=React.createElement("div",{className:"stats-message stats switch-stats"},React.createElement("p",null,React.createElement("a",{onClick:this.trackOldStats,href:oldStatsLink,className:"button",target:"_blank",rel:"external"},this.translate("Visit the old stats page",{context:"Button at the bottom of the Stats page"})," ",React.createElement("span",{className:"noticon noticon-external"}))))}if(site){if(!site.jetpack){tagsList=React.createElement(StatsModule,{path:"tags-categories",moduleStrings:moduleStrings.tags,site:site,dataList:this.props.tagsList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition});videoList=React.createElement(StatsModule,{path:"videoplays",moduleStrings:moduleStrings.videoplays,site:site,dataList:this.props.videoPlaysList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition})}}if(config.isEnabled("manage/stats/insights")){nonPeriodicModules=React.createElement("div",{className:"stats-nonperiodic has-no-recent"},React.createElement("h3",{className:"stats-section-title"},this.translate("Other Recent Stats",{context:"Header on the Stats page",comment:"This header is important as stats below it do not conform to the time period selection that affects all panels above it."})),React.createElement("p",null,this.translate("Looking for your {{recent}}Other Recent Stats{{/recent}}? We've moved them to the {{insights}}Insights{{/insights}} page. ",{components:{recent:React.createElement("a",{href:"/stats/insights/"+site.slug,onClick:this.trackOtherStats}),insights:React.createElement("a",{href:"/stats/insights/"+site.slug,onClick:this.trackOtherStats})},context:"Stats: Text at the bottom of the period pages pointing toward the insights page"})))}else{nonPeriodicModules=React.createElement("div",{className:"stats-nonperiodic has-recent"},React.createElement("h3",{className:"stats-section-title"},this.translate("Other Recent Stats",{context:"Header on the Stats page",comment:"This header is important as stats below it do not conform to the time period selection that affects all panels above it."})),React.createElement("div",{className:"module-list"},React.createElement("div",{className:"module-column"},React.createElement(Comments,{path:"comments",site:site,commentsList:this.props.commentsList,period:this.props.period,date:queryDate,followList:this.props.followList,commentFollowersList:this.props.commentFollowersList}),tagsList),React.createElement("div",{className:"module-column"},React.createElement(Followers,{path:"followers",site:site,wpcomFollowersList:this.props.wpcomFollowersList,emailFollowersList:this.props.emailFollowersList,period:this.props.period,date:queryDate,followList:this.props.followList}),React.createElement(StatsModule,{path:"publicize",moduleStrings:moduleStrings.publicize,site:site,dataList:this.props.publicizeList,period:this.props.period,date:queryDate}))),React.createElement("div",{className:"old-stats-link"},oldStatsMessage))}return React.createElement("div",{className:"main main-column",role:"main"},React.createElement(SidebarNavigation,null),React.createElement(StatsNavigation,{section:period,site:site}),React.createElement("div",{id:"my-stats-content"},React.createElement(ChartTabs,{visitsList:this.props.visitsList,activeTabVisitsList:this.props.activeTabVisitsList,barClick:this.barClick,switchTab:this.switchChart,charts:charts,queryDate:queryDate,period:this.props.period,chartTab:this.state.chartTab}),React.createElement(DatePicker,{period:period,date:this.state.chartDate}),React.createElement("div",{className:"module-list is-events"},React.createElement("div",{className:"module-column"},React.createElement(StatsModule,{path:"posts",moduleStrings:moduleStrings.posts,site:site,dataList:this.props.postsPagesList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition}),React.createElement(StatsModule,{path:"referrers",moduleStrings:moduleStrings.referrers,site:site,dataList:this.props.referrersList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition}),React.createElement(StatsModule,{path:"clicks",moduleStrings:moduleStrings.clicks,site:site,dataList:this.props.clicksList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition}),React.createElement(StatsModule,{path:"authors",moduleStrings:moduleStrings.authors,site:site,dataList:this.props.authorsList,period:this.props.period,date:queryDate,followList:this.props.followList,className:"authorviews",beforeNavigate:this.updateScrollPosition})),React.createElement("div",{className:"module-column"},React.createElement(Countries,{path:"countries",site:site,dataList:this.props.countriesList,period:this.props.period,date:queryDate}),React.createElement(StatsModule,{path:"searchterms",moduleStrings:moduleStrings.search,site:site,dataList:this.props.searchTermsList,period:this.props.period,date:queryDate,beforeNavigate:this.updateScrollPosition}),videoList)),nonPeriodicModules))}})},1531:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),classNames=__webpack_require__(11),debug=__webpack_require__(1)("calypso:stats:list-item"),page=__webpack_require__(13);var Follow=__webpack_require__(1509),Page=__webpack_require__(1511),OpenLink=__webpack_require__(1510),Spam=__webpack_require__(1512),Emojify=__webpack_require__(947),titlecase=__webpack_require__(289),analytics=__webpack_require__(12);module.exports=React.createClass({displayName:"StatsListItem",getInitialState:function getInitialState(){return{active:this.props.active,actionMenuOpen:false,disabled:false}},addMenuListener:function addMenuListener(){document.addEventListener("click",this.closeMenu)},removeMenuListener:function removeMenuListener(){document.removeEventListener("click",this.closeMenu)},componentWillUnmount:function componentWillUnmount(){if(this.props.data.actionMenu){this.removeMenuListener()}},closeMenu:function closeMenu(){this.removeMenuListener();this.setState({actionMenuOpen:false})},actionMenuClick:function actionMenuClick(event){event.stopPropagation();event.preventDefault();if(!this.state.actionMenuOpen){this.addMenuListener();this.setState({actionMenuOpen:true})}else{this.closeMenu()}},onClick:function onClick(event){var gaEvent,moduleName=titlecase(this.props.moduleName);debug("props",this.props);if(!this.state.disabled){if(this.props.children){var moduleState=this.state.active?"Collapsed ":"Expanded ";gaEvent=moduleState+moduleName;this.setState({active:!this.state.active})}if("function"===typeof this.props.itemClickHandler){event.stopPropagation();this.props.itemClickHandler(event,this.props.data)}else{if(this.props.data.page&&!this.props.children){gaEvent=["Clicked",moduleName,"Summary Link"].join(" ");page(this.props.data.page)}else if(this.props.data.link&&!this.props.children){gaEvent=["Clicked",moduleName,"External Link"].join(" ");window.open(this.props.data.link)}else if(!this.props.children){gaEvent="Clicked on "+moduleName}}if(gaEvent){analytics.ga.recordEvent("Stats",gaEvent+" in List")}}},spamHandler:function spamHandler(isSpammed){this.setState({disabled:isSpammed})},buildActions:function buildActions(){var data=this.props.data,moduleName=titlecase(this.props.moduleName),actionMenu=data.actionMenu,actionClassSet=classNames("module-content-list-item-actions",{collapsed:actionMenu&&!this.state.disabled}),actionList;if(data.actions){var actionItems=[];data.actions.forEach(function(action){var actionItem;switch(action.type){case"follow":if(action.data&&this.props.followList){var followSite=this.props.followList.add(action.data);actionItem=React.createElement(Follow,{followSite:followSite,key:action.type,moduleName:moduleName})}break;case"page":actionItem=React.createElement(Page,{page:action.page,key:action.type,moduleName:moduleName});break;case"spam":actionItem=React.createElement(Spam,{data:action.data,key:action.type,afterChange:this.spamHandler,moduleName:moduleName});break;case"link":actionItem=React.createElement(OpenLink,{href:action.data,key:action.type,moduleName:moduleName});break}if(actionItem){actionItems.push(actionItem)}},this);if(actionItems.length>0){actionList=React.createElement("ul",{className:actionClassSet},actionItems)}}return actionList},buildLabel:function buildLabel(){var data=this.props.data,labelData=data.label,wrapperClassSet,label;if(false===labelData instanceof Array){labelData=[data]}wrapperClassSet=classNames({"module-content-list-item-label-section":labelData.length>1});label=labelData.map(function(labelItem,i){var classSetOptions={noticon:labelItem.noticon},iconClassSetOptions={avatar:true},icon,avatar,noticonSpan,classSet;if(labelItem.noticon){classSetOptions["noticon-"+labelItem.noticon]=true;classSet=classNames(classSetOptions);noticonSpan=React.createElement("span",{className:classSet})}if("icon"in labelItem){if(labelItem.iconClassName){iconClassSetOptions[labelItem.iconClassName]=true}if(labelItem.icon){avatar=React.createElement("img",{alt:"",src:labelItem.icon,width:"20",height:"20",className:classNames(iconClassSetOptions)})}icon=React.createElement("span",{className:"icon"},avatar)}return React.createElement("span",{className:wrapperClassSet,key:i},noticonSpan,icon,React.createElement(Emojify,null,labelItem.label))},this);return label},buildValue:function buildValue(){var data=this.props.data,valueData=data.value,value;if("object"!==typeof valueData||!valueData.type){valueData={type:"number",value:valueData}}switch(valueData.type){case"relative-date":value=this.moment(valueData.value).fromNow(true);break;default:case"number":value=this.numberFormat(valueData.value);break}return value},render:function render(){var groupClassOptions,groupClassName,data=this.props.data,mobileActionToggle,rightClassOptions={"module-content-list-item-right":true},toggleOptions={"module-content-list-item-actions-toggle":true,show:data.actionMenu&&!this.state.disabled},actions=this.buildActions();groupClassOptions={"module-content-list-item":true,disabled:this.state.disabled,"module-content-list-item-link":this.props.children||data.link||data.page,"module-content-list-item-toggle":this.props.children,"is-expanded":this.state.active};if(data.className){groupClassOptions[data.className]=true}if(actions){mobileActionToggle=React.createElement("a",{href:"#",onClick:this.actionMenuClick,className:classNames(toggleOptions),title:this.translate("Show Actions",{textOnly:true,context:"Label for hidden menu in a list on the Stats page."})},React.createElement("span",{className:"noticon noticon-ellipsis"}));rightClassOptions["is-expanded"]=this.state.actionMenuOpen}groupClassName=classNames(groupClassOptions);return React.createElement("li",{key:this.key,"data-group":this.key,className:groupClassName},React.createElement("span",{className:"module-content-list-item-wrapper",onClick:this.onClick,tabIndex:"0"},React.createElement("span",{className:classNames(rightClassOptions)},mobileActionToggle,actions,React.createElement("span",{className:"module-content-list-item-value"},data.value?this.buildValue():null)),React.createElement("span",{className:"module-content-list-item-label"},this.buildLabel())),this.props.children)}})},1532:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(2),debug=__webpack_require__(1)("calypso:stats:stats-overview"),store=__webpack_require__(21);var observe=__webpack_require__(42),SidebarNavigation=__webpack_require__(686),SiteOverview=__webpack_require__(1139),SiteOverviewPlaceholder=__webpack_require__(1134),DatePicker=__webpack_require__(922),StatsNavigation=__webpack_require__(880),analytics=__webpack_require__(12),user=__webpack_require__(26)(),Main=__webpack_require__(679);module.exports=React.createClass({displayName:"StatsOverview",mixins:[observe("sites")],trackOldStats:function trackOldStats(){analytics.mc.bumpStat("calypso_stats_return","wp-admin"===store.get("oldStatsLink")?"wp-admin":"my-stats")},render:function render(){debug("Render stats component",this.props);var sites=this.props.sites,path=this.props.path==="/stats"?"/stats/day":this.props.path,oldStatsLink="wp-admin"===store.get("oldStatsLink")?"https://dashboard.wordpress.com/wp-admin/index.php?poll=1&page=stats":"https://wordpress.com/my-stats?poll=1",oldStatsMessage=null,currentUser=user.get();sites=sites.getVisible();sites=sites.map(function(site){var momentSiteZone=this.moment();if("object"===typeof site.options&&"undefined"!==typeof site.options.gmt_offset){momentSiteZone=this.moment().utcOffset(site.options.gmt_offset)}site.periodEnd=momentSiteZone.endOf(this.props.period).format("YYYY-MM-DD");return site},this);sites.sort(function(a,b){if(a.periodEnd>b.periodEnd){return 1}if(a.periodEnd<b.periodEnd){return-1}if(a.primary){return-1}if(b.primary){return 1}if(a.title.toUpperCase()>b.title.toUpperCase()){return 1}if(a.title.toUpperCase()<b.title.toUpperCase()){return-1}return 0});var sitesList=sites.map(function(site,index,sites){var siteOffset=0,date,summaryData=this.props.statSummaryList.get(site.ID,date),overview=[];if("object"===typeof site.options&&"undefined"!==typeof site.options.gmt_offset){siteOffset=site.options.gmt_offset}date=this.moment().utcOffset(siteOffset).format("YYYY-MM-DD");if(0===index||sites[index-1].periodEnd!==site.periodEnd){overview.push(React.createElement(DatePicker,{period:this.props.period,date:date}))}overview.push(React.createElement(SiteOverview,{key:site.ID,site:site,summaryData:summaryData,path:path}));return overview},this);if(currentUser.ID<83541513){oldStatsMessage=React.createElement("div",{className:"stats-message stats switch-stats"},React.createElement("p",null,React.createElement("a",{onClick:this.trackOldStats,href:oldStatsLink,className:"button",target:"_blank",rel:"external"},this.translate("Visit the old stats page",{context:"Button at the bottom of the Stats page"})," ",React.createElement("span",{className:"noticon noticon-external"}))))}return React.createElement(Main,null,React.createElement(SidebarNavigation,null),React.createElement(StatsNavigation,{section:this.props.period}),React.createElement("div",{id:"my-stats-content"},sites.length!==0?sitesList:this.placeholders(),oldStatsMessage))},placeholders:function placeholders(){var items=[],i,limit;limit=Math.min(this.props.user.get().visible_site_count,10);items.push(React.createElement("h3",{className:"stats-section-title"},""));for(i=0;i<limit;i++){items.push(React.createElement(SiteOverviewPlaceholder,{key:i}))}return items}})},1533:function(module,exports,__webpack_require__){"use strict";var _Object$freeze=__webpack_require__(285)["default"];var React=__webpack_require__(2),page=__webpack_require__(13),debug=__webpack_require__(1)("calypso:stats:site");var observe=__webpack_require__(42),HeaderCake=__webpack_require__(705),StatsModule=__webpack_require__(923),StatsStrings=__webpack_require__(924)(),Countries=__webpack_require__(1018),SummaryChart=__webpack_require__(1135),VideoPlayDetails=__webpack_require__(1523);module.exports=React.createClass({displayName:"StatsSummary",mixins:[observe("sites","summaryList")],getActiveFilter:function getActiveFilter(){return this.props.filters().filter(function(filter){return this.props.path===filter.path||filter.altPaths&&-1!==filter.altPaths.indexOf(this.props.path)},this).shift()},goBack:function goBack(){var pathParts=this.props.path.split("/"),queryString=this.props.context.querystring?"?"+this.props.context.querystring:null;if(history.length){history.back()}else{setTimeout(function(){page.show("/stats/"+pathParts[pathParts.length-1]+queryString)})}},getDefaultProps:function getDefaultProps(){return{filters:_Object$freeze([])}},getInitialState:function getInitialState(){return{date:this.props.date}},componentDidMount:function componentDidMount(){window.scrollTo(0,0)},render:function render(){debug("Rendering summary-top-posts.jsx",this.props);var site=this.props.sites.getSelectedSite(),title,summaryView,summaryViews=[];
switch(this.props.context.params.module){case"referrers":title=this.translate("Referrers");summaryView=React.createElement(StatsModule,{key:"referrers-summary",path:"referrers",moduleStrings:StatsStrings.referrers,site:site,dataList:this.props.summaryList,period:this.props.period,summary:true});break;case"clicks":title=this.translate("Clicks");summaryView=React.createElement(StatsModule,{key:"clicks-summary",path:"clicks",moduleStrings:StatsStrings.clicks,site:site,dataList:this.props.summaryList,period:this.props.period,summary:true});break;case"countryviews":title=this.translate("Countries");summaryView=React.createElement(Countries,{key:"countries-summary",path:"countries-summary",site:site,dataList:this.props.summaryList,period:this.props.period,summary:true});break;case"posts":title=this.translate("Posts & Pages");summaryView=React.createElement(StatsModule,{key:"posts-summary",path:"posts",moduleStrings:StatsStrings.posts,site:site,dataList:this.props.summaryList,period:this.props.period,summary:true});break;case"authors":title=this.translate("Authors");summaryView=React.createElement(StatsModule,{key:"authors-summary",path:"authors",moduleStrings:StatsStrings.authors,site:site,dataList:this.props.summaryList,period:this.props.period,followList:this.props.followList,className:"authorviews",summary:true});break;case"videoplays":title=this.translate("Videos");summaryView=React.createElement(StatsModule,{key:"videoplays-summary",path:"videoplays",moduleStrings:StatsStrings.videoplays,site:site,dataList:this.props.summaryList,period:this.props.period,followList:this.props.followList,summary:true});break;case"videodetails":title=this.translate("Video");if(this.props.summaryList.response.post){title=this.props.summaryList.response.post.post_title}var chartTitle=React.createElement("h3",{key:"summary-title",className:"stats-section-title"},this.translate("Video Details"));summaryViews.push(chartTitle);var barChart=React.createElement(SummaryChart,{key:"video-chart",loading:this.props.summaryList.isLoading(),dataList:this.props.summaryList,activeKey:"period",dataKey:"value",labelKey:"period",labelClass:"video",tabLabel:this.translate("Plays")});summaryViews.push(barChart);summaryView=React.createElement(VideoPlayDetails,{summaryList:this.props.summaryList,key:"page-embeds"});break;case"searchterms":title=this.translate("Search Terms");summaryView=React.createElement(StatsModule,{key:"search-terms-summary",path:"searchterms",moduleStrings:StatsStrings.search,site:site,dataList:this.props.summaryList,period:this.props.period,summary:true});break}summaryViews.push(summaryView);return React.createElement("div",{className:"main main-column",role:"main"},React.createElement("div",{id:"my-stats-content"},React.createElement(HeaderCake,{onClick:this.goBack},title),summaryViews))}})},1727:function(module,exports,__webpack_require__){"use strict";var i18n=__webpack_require__(16),sites=__webpack_require__(23)();function StatsParser(){if(!(this instanceof StatsParser)){return new StatsParser}return this}function rangeOfPeriod(period,date){date=new i18n.moment(date);var periodRange={period:period,startOf:date.clone().startOf(period),endOf:date.clone().endOf(period)};if("week"===period){if("0"===date.format("d")){periodRange.startOf.subtract(6,"d")}else{periodRange.startOf.add(1,"d");periodRange.endOf.add(1,"d")}}return periodRange}function parseAvatar(avatarUrl){var avatar,avatarParts;if(avatarUrl){avatarParts=avatarUrl.split("?");avatar=avatarParts[0]+"?d=mm"}return avatar}StatsParser.prototype.stats=function(payload){var response={posts:null,views:null,visitors:null,"best-views":{day:null,count:null}};if(payload.stats){response.posts=payload.stats.posts;response.views=payload.stats.views;response.visitors=payload.stats.visitors;response["best-views"].day=payload.stats.views_best_day;response["best-views"].count=payload.stats.views_best_day_total}return response};StatsParser.prototype.statsInsights=function(payload){var response={day:false,percent:0,hour:0},dayOfWeek;if(payload.highest_day_of_week||0===payload.highest_day_of_week){dayOfWeek=payload.highest_day_of_week+1;if(dayOfWeek>6){dayOfWeek=0}response.day=i18n.moment().day(dayOfWeek).format("dddd");response.percent=Math.round(payload.highest_day_percent);response.hour=i18n.moment().hour(payload.highest_hour).startOf("hour").format("LT");response.hour_percent=Math.round(payload.highest_hour_percent)}return response};StatsParser.prototype.statsStreak=function(payload){var response={days:{},best:{day:0,percent:0},max:0},timestamp,datestamp,postDay,total=0,days=[0,0,0,0,0,0,0],maxDay;for(timestamp in payload.data){postDay=i18n.moment(timestamp,"X");datestamp=postDay.format("YYYY-MM-DD");if("undefined"===typeof response.days[datestamp]){response.days[datestamp]=0}response.days[datestamp]+=payload.data[timestamp];days[postDay.day()]+=payload.data[timestamp];total+=payload.data[timestamp]}for(datestamp in response.days){if(response.days[datestamp]>response.max){response.max=response.days[datestamp]}}maxDay=Math.max.apply(null,days);response.best.day=days.indexOf(maxDay);if(total){response.best.percent=Math.round(100*(maxDay/total))}return response};StatsParser.prototype.statsSearchTerms=function(payload){var response={data:[]},periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload&&payload.date&&payload.days&&payload.days[startDate]){response.data=payload.days[startDate].search_terms.map(function(day){return{label:day.term,className:"user-selectable",value:day.views}});if(payload.days[startDate].encrypted_search_terms){response.data.push({label:i18n.translate("Unknown Search Terms"),value:payload.days[startDate].encrypted_search_terms,link:"http://en.support.wordpress.com/stats/#search-engine-terms",noticon:"external"})}if(payload.days[startDate].other_search_terms){response.viewAll=true}if(payload.days[startDate].total_search_terms){response.total=payload.days[startDate].total_views}}return response};StatsParser.prototype.statsVisits=function(payload){var response={},attributes=["visits","likes","visitors","comments","posts"];response.data=payload.data.map(function(record){var dataRecord={},date,dayOfWeek;record.forEach(function(value,i){if("period"===payload.fields[i]){value=value.replace(/W/g,"-")}dataRecord[payload.fields[i]]=value});attributes.forEach(function(attribute){if(0!==dataRecord[attribute]&&!dataRecord[attribute]){dataRecord[attribute]=null}});dataRecord.labelDay="";dataRecord.labelWeek="";dataRecord.labelMonth="";dataRecord.labelYear="";dataRecord.classNames=[];if(dataRecord.period){date=i18n.moment(dataRecord.period,"YYYY-MM-DD");if(date.isValid()){dayOfWeek=date.toDate().getDay();if("day"===payload.unit&&(6===dayOfWeek||0===dayOfWeek)){dataRecord.classNames.push("is-weekend")}dataRecord.labelDay=date.format("MMM D");dataRecord.labelWeek=date.format("MMM D");dataRecord.labelMonth=date.format("MMM");dataRecord.labelYear=date.format("YYYY")}}return dataRecord});return response};StatsParser.prototype.statsPublicize=function(payload){var response={data:[]},serviceInfo;serviceInfo={twitter:{label:"Twitter",icon:"https://secure.gravatar.com/blavatar/7905d1c4e12c54933a44d19fcd5f9356?s=48"},facebook:{label:"Facebook",icon:"https://secure.gravatar.com/blavatar/2343ec78a04c6ea9d80806345d31fd78?s=48"},tumblr:{label:"Tumblr",icon:"https://secure.gravatar.com/blavatar/84314f01e87cb656ba5f382d22d85134?s=48"},google_plus:{label:"Google+",icon:"https://secure.gravatar.com/blavatar/4a4788c1dfc396b1f86355b274cc26b3?s=48"},linkedin:{label:"LinkedIn",icon:"https://secure.gravatar.com/blavatar/f54db463750940e0e7f7630fe327845e?s=48"},path:{label:"Path",icon:"https://secure.gravatar.com/blavatar/3a03c8ce5bf1271fb3760bb6e79b02c1?s=48"}};if(payload&&payload.services){response.data=payload.services.map(function(service){var info=serviceInfo[service.service];return{label:info.label,value:service.followers,icon:info.icon}})}return response};StatsParser.prototype.statsEvents=function(payload){var response={data:[],resultCount:0};if(payload&&payload.posts){response.data=payload.posts.map(function(post){var detailPage="/stats/post/"+post.ID+"/"+this.options.domain;return{label:post.title,page:detailPage}},this);response.resultCount=payload.found}return response};StatsParser.prototype.statsReferrers=function(payload){var response={data:[]},periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload&&payload.date&&payload.days&&payload.days[startDate]&&payload.days[startDate].groups){response.data=payload.days[startDate].groups.map(function(item){var record,actions=[],hasChildren=item.results&&item.results.length>0;if(item.url&&-1!==item.url.indexOf(item.name)||!item.url&&item.name===item.group&&-1!==item.name.indexOf(".")){actions.push({type:"spam",data:{siteID:this.siteID,domain:item.name}})}record={label:item.name,value:item.total,link:item.url,noticon:hasChildren?null:"external",icon:item.icon,actions:actions,actionMenu:actions.length,children:null};if(hasChildren){record.children=item.results.map(function(child){var childData=child.children,children,childRecord;if(childData){children=childData.map(function(item){return{label:item.name,value:item.views,link:item.url,noticon:"external"}})}childRecord={label:child.name,value:child.views,link:child.url,noticon:childData?null:"external",children:children};if(child.icon){childRecord.icon=child.icon}return childRecord})}return record},this);if(payload.days[startDate].other_views){response.viewAll=true}if(payload.days[startDate].total_views){response.total=payload.days[startDate].total_views}}return response};StatsParser.prototype.statsTopAuthors=function(payload){var response={data:[]},periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload.days&&payload.date&&payload.days[startDate]){response.data=payload.days[startDate].authors.map(function(item){var record={label:item.name,iconClassName:"avatar-user",icon:parseAvatar(item.avatar),children:null,value:item.views,className:"module-content-list-item-large",actions:[{type:"follow",data:item.follow_data?item.follow_data.params:false}]};if(item.posts&&item.posts.length>0){record.children=item.posts.map(function(child){return{label:child.title,value:child.views,page:this.options?"/stats/post/"+child.id+"/"+this.options.domain:null,actions:[{type:"link",data:child.url}],children:null}},this)}return record},this);if(payload.days[startDate].other_views){response.viewAll=true}}return response};StatsParser.prototype.statsVideo=function(payload){var data={data:[],pages:[],post:null};if(payload&&payload.data){var views=payload.data.map(function(item){var date=i18n.moment(item[0]);return{period:date.format("MMM D"),value:item[1]}});data.data=views.slice(Math.max(views.length-10,1));data.post=payload.post}if(payload&&payload.pages){data.pages=payload.pages.map(function(item){return{label:item,link:item}})}return data};StatsParser.prototype.statsFollowers=function(payload){var data={page:0,pages:0,total:0,total_wpcom:0,total_email:0,subscribers:[],viewAll:false};data.page=payload.page||0;data.pages=payload.pages||0;data.total=payload.total||0;data.total_wpcom=payload.total_wpcom||0;data.total_email=payload.total_email||0;data.viewAll=data.pages>1?true:false;if(payload.subscribers){data.subscribers=payload.subscribers.map(function(item){return{label:item.label,iconClassName:"avatar-user",icon:parseAvatar(item.avatar),link:item.url,value:{type:"relative-date",value:item.date_subscribed},actions:[{type:"follow",data:item.follow_data?item.follow_data.params:false}]}})}return{data:data}};StatsParser.prototype.statsCommentFollowers=function(payload){var data={page:0,pages:0,total:0,posts:[],viewAll:false};data.page=payload.page||0;data.pages=payload.pages||0;data.total=payload.total||0;data.viewAll=data.pages>1?true:false;if(payload.posts){data.posts=payload.posts.map(function(item){if(0===item.id){return{label:"All Posts",value:item.followers}}return{label:item.title,link:item.url,noticon:"external",value:item.followers}})}return{data:data}};StatsParser.prototype.statsPostViews=function(payload){var views,defaultPostTitle=i18n.translate("Post %(number)d",{args:{number:this.options.post},context:"Stats: Title shown on Post Stats page"}),data={post:{},views:[],years:{},averages:{},weeks:[],highest_month:0,highest_day_average:0,highest_week_average:0};if(!this.options.post){defaultPostTitle="Home page / Archives"}if(payload){if(payload.data){views=payload.data.map(function(item){var date=i18n.moment(item[0]);return{period:date.format("MMM D"),value:item[1]}});data.data=views.slice(Math.max(views.length-10,1))}data.years=payload.years||{};data.averages=payload.averages||{};data.weeks=payload.weeks||[];data.highest_month=payload.highest_month||0;data.highest_day_average=payload.highest_day_average||0;data.highest_week_average=payload.highest_week_average||0;data.post=payload.post||{post_title:defaultPostTitle}}return data};StatsParser.prototype.statsVideoPlays=function(payload){var response={data:[]},periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload&&payload.date&&payload.days&&payload.days[startDate]){response.data=payload.days[startDate].plays.map(function(item){var detailPage="/stats/"+this.options.period+"/videodetails/"+this.options.domain+"?post="+item.post_id;return{label:item.title,page:detailPage,value:item.plays,actions:[{type:"link",data:item.url}]}},this);if(payload.days[startDate].other_plays){response.summaryPage=this.options?"/stats/"+this.options.period+"/videoplays/"+this.options.domain+"?startDate="+startDate:null}if(payload.days[startDate].total_plays){response.total=payload.days[startDate].total_plays}}return response};StatsParser.prototype.statsComments=function(payload){var response={data:{authors:[],posts:[]}},site=sites.getSite(this.options.domain),adminUrl=site?site.options.admin_url:"http://"+this.options.domain+"/wp-admin/";if(payload.authors){response.data.authors=payload.authors.map(function(author){return{label:author.name,value:author.comments,iconClassName:"avatar-user",icon:parseAvatar(author.gravatar),link:adminUrl+"edit-comments.php"+author.link,className:"module-content-list-item-large",actions:[{type:"follow",data:author.follow_data?author.follow_data.params:false}]}},this)}if(payload.posts){response.data.posts=payload.posts.map(function(post){return{label:post.name,value:post.comments,page:this.options?"/stats/post/"+post.id+"/"+this.options.domain:null,actions:[{type:"link",data:post.link}]}},this)}return response};StatsParser.prototype.statsTopPosts=function(payload){var response={data:[]},periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload&&payload.date&&payload.days&&payload.days[startDate]&&payload.days[startDate].postviews){response.data=payload.days[startDate].postviews.map(function(item){var detailPage="/stats/post/"+item.id+"/"+this.options.domain,postDate,children,inPeriod=false;if(item.date){postDate=i18n.moment(item.date);if((postDate.isAfter(periodRange.startOf)||postDate.isSame(periodRange.startOf))&&(postDate.isBefore(periodRange.endOf)||postDate.isSame(periodRange.endOf))){inPeriod=true}}if(item.children){children=item.children.map(function(child){return{label:child.title,value:child.views,link:child.link,noticon:"attachment"}})}return{label:item.title,value:item.views,page:detailPage,actions:[{type:"link",data:item.href}],noticon:null,children:null,className:inPeriod?"published":null}},this);if(payload.days[startDate].other_views){response.viewAll=true}if(payload.days[startDate].total_views){response.total=payload.days[startDate].total_views}}return response};StatsParser.prototype.statsTags=function(payload){var response={data:[]};if(payload&&payload.tags){response.data=payload.tags.map(function(item){var children,hasChildren=item.tags.length>1,labels;labels=item.tags.map(function(tagItem){return{label:tagItem.name,noticon:tagItem.type,link:hasChildren?null:tagItem.link}});if(hasChildren){children=item.tags.map(function(tagItem){return{label:tagItem.name,noticon:tagItem.type,value:null,children:null,link:tagItem.link}})}return{label:labels,link:labels.length>1?null:labels[0].link,value:item.views,children:children}})}return response};StatsParser.prototype.statsClicks=function(payload){var response={},data=[],periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload.date&&payload.days&&payload.days[startDate]){payload.days[startDate].clicks.forEach(function(item){var newRecord,hasChildren=item.children&&item.children.length>0;newRecord={label:item.name,value:item.views,children:null,link:item.url,icon:item.icon,noticon:hasChildren?null:"external"};if(item.children){newRecord.children=[];item.children.forEach(function(child){var childRecord={label:child.name,value:child.views,children:null,link:child.url,noticon:"external"};newRecord.children.push(childRecord)},this)}data.push(newRecord)},this);if(payload.days[startDate].other_clicks){response.viewAll=true}if(payload.days[startDate].total_clicks){response.total=payload.days[startDate].total_clicks}}response.data=data;return response};StatsParser.prototype.statsCountryViews=function(payload){var response={},data=[],periodRange=rangeOfPeriod(this.options.period,this.options.date),startDate=periodRange.startOf.format("YYYY-MM-DD");if(payload&&payload.days&&payload.days[startDate]&&payload.days[startDate].views){data=payload.days[startDate].views.filter(function(viewsObject){var country=payload["country-info"][viewsObject.country_code];return country}).map(function(viewsObject){var country=payload["country-info"][viewsObject.country_code],icon=country.flat_flag_icon.match(/grey\.png/)?null:country.flat_flag_icon;return{label:country.country_full.replace(//,"'"),value:viewsObject.views,region:country.map_region,icon:icon}});if(payload.days[startDate].other_views&&payload.days[startDate].other_views>0){response.viewAll=true}if(payload.days[startDate].total_views){response.total=payload.days[startDate].total_views}}response.data=data;return response};module.exports=StatsParser},1728:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(1)("calypso:stats-data-summary"),store=__webpack_require__(21);var wpcom=__webpack_require__(20),Emitter=__webpack_require__(10);function StatsDataSummary(options){var localData;if(!(this instanceof StatsDataSummary)){return new StatsDataSummary(options)}this.period=options.period;this.date=options.date;this.siteId=options.siteId;this.data={};this.localStoreKey="StatsDataSummary"+options.siteId;localData=this.findInLocalStorage();if(!localData){this.fetch()}return this}Emitter(StatsDataSummary.prototype);function fetchNewRecord(record){var performFetch=false,requestedAt=(new Date).getTime();if(!record.updatedAt){performFetch=true}else if(requestedAt-record.updatedAt>=6e5){performFetch=true}return performFetch}StatsDataSummary.prototype.fetch=function(callback){var query={period:this.period,date:this.date};wpcom.site(this.siteId).statsSummary(query,function(error,data){delete data.headers;data.updatedAt=(new Date).getTime();this.data=data;this.saveToLocalStorage();if(this.period===data.period&&this.date===data.date){this.emit("change")}if("function"===typeof callback){callback(error,data)}}.bind(this))};StatsDataSummary.prototype.fetchPeriod=function(options){debug("Fetching a new period ",options);var localData;this.period=options.period;this.date=options.date;localData=this.findInLocalStorage();if(!localData){this.fetch()}else{this.data=localData;this.emit("change")}};StatsDataSummary.prototype.findInLocalStorage=function(){var localStoreData=store.get(this.localStoreKey)||[],matchedRecord;debug("looking up in local storage "+this.period+" date "+this.date,localStoreData);matchedRecord=localStoreData.filter(function(cachedRecord){return cachedRecord&&cachedRecord.date===this.date&&cachedRecord.period===this.period}.bind(this));if(matchedRecord.length>0){this.data=matchedRecord[0];if(fetchNewRecord(this.data)){this.fetch()}return matchedRecord[0]}else{return false}};StatsDataSummary.prototype.saveToLocalStorage=function(){var localStoreData=store.get(this.localStoreKey)||[],newCachedData;newCachedData=localStoreData.filter(function(cachedRecord){return cachedRecord&&cachedRecord.date!==this.data.date&&cachedRecord.period!==this.data.period}.bind(this));newCachedData.push(this.data);if(newCachedData.length>10){newCachedData=newCachedData.slice(newCachedData.length-10)}store.set(this.localStoreKey,newCachedData)};module.exports=StatsDataSummary},1749:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(module){var saveAs=saveAs||typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(view){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link=!view.externalHost&&"download"in save_link,click=function(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,arbitrary_revoke_timeout=10,revoke=function(file){var revoker=function(){if(typeof file==="string"){get_URL().revokeObjectURL(file)}else{file.remove()}};if(view.chrome){revoker()}else{setTimeout(revoker,arbitrary_revoke_timeout)}},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}}},FileSaver=function(blob,name){var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(blob_changed||!object_url){object_url=get_URL().createObjectURL(blob)}if(target_view){target_view.location.href=object_url}else{var new_tab=view.open(object_url,"_blank");if(new_tab==undefined&&typeof safari!=="undefined"){view.location.href=object_url}}filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments)}}},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download"}if(can_use_save_link){object_url=get_URL().createObjectURL(blob);save_link.href=object_url;save_link.download=name;click(save_link);filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url);return}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true}if(webkit_req_fs&&name!=="download"){name+=".download"}if(type===force_saveable_type||webkit_req_fs){target_view=view}if(!req_fs){fs_error();return}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);revoke(file)};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error()}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE};filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:false},abortable(function(file){file.remove();save()}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save()}else{fs_error()}}))}),fs_error)}),fs_error)},FS_proto=FileSaver.prototype,saveAs=function(blob,name){return new FileSaver(blob,name)};FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort")};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;return saveAs}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module!==null){module.exports=saveAs}else if("function"!=="undefined"&&__webpack_require__(1856)!==null&&__webpack_require__(1857)!=null){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return saveAs}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}}).call(exports,__webpack_require__(120)(module))},1856:function(module,exports){module.exports=function(){throw new Error("define cannot be used indirect")}},1857:function(module,exports){(function(__webpack_amd_options__){module.exports=__webpack_amd_options__}).call(exports,{})}});